function sprintf(){var e=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,t=arguments,o=0,i=function(e,t,o,i){o||(o=" ");var n=e.length>=t?"":new Array(1+t-e.length>>>0).join(o);return i?e+n:n+e},n=function(e,t,o,n,a,r){var s=n-e.length;return s>0&&(e=o||!a?i(e,n,r,o):e.slice(0,t.length)+i("",s,"0",!0)+e.slice(t.length)),e},a=function(e,t,o,a,r,s,l){var d=e>>>0;return o=o&&d&&{2:"0b",8:"0",16:"0x"}[t]||"",e=o+i(d.toString(t),s||0,"0",!1),n(e,o,a,r,l)},r=function(e,t,o,i,a,r){return null!=i&&(e=e.slice(0,i)),n(e,"",t,o,a,r)};return t[o++].replace(e,function(e,s,l,d,c,u,f){var h,p,m,g,b;if("%%"===e)return"%";for(var v=!1,$="",w=!1,y=!1,_=" ",P=l.length,F=0;l&&F<P;F++)switch(l.charAt(F)){case" ":$=" ";break;case"+":$="+";break;case"-":v=!0;break;case"'":_=l.charAt(F+1);break;case"0":w=!0,_="0";break;case"#":y=!0}if((d=d?"*"===d?+t[o++]:"*"==d.charAt(0)?+t[d.slice(1,-1)]:+d:0)<0&&(d=-d,v=!0),!isFinite(d))throw new Error("sprintf: (minimum-)width must be finite");switch(u=u?"*"===u?+t[o++]:"*"==u.charAt(0)?+t[u.slice(1,-1)]:+u:"fFeE".indexOf(f)>-1?6:"d"===f?0:void 0,b=s?t[s.slice(0,-1)]:t[o++],f){case"s":return r(String(b),v,d,u,w,_);case"c":return r(String.fromCharCode(+b),v,d,u,w);case"b":return a(b,2,y,v,d,u,w);case"o":return a(b,8,y,v,d,u,w);case"x":return a(b,16,y,v,d,u,w);case"X":return a(b,16,y,v,d,u,w).toUpperCase();case"u":return a(b,10,y,v,d,u,w);case"i":case"d":return h=+b||0,h=Math.round(h-h%1),p=h<0?"-":$,b=p+i(String(Math.abs(h)),u,"0",!1),n(b,p,v,d,w);case"e":case"E":case"f":case"F":case"g":case"G":return h=+b,p=h<0?"-":$,m=["toExponential","toFixed","toPrecision"]["efg".indexOf(f.toLowerCase())],g=["toString","toUpperCase"]["eEfFgG".indexOf(f)%2],b=p+Math.abs(h)[m](u),n(b,p,v,d,w)[g]();default:return e}})}function testPassword(e){var t=0,o="weak",i="",n=0;return e.length<5?(t+=3,i=i+"3 points for length ("+e.length+")\n"):e.length>4&&e.length<8?(t+=6,i=i+"6 points for length ("+e.length+")\n"):e.length>7&&e.length<16?(t+=12,i=i+"12 points for length ("+e.length+")\n"):e.length>15&&(t+=18,i=i+"18 point for length ("+e.length+")\n"),e.match(/[a-z]/)&&(t+=1,i+="1 point for at least one lower case char\n"),e.match(/[A-Z]/)&&(t+=5,i+="5 points for at least one upper case char\n"),e.match(/\d+/)&&(t+=5,i+="5 points for at least one number\n"),e.match(/(.*[0-9].*[0-9].*[0-9])/)&&(t+=5,i+="5 points for at least three numbers\n"),e.match(/.[!,@,#,$,%,^,&,*,?,_,~]/)&&(t+=5,i+="5 points for at least one special char\n"),e.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)&&(t+=5,i+="5 points for at least two special chars\n"),e.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(t+=2,i+="2 combo points for upper and lower letters\n"),e.match(/([a-zA-Z])/)&&e.match(/([0-9])/)&&(t+=2,i+="2 combo points for letters and numbers\n"),e.match(/([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~])|([!,@,#,$,%,^,&,*,?,_,~].*[a-zA-Z0-9])/)&&(t+=2,i+="2 combo points for letters, numbers and special chars\n"),0==e.length&&(t=0),o=t<16?"very weak":t>15&&t<25?"weak":t>24&&t<35?"average":t>34&&t<45?"strong":"stronger",n=Math.round(Math.min(100,100*t/45))/100,{score:t,ratio:n,percent:100*n+"%",verdict:o,log:i}}function changeEmbed(e){setCookie("USER_SELECTED_EMBED",e,2592e3)}function changeLanguage(e){setCookie("USER_SELECTED_LANG",e,2592e3)}function setCookie(e,t,o){var i=new Date;i.setTime(i.getTime()+1e3*o),document.cookie=e+"="+t+"; expires="+i.toGMTString()+"; path=/; domain=imgbb.com"}function getCookie(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}$(function(){$.ajaxSetup({url:PF.obj.config.json_api,cache:!1,dataType:"json",data:{auth_token:PF.obj.config.auth_token}}),$(window).bind("beforeunload",function(){if("continue"!=$("form",PF.obj.modal.selectors.root).data("beforeunload"))return $(PF.obj.modal.selectors.root).is(":visible")&&PF.fn.form_modal_has_changed()?PF.fn._s("All the changes that you have made will be lost if you continue."):void 0}),$(window).bind("hashchange",function(){"#edit"!=window.location.hash||$(PF.obj.modal.selectors.root).exists()||$("[data-modal=edit]").first().click()}),PF.fn.bindtipTip();var e,t=$(window).width();if($(window).on("resize",function(){PF.fn.growl.fixPosition(),PF.fn.modal.fixScrollbars();var o=PF.fn.getDeviceName(),i=["phone","phablet"],n=["tablet","laptop","desktop"];clearTimeout(void 0),clearTimeout(e),e=setTimeout(function(){$(".follow-scroll-wrapper, .follow-scroll-placeholder").css({minHeight:""}),PF.obj.follow_scroll.set(!0),PF.obj.follow_scroll.process(!0)},100);var a=PF.fn.getDeviceName();if((a!==o&&$.inArray(o,i)>=0&&-1==$.inArray(a,i)||$.inArray(o,n)>=0&&-1==$.inArray(a,n))&&PF.fn.close_pops(),$(".top-bar").css("top",""),$(PF.fn.topMenu.vars.menu).css("height",$(window).height()),$("body").css({position:"",height:""}),$(".antiscroll").removeClass("jsly").data("antiscroll",""),$(".antiscroll-inner").css({height:"",width:"",maxheight:""}),PF.fn.list_fluid_width(),t!==$(window).width()){$("[data-action=top-bar-menu-full]","#top-bar").hasClass("current")&&PF.fn.topMenu.hide(0);PF.fn.listing.columnizer(!0,0),$(PF.obj.listing.selectors.list_item).show()}t=$(window).width()}),$(document).on("click","html",function(){PF.fn.close_pops()}),$("html").hasClass("no-svg")&&$("img.replace-svg").replace_svg(),$(document).on("keydown",".numeric-input",function(e){e.keydown_numeric()}),$(document).on("click","[data-scrollto]",function(e){var t=$(this).data("scrollto"),o=$(t.match(/^\#|\./)?t:"#"+t);o.exists()?PF.fn.scroll(o):console.log("PF scrollto error: target doesn't exists",o)}),$(document).on("click","[data-trigger]",function(e){var t=$(this).data("trigger"),o=$(t.match(/^\#|\./)?t:"#"+t);o.exists()?(e.stopPropagation(),e.preventDefault(),o.closest(PF.obj.modal.selectors.root).length||PF.fn.modal.close(),o.click()):console.log("PF trigger error: target doesn't exists",o)}),$("form[method=post]").each(function(){$("input[name=auth_token]",this).exists()||$(this).append($("<input>",{type:"hidden",name:"auth_token",value:PF.obj.config.auth_token}))}),$(document).on("click",".clear-form",function(){$(this).closest("form")[0].reset()}),$(document).on("submit","form[data-action=validate]",function(e){$(this).data("type");var t=!1;if($(this).find("[required], [data-validate]").each(function(){var e=$(this).attr("type"),o=$(this).attr("pattern"),i=function(e){$(e).highlight(),t=!0};if($(this).is("[required]")&&""==$(this).val()){if($(this).is(":hidden")){var n=$($($(this).data("highlight")).exists()?$(this).data("highlight"):"#"+$(this).data("highlight"));$(n).highlight()}i(this)}if(void 0===o&&0==/mail|url/.test(e))return!0;o&&((o=new RegExp(o)).test($(this).val())||i(this)),"email"!=e||$(this).val().isEmail()||i(this)}),t)return PF.fn.growl.expirable(PF.fn._s("Check the errors in the form to continue.")),!1}),$(document).on("change","select[data-combo]",function(){var e=$("#"+$(this).data("combo"));e.exists()&&e.children(".switch-combo").hide();var t=$("#"+$(this).closest("select").data("combo")),o=$("[data-combo-value~="+$("option:selected",this).attr("value")+"]",t);o.exists()&&o.show().find("[data-required]").each(function(){$(this).attr("required","required")}),$(".switch-combo",t).each(function(){$(this).is(":visible")||$("[required]",this).attr("data-required",!0).removeAttr("required")})}),$(document).on("keyup",function(e){$this=$(e.target),27==e.keyCode&&$(PF.obj.modal.selectors.root).is(":visible")&&!$this.is(":input")&&$("[data-action=cancel],[data-action=close-modal]",PF.obj.modal.selectors.root).first().click()}),$(document).on("change",":input",function(e){PF.fn.growl.close()}),$(document).on("keyup",":input",function(e){$(".input-warning",$(this).closest(".input-label")).html("")}),$(document).on("blur",":input",function(){var e=$.trim($(this).prop("value"));$(this).prop("value",e)}),$(document).on("click",":input[data-focus=select-all]",function(){this.select()}),$(document).on("keyup change blur",":input[type=password]",function(){var e=testPassword($(this).val()),t=$(this).closest("div");""==$(this).val()&&(e.percent=0,e.verdict=""),$("[data-content=password-meter-bar]",t).width(e.percent),$("[data-text=password-meter-message]",t).removeClass("red-warning").text(""!==e.verdict?PF.fn._s(e.verdict):"")}),$(document).on("click","[rel=popup-link], .popup-link",function(e){e.preventDefault();var t=$(this)[void 0!==$(this).attr("href")?"attr":"data"]("href");if(void 0!==t)return"mailto"==t.substring(0,6)&&PF.fn.isDevice(["phone","phablet"])?(window.location=t,!1):void PF.fn.popup({href:t})}),$(window).scroll(function(){PF.obj.follow_scroll.process()}),$(document).on("click","[data-modal=simple],[data-modal=html]",function(){var e=$("[data-modal="+$(this).data("target")+"], #"+$(this).data("target")).first();PF.fn.modal.call({template:e.html(),buttons:!1})}),$(document).on("submit",PF.obj.modal.selectors.root+" form",function(e){if($(this).data("prevented"))return!1;if(void 0===$(this).attr("method"))return!1}),$(document).on("click","[data-modal=edit],[data-modal=form],[data-confirm]",function(e){e.preventDefault();var t,o=$(this);o.is("[data-confirm]")?(t=o,PF.obj.modal.type="confirm"):(0==(t=$("[data-modal="+o.data("target")+"], #"+o.data("target")).first()).length&&(t=$("[data-modal=form-modal], #form-modal").first()),0==t.length&&console.log("PF Error: Modal target doesn't exists."),PF.obj.modal.type=o.data("modal"));var i=o.data("args"),n=window[t.data("submit-fn")],a=window[t.data("cancel-fn")],r=(window[t.data("load-fn")],t.data("submit-done")),s={url:t.data("ajax-url")||(void 0!==t.data("is-xhr")?PF.obj.config.json_api:null),deferred:window[t.data("ajax-deferred")]};if("function"!=typeof n&&t.data("submit-fn")){var l=t.data("submit-fn").split(".");n=window;for(p=0;p<l.length;p++)n=n[l[p]]}if("function"!=typeof a&&t.data("cancel-fn")){var d=t.data("cancel-fn").split(".");a=window;for(p=0;p<d.length;p++)a=a[d[p]]}if("function"!=typeof load_function&&t.data("load-fn")){var c=t.data("load-fn").split(".");load_function=window;for(p=0;p<c.length;p++)load_function=load_function[c[p]]}if("object"!=typeof s.deferred&&t.data("ajax-deferred")){var u=t.data("ajax-deferred").split(".");s.deferred=window;for(p=0;p<u.length;p++)s.deferred=s.deferred[u[p]]}var f=window[t.data("before-fn")];if("function"!=typeof f&&t.data("before-fn")){var h=t.data("before-fn").split(".");f=window;for(var p=0;p<h.length;p++)f=f[h[p]]}"function"==typeof f&&f(e);var m=$(this).data("options")||{};if(o.is("[data-confirm]")){g={message:o.data("confirm"),confirm:"function"==typeof n?n(i):"",cancel:"function"==typeof a?a(i):"",ajax:s};o.attr("href")&&""==g.confirm&&(g.confirm=function(){return window.location.replace(o.attr("href"))}),PF.fn.modal.confirm($.extend(g,m))}else{t.find('textarea[placeholder][name="urls"]').each(function(e,t){$(t).text()!==$(t).val()&&$(t).html("")});var g={template:t.html(),button_submit:$(this).is("[data-modal=edit]")?PF.fn._s("Save changes"):PF.fn._s("Submit"),confirm:function(){var e=PF.fn.form_modal_has_changed(),i=$("form",PF.obj.modal.selectors.root);if(void 0!==i.attr("action"))return i.data("prevented",!e),void PF.fn.modal.close();if($(":input[name]",i).each(function(){if($(this).is(":visible"))"required"==$(this).attr("data-required")&&$(this).prop("required",!0);else{var e=$(this).attr("required");void 0!==e&&!1!==e&&$(this).prop("required",!1).attr("data-required","required")}}),!i[0].checkValidity())return!1;if(e||m.forced){if("function"==typeof n&&(submit_fn=n()),"undefined"!=typeof submit_fn&&0==submit_fn)return!1;if($(":input",PF.obj.modal.selectors.root).each(function(){$(this).val($.trim($(this).val()))}),o.is("[data-modal=edit]")&&t.html($(PF.obj.modal.selectors.body,$(PF.obj.modal.selectors.root).bindFormData()).html().replace(/rel=[\'"]tooltip[\'"]/g,'rel="template-tooltip"')),void 0!==s.url)return!0;PF.fn.modal.close(function(){void 0!==r&&PF.fn.growl.expirable(""!==r?r:PF.fn._s("Changes saved successfully."))})}else PF.fn.modal.close()},cancel:function(){if("function"==typeof cancel_fn&&(cancel_fn=cancel_fn()),"undefined"!=typeof cancel_fn&&0==cancel_fn)return!1;if(PF.fn.form_modal_has_changed()){if($(PF.obj.modal.selectors.changes_confirm).exists())return;$(PF.obj.modal.selectors.box,PF.obj.modal.selectors.root).css({transition:"none"}).hide(),$(PF.obj.modal.selectors.root).append('<div id="'+PF.obj.modal.selectors.changes_confirm.replace("#","")+'"><div class="content-width"><h2>'+PF.fn._s("All the changes that you have made will be lost if you continue.")+'</h2><div class="'+PF.obj.modal.selectors.btn_container.replace(".","")+' margin-bottom-0"><button class="btn btn-input default" data-action="cancel">'+PF.fn._s("Go back to form")+'</button> <span class="btn-alt">'+PF.fn._s("or")+' <a data-action="submit">'+PF.fn._s("continue anyway")+"</a></span></div></div>"),$(PF.obj.modal.selectors.changes_confirm).css("margin-top",-$(PF.obj.modal.selectors.changes_confirm).outerHeight(!0)/2).hide().fadeIn("fast")}else PF.fn.modal.close(),"#edit"==window.location.hash&&(window.location.hash="")},load:function(){"function"==typeof load_function&&load_function()},callback:function(){},ajax:s};PF.fn.modal.call($.extend(g,m))}}),PF.fn.is_user_logged()||$("[data-login-needed]:input, [data-user-logged=must]:input").each(function(){$(this).attr("readonly",!0)}),$(document).on("click focus","[data-login-needed], [data-user-logged=must]",function(e){PF.fn.is_user_logged()||(e.preventDefault(),e.stopPropagation(),$(this).is(":input")&&$(this).attr("readonly",!0).blur(),PF.fn.modal.call({type:"login"}))}),$(document).on("keydown",PF.obj.modal.selectors.root+" input",function(e){var t=$(e.target),o=e.charCode||e.keyCode;13===o?13==o&&$("[data-action=submit]",PF.obj.modal.selectors.root).exists()&&!t.is(".prevent-submit")&&$("[data-action=submit]",PF.obj.modal.selectors.root).click():PF.fn.growl.close()}),window.location.hash&&"#edit"==window.location.hash&&$("[data-modal=edit]").first().click(),$(document).on("click","[data-action=top-bar-menu-full]",function(){var e=$("[data-action=top-bar-menu-full]","#top-bar").hasClass("current");PF.fn.topMenu[e?"hide":"show"]()}),$(document).on("click","[data-action=top-bar-search]",function(){$("[data-action=top-bar-search-input]",".top-bar").removeClass("hidden").show(),$("[data-action=top-bar-search-input]:visible input").first().focus(),is_ios()&&!$(this).closest(PF.fn.topMenu.vars.menu).exists()&&$(".top-bar").css("position","absolute"),$("[data-action=top-bar-search]",".top-bar").hide()}),$(document).on("click",".input-search .icon-search",function(e){$("input",e.currentTarget.offsetParent).focus()}),$(document).on("click",".input-search .icon-close, .input-search [data-action=clear-search]",function(e){var t=$("input",e.currentTarget.offsetParent);""==t.val()?$(this).closest("[data-action=top-bar-search-input]").exists()&&($("[data-action=top-bar-search-input]",".top-bar").hide(),$("[data-action=top-bar-search]",".top-bar").removeClass("opened").show(),is_ios()&&"fixed"!==$(this).closest("#top-bar").css("position")&&$(".top-bar").css("position","fixed")):($(this).closest("[data-action=top-bar-search-input]").exists()||$(this).hide(),t.val("").change())}),$(document).on("keyup change","input.search",function(e){var t=$(this),o=$(this).closest(".input-search");if(!$(this).closest("[data-action=top-bar-search-input]").exists()){var i=""==t.val()?"hide":"show";$(".icon-close, [data-action=clear-search]",o)[i]()}}),$(document).on("click mouseenter",".pop-btn",function(e){if(!PF.fn.isDevice(["phone","phablet"])||"mouseenter"!=e.type&&!$(this).hasClass("pop-btn-desktop")){var t,o,i=$(e.target),n=$.makeArray(["phone","phablet"]),a=$(this);if(("mouseenter"!=e.type||$(this).hasClass("pop-btn-auto"))&&!$(this).hasClass("disabled")&&(!i.closest(".current").exists()||PF.fn.isDevice("phone")||i.closest(".pop-btn-show").exists())){if(PF.fn.growl.close(),e.stopPropagation(),t=$(this),o=$(".pop-box",t),t.addClass("opened"),$(".pop-box-inner",o).css("max-height",""),PF.fn.isDevice(n)){var r=$(".btn-text,.text,.pop-btn-text",t).first().text();void 0!==r&&""!=r||(r=PF.fn._s("Select")),$(".pop-box-header",o).exists()||o.prepend($("<div/>",{class:"pop-box-header",html:r+'<span class="btn-icon icon-close"></span></span>'}))}else $(".pop-box-header",o).remove(),o.css({bottom:""});if(o.hasClass("anchor-center")&&void 0===o.data("guidstr")&&(PF.fn.isDevice(n)?o.css("margin-left",""):o.css("margin-left",-o.width()/2)),i.is("[data-change]")&&($("li",o).removeClass("current"),i.closest("li").addClass("current"),$("[data-text-change]",t).text($("li.current a",o).text()),e.preventDefault()),o.exists()){a=e.istriggered?$(e.target):$(this);if(!(o.is(":visible")&&$(e.target).closest(".pop-box-inner").exists()&&a.hasClass("pop-keep-click"))){$(".pop-box:visible").not(o).hide().closest(".pop-btn").removeClass("opened");var s=function(e){if(e.is(":visible"))if(PF.fn.isDevice(n))$(".antiscroll-inner",e).height("100%");else{var t=e.css("marginLeft");void 0!==t&&(t=parseFloat(t),e.css("marginLeft",""));var o=e.getWindowCutoff();if(o&&(o.left||o.right)&&o.right<t){s="guid-"+PF.fn.guid();e.css("marginLeft",o.right+"px").addClass(s).attr("data-guidstr",s);var i=a.outerWidth()/2+a.offset().left-e.offset().left,r=[];$.each(["top","bottom"],function(e,t){$.each(["after","before"],function(e,o){r.push("."+s+".arrow-box-"+t+":"+o)})}),$('<style id="'+s+'">'+r.join()+" { left: "+i+"px; }</style>").appendTo("head")}else e.css("marginLeft",t+"px");$(".antiscroll-wrap:not(.jsly):visible",e).addClass("jsly").antiscroll()}else{var s=e.attr("data-guidstr");e.css("marginLeft","").removeClass(s).removeAttr("data-guidstr").closest(".pop-btn").removeClass("opened"),void 0!==s&&$("style#"+s).remove()}};if(PF.fn.isDevice(n)){$(this).is("[data-action=top-bar-notifications]")&&o.css({height:$(window).height()});var l=o.height()+"px",d=parseInt($(".top-bar").outerHeight())+parseInt($(".top-bar").css("top"))+parseInt($(".top-bar").css("margin-top"))+parseInt($(".top-bar").css("margin-bottom"))+"px";o.is(":visible")?($("#pop-box-mask").css({opacity:0}),o.css({transform:"none"}),a.closest(PF.fn.topMenu.vars.menu).exists()&&($(".top-bar").css({transform:"none"}),$(PF.fn.topMenu.vars.menu).css({height:$(window).height()+parseInt(d)})),setTimeout(function(){o.hide().attr("style",""),$("#pop-box-mask").remove(),s(o),a.closest(PF.fn.topMenu.vars.menu).exists()&&($(PF.fn.topMenu.vars.menu).css({height:""}),$(PF.fn.topMenu.vars.menu).animate({scrollTop:PF.fn.topMenu.vars.scrollTop},PF.obj.config.animation.normal/2))},PF.obj.config.animation.normal),$("body").data("hasOverflowHidden")||$("body").removeClass("overflow-hidden")):($("#pop-box-mask").remove(),o.parent().prepend($("<div/>",{id:"pop-box-mask",class:"fullscreen soft-black"}).css({zIndex:400,display:"block"})),PF.fn.topMenu.vars.scrollTop=$(PF.fn.topMenu.vars.menu).scrollTop(),setTimeout(function(){$("#pop-box-mask").css({opacity:1}),setTimeout(function(){o.show().css({bottom:"-"+l,maxHeight:$(window).height(),zIndex:1e3,transform:"translate(0,-"+l+")"}),setTimeout(function(){s(o)},PF.obj.config.animation.normal),$("body").hasClass("overflow-hidden")?$("body").data("hasOverflowHidden",1):$("body").addClass("overflow-hidden"),a.closest(PF.fn.topMenu.vars.menu).exists()&&($(".top-bar").css({transform:"translate(0, -"+d+")"}),$(PF.fn.topMenu.vars.menu).css({height:$(window).height()+parseInt(d)})),$(".pop-box-inner",o).css("height",o.height()-$(".pop-box-header",o).outerHeight(!0))},1)},1))}else o[o.is(":visible")?"hide":"show"](0,function(){s(o)})}}}}}).on("mouseleave",".pop-btn",function(){if(PF.fn.isDevice(["laptop","desktop"])){var e=$(this),t=$(".pop-box",e);!e.hasClass("pop-btn-auto")||PF.fn.isDevice(["phone","phablet"])&&e.hasClass("pop-btn-auto")||(!PF.fn.isDevice(["phone","phablet","tablet"])&&$(this).hasClass("pop-btn-delayed")&&$(this).removeClass("pop-btn-auto"),t.hide().closest(".pop-btn").removeClass("opened"))}}),$(".pop-btn-delayed").delayedAction({delayedAction:function(e){PF.fn.isDevice(["phone","phablet","tablet"])||$(".pop-box-inner",e).is(":hidden")&&e.addClass("pop-btn-auto").click()},hoverTime:2e3}),window.location.hash,$(".content-tabs").exists()){var o=$("a",".content-tabs .current");History.replaceState({href:o.attr("href"),"data-tab":o.data("tab"),pushed:"tabs",statenum:0},null,null)}void 0===History.getState().data&&History.replaceState({scrollTop:0},document.title,window.location.href),History.Adapter.bind(window,"popstate",function(){var e=History.getState();e.data&&void 0!==e.data.scrollTop&&$(window).scrollTop()!==e.data.scrollTop&&$(window).scrollTop(e.data.scrollTop)}),$("a",".content-tabs").click(function(e){if(1==$(this).data("link")&&$(this).data("tab",!1),$(this).closest(".current,.disabled").exists())e.preventDefault();else if(void 0!==$(this).data("tab")){var t={};if($.each(this.attributes,function(){t[this.name]=this.value}),t.pushed="tabs","classic"!=$("#"+t["data-tab"]).data("load")){if(window.location.hash){var o=window.location.href;o=o.replace(window.location.hash,"")}History.pushState(t,document.title,void 0!==o?o:$(this).attr("href")),e.preventDefault()}var i=$("[data-action=tab-menu]",$(this).closest(".header"));i.find("[data-content=current-tab-label]").text($(this).text()),$(this).is(":visible")&&i.is(":visible")&&i.click()}}),$(document).on("click","[data-action=tab-menu]",function(){var e=$(this).closest(".header").find(".content-tabs"),t=e.is(":visible"),o=$(this);if(2==e.find("li a").length){var i=e.find("li:not(.current) a");if(1==i.length)return void i.click()}t||(e.data("classes",e.attr("class")),e.removeClass(function(e,t){return(t.match(/\b\w+-hide/g)||[]).join(" ")}),e.hide()),t||o.removeClass("current"),e[t?"hide":"show"](),t&&(e.css("display","").addClass(e.data("classes")),o.addClass("current"))}),$(window).bind("statechange",function(e){PF.fn.growl.close();var t;(t=History.getState().data)&&"tabs"==t.pushed&&PF.fn.show_tab(t["data-tab"])}),$(document).on("click",".list-item a",function(e){""!=$(this).attr("src")&&History.replaceState({scrollTop:$(window).scrollTop()},document.title,window.location.href)}),$(document).on("click","[data-action=load-more]",function(e){if($(this).closest(".content-listing-more").hide(),PF.fn.is_listing()&&!$(this).closest(PF.obj.listing.selectors.content_listing).is(":hidden")&&!$(this).closest("#content-listing-template").exists()&&!PF.obj.listing.calling){PF.fn.listing.queryString.stock_new(),PF.obj.listing.query_string.page=$(PF.obj.listing.selectors.content_listing_visible).data("page"),PF.obj.listing.query_string.page++;var t=$(PF.obj.listing.selectors.content_listing_visible).data("offset");void 0!==t?(PF.obj.listing.query_string.offset=t,void 0===PF.obj.listing.params_hidden&&(PF.obj.listing.params_hidden={}),PF.obj.listing.params_hidden.offset=t):(void 0!==PF.obj.listing.query_string.offset&&delete PF.obj.listing.query_string.offset,PF.obj.listing.params_hidden&&void 0!==PF.obj.listing.params_hidden.offset&&delete PF.obj.listing.params_hidden.offset),PF.fn.listing.ajax(),e.preventDefault()}}),$(PF.obj.listing.selectors.list_item).length>0&&(PF.fn.listing.show(),$(window).scroll(function(){var e=$(PF.obj.listing.selectors.content_listing_pagination,PF.obj.listing.selectors.content_listing_visible).find("[data-action=load-more]");e.length>0&&$(window).scrollTop()+$(window).innerHeight()>$(document).height()-300&&0==PF.obj.listing.calling&&e.click()})),$(document).on("click",PF.obj.modal.selectors.root+" [data-switch]",function(){var e=$(this).closest(PF.obj.modal.selectors.root);$("[data-view=switchable]",e).hide(),$("#"+$(this).attr("data-switch"),e).show()}),$(document).on("click","[data-toggle]",function(){var e=$("[data-content="+$(this).data("toggle")+"]"),t=!e.is(":visible");$(this).html($(this).data("html-"+(t?"on":"off"))),e.toggle()}),Clipboard=new Clipboard("[data-action=copy]",{text:function(e){var t=$(e.getAttribute("data-action-target"));return(t.is(":input")?t.val():t.text()).trim()}}),Clipboard.on("success",function(e){$(e.trigger.getAttribute("data-action-target")).highlight(),e.clearSelection()})});var PF={fn:{},str:{},obj:{}};PF.obj.config={base_url:"",json_api:"/json/",listing:{items_per_page:24},animation:{easingFn:"ease",normal:400,fast:250}},PF.obj.l10n={},PF.fn._s=function(e,t){var e;return void 0===e?e:(void 0!==PF.obj.l10n&&void 0!==PF.obj.l10n[e]?void 0===(e=PF.obj.l10n[e][0])&&(e=e):e=e,e=e.toString(),void 0!==t&&(e=sprintf(e,t)),e)},PF.fn._n=function(e,t,o){var i;return i=void 0!==PF.obj.l10n&&void 0!==PF.obj.l10n[e]?PF.obj.l10n[e][1==o?0:1]:1==o?e:t,i=void 0===i?e:i.toString(),void 0!==o&&(i=sprintf(i,o)),i},PF.fn.extend_lang=function(e){$.each(PF.obj.lang_strings,function(t,o){void 0!==e[t]&&$.extend(PF.obj.lang_strings[t],e[t])})},PF.fn.get_url_vars=function(){for(var e,t=/\+/g,o=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(escape(e.replace(t," ")))},n=window.location.search.substring(1),a={};e=o.exec(n);)a[i(e[1])]=i(e[2]);return a},PF.fn.get_url_var=function(e){return PF.fn.get_url_vars()[e]},PF.fn.is_user_logged=function(){return $("#top-bar-user").exists()},PF.fn.generate_random_string=function(e){void 0===e&&(e=5);for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)t+=o.charAt(Math.floor(Math.random()*o.length));return t},PF.fn.getDateTime=function(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,i=e.getDate(),n=e.getHours(),a=e.getMinutes(),r=e.getSeconds();if(1==o.toString().length)o="0"+o;if(1==i.toString().length)i="0"+i;if(1==n.toString().length)n="0"+n;if(1==a.toString().length)a="0"+a;if(1==r.toString().length)r="0"+r;return t+"-"+o+"-"+i+" "+n+":"+a+":"+r},PF.fn.htmlEncode=function(e){return $("<div/>").text($.trim(e)).html()},PF.fn.htmlDecode=function(e){return $("<div/>").html($.trim(e)).text()},PF.fn.nl2br=function(e){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")},PF.fn.baseName=function(e){var t=new String(e).substring(e.lastIndexOf("/")+1);return-1!=t.lastIndexOf(".")&&(t=t.substring(0,t.lastIndexOf("."))),t},PF.fn.guid=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?o:3&o|8).toString(16)})},PF.fn.md5=function(e){for(var t=0,o=0,i=e.length;o<i;)t=(t<<5)-t+e.charCodeAt(o++)<<0;return t},PF.fn.dataURItoBlob=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var o=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return new Blob([i],{type:o})},PF.fn.clean_facebook_hash=function(){"#_=_"==window.location.hash&&(window.location.hash="")},PF.fn.clean_facebook_hash(),Object.size=function(e){var t,o=0;for(t in e)e.hasOwnProperty(t)&&o++;return o},Object.flatten=function(e,t){if(void 0===t)var t="";var o={};return $.each(e,function(e,i){i&&("object"==typeof i?o=$.extend({},o,Object.flatten(i,t+e+"_")):o[t+e]=i)}),o},String.prototype.isNumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)},String.prototype.repeat=function(e){return new Array(e+1).join(this)},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.isEmail=function(){return/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(this)},String.prototype.match_image_urls=function(){return this.match(/\b(?:(http[s]?|ftp[s]):\/\/)?([^:\/\s]+)(:[0-9]+)?((?:\/\w+)*\/)([\w\-\.]+[^#?\s]+)([^#\s]*)?(#[\w\-]+)?\.(?:jpe?g|gif|png|bmp)\b/gim)},String.prototype.match_urls=function(){return this.match(/\b(?:(http[s]?|ftp[s]):\/\/)?([^:\/\s]+)(:[0-9]+)?((?:\/\w+)*\/)([\w\-\.]+[^#?\s]+)([^#\s]*)?(#[\w\-]+)?\b/gim)},"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){void 0===t&&(t=0),t<0&&(t+=this.length),t<0&&(t=0);for(var o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1}),Array.prototype.array_unique=function(){var e=[];return $.each(this,function(t,o){-1==$.inArray(o,e)&&e.push(o)}),e},PF.fn.deparam=function(e){if(void 0!==e&&e){for(var t={},o=e.replace(/^[\?|&]*/,"").replace(/[&|\?]*$/,"").split("&"),i=0;i<o.length;i++){var n=o[i].split("="),a=decodeURIComponent(n[0]),r=decodeURIComponent(n[1]);t.hasOwnProperty(a)&&!r||(t[a]=r)}return t}},String.prototype.removeURLParameter=function(e){var t=PF.fn.deparam(this);return void 0!==t[e]&&delete t[e],decodeURIComponent($.param(t))},String.prototype.truncate_middle=function(e){function t(e,t,o){for(var i=[" ","/","&"],n=.8*t,e=(o=void 0!==o&&o)?e.split("").reverse().join(""):e,a="",r=0;r<t-1&&(a+=e[r],!(r>=n&&i.indexOf(e[r])>=0));r++);return o?a.split("").reverse().join(""):a}var o=(e=void 0!==e?e:40)/2,i=this.replace(/https?:\/\//g,"");return i.length<=e?i:t(i,o,!1)+"..."+t(i,o,!0)},jQuery.fn.exists=function(){return this.length>0},jQuery.fn.replace_svg=function(){this.attr("src")&&$(this).each(function(){$(this).attr("src",$(this).attr("src").replace(".svg",".png"))})},jQuery.fn.is_fluid=function(){return!0},jQuery.fn.bindFormData=function(){return $(":input",this).each(function(){var e=PF.fn.htmlEncode($(this).val());if($(this).is("input")&&(this.setAttribute("value",this.value),this.checked?this.setAttribute("checked","checked"):this.removeAttribute("checked")),$(this).is("textarea")&&$(this).html(e),$(this).is("select")){var t=this.selectedIndex,o=0;$(this).children("option").each(function(){o++!=t?this.removeAttribute("selected"):this.setAttribute("selected","selected")})}}),this},jQuery.fn.formValues=function(e){var t=$(":input",this);return"object"!=typeof e?(e={},$.each(t,function(){this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/color|date|datetime|datetime-local|email|month|range|search|tel|time|url|week|text|number|hidden|password/i.test(this.type))&&(this.name.match(/^.*\[\]$/)&&this.checked?(void 0===e[this.name]&&(e[this.name]=[]),e[this.name].push($(this).val())):e[this.name]=$(this).val())}),e):($.each(t,function(){this.name.match(/^.*\[\]$/)&&"object"==typeof e[this.name]?$(this).prop("checked",-1!==e[this.name].indexOf($(this).val())):this.name&&e[this.name]?/checkbox|radio/i.test(this.type)?$(this).prop("checked",e[this.name]==$(this).val()):$(this).val(e[this.name]):/checkbox|radio/i.test(this.type)&&$(this).removeProp("checked")}),$(this))},jQuery.Event.prototype.keydown_numeric=function(){var e=this;if(e.shiftKey)return e.preventDefault(),!1;var t=e.charCode||e.keyCode,o=e.target;""==$(o).val()||parseInt($(o).val());return 13==t||(46==t||8==t||9==t||27==t||65==t&&!0===e.ctrlKey||t>=35&&t<=40||void((t<48||t>57)&&(t<96||t>105)&&e.preventDefault()))},PF.fn.getScrollBarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var o=e.offsetWidth;t.style.overflow="scroll";var i=e.offsetWidth;return o==i&&(i=t.clientWidth),document.body.removeChild(t),o-i},PF.str.ScrollBarWidth=PF.fn.getScrollBarWidth(),PF.fn.top_notifications_viewed=function(){var e=$("[data-action=top-bar-notifications]"),t=($(".top-bar-notifications-list",e),$(".top-btn-number",e));$(".persistent",e).exists()?t.text($(".persistent",e).length).addClass("on"):t.removeClass("on")},PF.fn.bindtipTip=function(e,t){void 0===e&&(e=$("body")),e instanceof jQuery==0&&(e=$(e));var o={delay:0,content:!1,fadeIn:0};void 0!==t&&(void 0!==t.delay&&(o.delay=t.delay),void 0!==t.content&&(o.content=t.content),void 0!==t.content&&(o.fadeIn=t.fadeIn)),"tooltip"!==e.attr("rel")&&(e=$("[rel=tooltip]",e)),e.each(function(){if((void 0!==$(this).attr("href")||void 0!==$(this).data("href"))&&PF.fn.isDevice(["phone","phablet","tablet"]))return!0;var e=void 0===$(this).data("tiptip")?"bottom":$(this).data("tiptip");PF.fn.isDevice(["phone","phablet"])&&(e="top"),$(this).tipTip({delay:o.delay,defaultPosition:e,content:o.content,fadeIn:o.fadeIn,fadeOut:0})})},PF.fn.form_modal_has_changed=function(){if(!$(PF.obj.modal.selectors.root).is(":hidden")&&void 0!==$("html").data("modal-form-values")){var e=$("html").data("modal-form-values"),t=PF.fn.deparam($(":input:visible",PF.obj.modal.selectors.root).serialize()),o=!1,i=$.extend({},e,t);for(var n in i)if(e[n]!==t[n]){o=!0;break}return o}},PF.fn.is_listing=function(){return $(PF.obj.listing.selectors.content_listing).exists()},PF.fn.is_tabs=function(){return $(".content-tabs").exists()},jQuery.fn.shake=function(e){return this.each(function(e){var t=$(this),o=t.css("position");o.match("relative|absolute|fixed")||t.css({position:"relative"});var i=parseInt(t.css("left"));if(i.toString().isNumeric()||(i=0),!t.is(":animated")){for(var n=1;n<=2;n++)t.animate({left:i-10},0).animate({left:i},30).animate({left:i+10},30).animate({left:i},30);"static"!==o&&t.css({position:o})}}),"function"==typeof e&&e(),this},jQuery.fn.highlight=function(e){if(this.is(":animated")||!this.exists())return this;void 0===e&&(e="yellow");var t=e;switch(e){case"yellow":t="#FFFBA2";break;case"red":t="#FF7F7F";break;default:t=e}var o=$(this).css("background-color");$(this).css("background");return $(this).css({background:"",backgroundColor:t}).animate({backgroundColor:o},800,function(){$(this).css("background","")}),this},jQuery.fn.pf_slideDown=function(e,t){var o,i,n,a=$(this).length;return"function"==typeof e&&(t=e,e="normal"),void 0===e&&(e="normal"),$(this).each(function(r){var s=parseInt($(this).css("top")),l=s>0?s:0;0==e?(o={display:"block",opacity:0},i={opacity:1},n=jQuery.speed("fast").duration):(o={top:-$(this).outerHeight(!0),opacity:1,display:"block"},i={top:l},n=jQuery.speed(e).duration),$(this).data("originalTop",$(this).css("top")),$(this).css(o).animate(i,n,function(){r==a-1&&"function"==typeof t&&t()})}),this},jQuery.fn.is_in_viewport=function(){var e=$(this)[0].getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},jQuery.fn.getWindowCutoff=function(){var e={top:$(this).offset().top,left:$(this).offset().left,width:$(this).outerWidth(),height:$(this).outerHeight()};e.right=e.left+e.width,e.bottom=e.top+e.height;var t=!1,o={top:e.top>0?0:e.top,right:document.body.clientWidth-e.right,bottom:document.body.clientHeight-e.bottom,left:e.left>0?0:e.left};for(var i in o)o[i]<0?t=!0:o[i]=0;return t?o:null},PF.fn.scroll=function(e,t){if("function"==typeof e)var t=e,e="";var o=parseInt($("body").css("margin-top"));0==o&&$(".top-bar-placeholder").exists()&&(o=$(".top-bar-placeholder").height()),$(e).exists()||(e="html"),$("body,html").animate({scrollTop:$(e).offset().top-o},"normal",function(){"function"==typeof t&&t()})},PF.fn.close_pops=function(e){$(".pop-box:visible").each(function(){$(this).closest(".pop-btn").click()})},PF.fn.growl={selectors:{root:"#growl"},str:{timeout:null,timeoutcall:!1},call:function(e){if(void 0!==e&&("string"==typeof e&&(e={message:e}),void 0!==e.message)){var t,o,i,n;t={message:e.message,insertTo:"body",where:"before",color:"default",css:{},classes:"",expires:0,callback:function(){}};for(key in t)void 0!==e[key]&&(key.match("/^(callback)$/")?"function"==typeof e[key]&&(t[key]=e[key]):t[key]=e[key]);if($(t.insertTo).exists()||(t.insertTo="body"),$(PF.fn.growl.selectors.root).exists()){if($(PF.fn.growl.selectors.root).text()==t.message)return void $(PF.fn.growl.selectors.root).shake();$(PF.fn.growl.selectors.root).remove()}switch(o=$('<div id="'+PF.fn.growl.selectors.root.replace("#","")+'" class="growl">'+t.message+'<span class="icon icon-close" data-action="close"></span></div>').css(t.css).addClass(t.classes),i="body"!==t.insertTo?"static":"",t.color){case"dark":n="dark";break;default:n=""}if(o.addClass(i+" "+n),"before"==t.where?$(t.insertTo).prepend(o.hide()):$(t.insertTo).append(o.hide()),$(".fullscreen").is(":visible")&&o.css({"z-index":parseInt($(".fullscreen").css("z-index"))+1}),$(PF.obj.modal.selectors.root).is(":visible")){$(PF.obj.modal.selectors.box,PF.obj.modal.selectors.root);o.show(),o.css("top",($("#top-bar").outerHeight(!0)-o.outerHeight(!0))/2),PF.fn.growl.fixPosition(),o.hide()}o.pf_slideDown("static"==i?0:200,function(){"function"==typeof t.callback&&t.callback()}),$(document).on("click",".growl",function(e){(PF.fn.isDevice(["phone","phablet"])||$(e.target).is("[data-action=close]"))&&PF.fn.growl.close(!0)}),t.expires>0&&("number"==typeof this.str.timeout&&clearTimeout(this.str.timeout),this.str.timeout=setTimeout(function(){PF.fn.growl.str.timeoutcall=!0,PF.fn.growl.close()},t.expires))}},expirable:function(e,t){void 0!==e&&(void 0===t&&(t=5e3),PF.fn.growl.call({message:e,expires:t}))},close:function(e,t){var o=$(PF.fn.growl.selectors.root);e&&(this.str.timeout=null,this.str.timeoutcall=!1,clearTimeout(this.str.timeout)),o.exists()&&("number"!=typeof this.str.timeout||this.str.timeoutcall)&&o.fadeOut("fast",function(){$(this).remove(),"function"==typeof t&&t()})},fixPosition:function(){var e=$(PF.fn.growl.selectors.root);if(e.exists()&&$(PF.obj.modal.selectors.root).exists()&&("scrollbar"!=e.data("fixedPosition")||!$(PF.obj.modal.selectors.root).hasScrollBar().vertical)){var t={modal:$(PF.obj.modal.selectors.box).offset().left,growl:e.offset().left},o=t.modal-t.growl,i=o<0?"-="+Math.abs(o):"-"+parseInt(e.css("width"))/2;PF.fn.isDevice(["phone","phablet"])||e.css("marginLeft",i+"px"),e.data("fixedPosition",$(PF.obj.modal.selectors.root).hasScrollBar().vertical?"scrollbar":"no-scrollbar")}}},PF.obj.modal={type:"",selectors:{root:"#fullscreen-modal",box:"#fullscreen-modal-box",body:"#fullscreen-modal-body",login:"[data-modal=login]",changes_confirm:"#fullscreen-changes-confirm",btn_container:".btn-container",close_buttons:".close-modal,.cancel-modal,[data-action=cancel],[data-action-close]",submit_button:"[data-action=submit]",growl_placeholder:"#fullscreen-growl-placeholder"},ajax:{url:"",deferred:{}},locked:!1,form_data:{},XHR:{},prevented:!1},PF.obj.modal.$close_buttons=$(PF.obj.modal.selectors.close_buttons,PF.obj.modal.selectors.root),PF.obj.modal.$submit_button=$(PF.obj.modal.selectors.submit_button,PF.obj.modal.selectors.root),PF.fn.modal={str:{transition:"all "+PF.obj.config.animation.fast+"ms ease"},call:function(e){var t,o;if(void 0!==e&&(void 0!==e.template&&void 0===e.type&&(e.type="html"),void 0!==e.title&&void 0!==e.message||"login"===e.type||"html"===e.type)){PF.fn.growl.close(),t={forced:!1,type:"confirm",title:e.title,message:e.message,html:!1,template:e.template,buttons:!0,button_submit:PF.fn._s("Submit"),txt_or:PF.fn._s("or"),button_cancel:PF.fn._s("cancel"),ajax:{url:null,data:null,deferred:{}},confirm:function(){},cancel:function(){PF.fn.modal.close()},load:function(){},callback:function(){}};for(key in t)void 0!==e[key]&&(/^cancel|confirm|callback$/.test(key)?"function"==typeof e[key]&&(t[key]=e[key]):t[key]=e[key]);void 0!==e.ajax&&!e.ajax.url&&e.ajax.deferred&&(t.ajax.url=PF.obj.config.json_api),"login"==t.type&&(t.buttons=!1),"confirm"==t.type&&(t.button_submit=PF.fn._s("Confirm"));var i=['<div id="',PF.obj.modal.selectors.root.replace("#",""),'"class="fullscreen soft-black"><div id="',PF.obj.modal.selectors.box.replace("#",""),'"class="clickable"><div id="',PF.obj.modal.selectors.body.replace("#",""),'">%MODAL_BODY%</div>%MODAL_BUTTONS%<span class="close-modal icon-close" data-action="close-modal"></span></div></div>'].join(""),n=t.buttons?['<div class="',PF.obj.modal.selectors.btn_container.replace(".",""),'"><button class="btn btn-input default" data-action="submit" type="submit">',t.button_submit,'</button> <span class="btn-alt">',t.txt_or,'<a class="cancel" data-action="cancel">',t.button_cancel,"</a></span></div>"].join(""):"";"login"==t.type&&(t.template=void 0===t.template?$(PF.obj.modal.selectors.login).html():t.template);var a;switch(t.type){case"html":case"login":a=t.template;break;case"confirm":default:o=t.message,t.html||(o="<p>"+o+"</p>"),a="<h1>"+t.title+"</h1>"+o}if(void 0!==a){if(i=i.replace("%MODAL_BODY%",a).replace("%MODAL_BUTTONS%",n).replace(/template-tooltip/g,"tooltip"),$(PF.obj.modal.selectors.root).remove(),$("body").data("overflow-hidden",$("body").hasClass("overflow-hidden")),$("body").prepend(i).addClass("overflow-hidden"),this.fixScrollbars(),$("[rel=tooltip]",PF.obj.modal.selectors.root).each(function(){PF.fn.bindtipTip(this,{content:$(this).data("title")})}),$(":button, input[type=submit], input[type=reset]",PF.obj.modal.selectors.root).length>0){var r=$("form",PF.obj.modal.selectors.root);r.exists()?(r.append($($(PF.obj.modal.selectors.btn_container,PF.obj.modal.selectors.root).html()).wrapInner(PF.obj.modal.selectors.btn_container.replace(".",""))),$(PF.obj.modal.selectors.btn_container,PF.obj.modal.selectors.root).each(function(){$(this).closest("form").exists()||$(this).remove()})):$(PF.obj.modal.selectors.box,PF.obj.modal.selectors.root).wrapInner("<form />")}t.callback(),$(PF.obj.modal.selectors.box).css({transform:"scale(0.7)",opacity:0,transition:PF.fn.modal.str.transition}),$(PF.obj.modal.selectors.root).css({display:"block"}),setTimeout(function(){$(PF.obj.modal.selectors.root).css({opacity:1}),$(PF.obj.modal.selectors.box).css({transform:"scale(1)",opacity:1}),"undefined"!=typeof PFrecaptchaCallback&&PFrecaptchaCallback(),setTimeout(function(){"function"==typeof t.load&&t.load(),$("html").data("modal-form-values",PF.fn.deparam($(":input:visible",PF.obj.modal.selectors.root).serialize()))},PF.obj.config.animation.fast)},1),$(PF.obj.modal.selectors.root).click(function(o){var i=$(o.target),n=this;if(!PF.obj.modal.locked)if(i.closest(PF.obj.modal.selectors.changes_confirm).exists()&&(i.is(PF.obj.modal.selectors.close_buttons)||i.is(PF.obj.modal.selectors.submit_button)))$(PF.obj.modal.selectors.changes_confirm).remove(),i.is(PF.obj.modal.selectors.close_buttons)?$(PF.obj.modal.selectors.box,n).fadeIn("fast",function(){$(this).css("transition",PF.fn.modal.str.transition)}):PF.fn.modal.close();else if(i.closest(".clickable").exists()&&!i.is(PF.obj.modal.selectors.close_buttons)||(PF.fn.growl.close(),t.cancel()),i.is(PF.obj.modal.selectors.submit_button)){if(!1===t.confirm())return;var a=!0;if($("input, textarea, select",PF.obj.modal.selectors.root).not(":input[type=button], :input[type=submit], :input[type=reset]").length>0&&!PF.fn.form_modal_has_changed()&&!t.forced&&(a=!1),a)if(t.ajax.url){var r=$(PF.obj.modal.selectors.btn_container,PF.obj.modal.selectors.root);PF.obj.modal.locked=!0,r.first().clone().height(r.height()).html("").addClass("loading").appendTo(PF.obj.modal.selectors.root+" form"),r.hide(),PF.obj.modal.$close_buttons.hide();var s;switch(PF.obj.modal.type){case"edit":s=PF.fn._s("Saving");break;case"confirm":case"form":default:s=PF.fn._s("Sending")}PF.fn.loading.inline($(PF.obj.modal.selectors.btn_container+".loading",PF.obj.modal.selectors.root),{size:"small",message:s,valign:"center"}),$(PF.obj.modal.selectors.root).disableForm(),(!$.isEmptyObject(PF.obj.modal.form_data)||void 0!==e.ajax&&void 0===e.ajax.data)&&(t.ajax.data=PF.obj.modal.form_data),PF.obj.modal.XHR=$.ajax({url:t.ajax.url,type:"POST",data:t.ajax.data}).complete(function(e){if(PF.obj.modal.locked=!1,200==e.status){var o=void 0!==t.ajax.deferred&&void 0!==t.ajax.deferred.success?t.ajax.deferred.success:null;"function"==typeof o?PF.fn.modal.close(function(){"function"==typeof o&&o(e)}):"object"==typeof o&&("function"==typeof o.before&&o.before(e),"function"==typeof o.done&&o.done(e))}else if($(PF.obj.modal.selectors.root).enableForm(),$(PF.obj.modal.selectors.btn_container+".loading",PF.obj.modal.selectors.root).remove(),r.css("display",""),void 0!==t.ajax.deferred&&"function"==typeof t.ajax.deferred.error)t.ajax.deferred.error(e);else{var i=PF.fn._s("An error occurred. Please try again later.");PF.fn.growl.call(i)}})}else PF.fn.modal.close(t.callback())}})}else console.log("PF Error: Modal content is empty")}},confirm:function(e){e.type="confirm",void 0===e.title&&(e.title=PF.fn._s("Confirm action")),PF.fn.modal.call(e)},simple:function(e){"string"==typeof e&&(e={message:e}),void 0===e.buttons&&(e.buttons=!1),void 0===e.title&&(e.title=PF.fn._s("information")),PF.fn.modal.call(e)},fixScrollbars:function(){if($(PF.obj.modal.selectors.root).exists()){var e={padding:$(".top-bar, .fixed, .position-fixed"),margin:$("html")},t={};PF.str.ScrollBarWidth>0&&$("html").hasScrollBar().vertical&&!$("body").data("overflow-hidden")?(t.padding=PF.str.ScrollBarWidth+"px",t.margin=PF.str.ScrollBarWidth+"px"):(t.padding="",t.margin=""),e.padding.css({paddingRight:t.padding}),e.margin.css({marginRight:t.margin})}},close:function(e){$(PF.obj.modal.selectors.root).exists()&&(PF.fn.growl.close(!0),$("[rel=tooltip]",PF.obj.modal.selectors.root).tipTip("hide"),$(PF.obj.modal.selectors.box).css({transform:"scale(0.5)",opacity:0}),$(PF.obj.modal.selectors.root).css({opacity:0}),setTimeout(function(){PF.str.ScrollBarWidth>0&&$("html").hasScrollBar().vertical&&$(".top-bar, .fixed, .position-fixed").css({paddingRight:""}),$("html").css({marginRight:""}),$("body").data("overflow-hidden")||$("body").removeClass("overflow-hidden"),$("body").removeData("overflow-hidden"),$(PF.obj.modal.selectors.root).remove(),"function"==typeof e&&e()},PF.obj.config.animation.normal))}},PF.fn.popup=function(e){var t={height:e.height||500,width:e.width||650,scrollTo:0,resizable:0,scrollbars:0,location:0};t.top=screen.height/2-t.height/2,t.left=screen.width/2-t.width/2;var o="";for(var i in t)o+=i+"="+t[i]+",";o=o.slice(0,-1),window.open(e.href,"Popup",o)},PF.fn.list_fluid_width=function(){if($("body").is_fluid()){var e=$(PF.obj.listing.selectors.content_listing_visible),t=$(PF.obj.listing.selectors.pad_content,e),o=$(PF.obj.listing.selectors.list_item,e),i=o.outerWidth(!0),n=o.outerWidth(!0)-o.width();PF.obj.listing.content_listing_ratio=parseInt((e.width()+n)/i),o.length<PF.obj.listing.content_listing_ratio?t.css("width","100%"):(PF.fn.isDevice(["tablet","laptop","desktop"]),PF.obj.follow_scroll.$node.hasClass("position-fixed")&&PF.obj.follow_scroll.$node.width($(".content-width").first().width()))}},PF.obj.tabs={hashdata:{}},PF.fn.show_tab=function(e){if(void 0!==e){var t=$("a[data-tab="+e+"]",".content-tabs");$("li",t.closest("ul")).removeClass("current"),t.closest("li").addClass("current");var o=$("#tabbed-content-group");if($target=$("#"+t.data("tab")),$(".tabbed-content",o).removeClass("visible").hide(),$($target,o).addClass("visible").show(),$("[data-content=list-selection]").removeClass("visible").addClass("hidden"),$("[data-content=list-selection][data-tab="+t.data("tab")+"]").removeClass("hidden").addClass("visible"),o.exists()){var i=$(PF.obj.listing.selectors.list_item+":not(.jsly)",$target),n=!$target.hasClass("jsly");"ajax"!=$target.data("load")||"true"===$target.data("empty")||$(PF.obj.listing.selectors.list_item,$target).exists()?(PF.fn.listing.queryString.stock_current(),PF.fn.listing.columnizer(!1,0,!1),i[n?"fadeIn":"show"]()):(PF.fn.listing.queryString.stock_load(),$target.html(PF.obj.listing.template.fill),PF.fn.loading.inline($(PF.obj.listing.selectors.content_listing_loading,$target)),PF.fn.listing.queryString.stock_new(),PF.fn.listing.ajax())}PF.fn.listing.columnizerQueue(),1==$(PF.obj.listing.selectors.content_listing_visible).data("queued")&&PF.fn.listing.columnizer(!0,0)}},PF.obj.listing={columns:"",columns_number:1,current_column:"",current_column:"",XHR:{},query_string:PF.fn.get_url_vars(),calling:!1,content_listing_ratio:1,selectors:{sort:".sort-listing .current [data-sort]",content_listing:".content-listing",content_listing_visible:".content-listing:visible",content_listing_loading:".content-listing-loading",content_listing_load_more:".content-listing-more",content_listing_pagination:".content-listing-pagination",empty_icon:".icon icon-drawer",pad_content:".pad-content-listing",list_item:".list-item"},template:{fill:$("[data-template=content-listing]").html(),empty:$("[data-template=content-listing-empty]").html(),loading:$("[data-template=content-listing-loading]").html()}},PF.fn.listing={},PF.fn.listing.show=function(e,t){$content_listing=$("#content-listing-tabs").exists()?$(PF.obj.listing.selectors.content_listing_visible,"#content-listing-tabs"):$(PF.obj.listing.selectors.content_listing),PF.fn.loading.inline(PF.obj.listing.selectors.content_listing_loading),$(PF.obj.listing.selectors.list_item+":not(.jsly)",$content_listing).each(function(){$(this).imagesLoaded(function(o){var i=PF.obj.listing.selectors.list_item,n=$(i+":visible",PF.obj.listing.selectors.content_listing_visible),a=$(o.elements);(void 0!==e&&$(e.html).length<PF.obj.config.listing.items_per_page||$(PF.obj.listing.selectors.list_item,$content_listing).length<PF.obj.config.listing.items_per_page)&&PF.fn.listing.removeLoader($content_listing),!$(PF.obj.listing.selectors.content_listing_pagination,$content_listing).is("[data-type=classic]")&&$("[data-action=load-more]",$content_listing).exists()||$(PF.obj.listing.selectors.content_listing_loading,$content_listing).remove(),0==n.length&&(a.show(),PF.fn.listing.columnizer(!1,0),PF.obj.listing.recolumnize=!0);PF.fn.listing.columnizer(PF.obj.listing.recolumnize,0,0==n.length),a.hide(),PF.obj.listing.recolumnize=!1,PF.fn.isDevice(["laptop","desktop"])?a.each(function(){$(this).show().find(".image-container").hide();var e=$.now(),t=$(this),o=$(".image-container",t);$(".image-container",this).imagesLoaded(function(){var t=$.now()-e;0==n.length?t>PF.obj.config.animation.normal?o.fadeIn(PF.obj.config.animation.normal):o.show():o.fadeIn(PF.obj.config.animation.normal)})}):a.show(),PF.obj.listing.calling=!1;var r=$(PF.obj.listing.selectors.content_listing_loading,$content_listing).exists()&&$(PF.obj.listing.selectors.content_listing_loading,$content_listing).is_in_viewport();void 0===PF.obj.listing.show_load_more&&(PF.obj.listing.show_load_more=r),$(PF.obj.listing.selectors.content_listing_loading,$content_listing)[(r?"add":"remove")+"Class"]("visibility-hidden"),$(PF.obj.listing.selectors.content_listing_load_more,$content_listing)[PF.obj.listing.show_load_more?"show":"hide"]();var s=History.getState();s.data&&void 0!==s.data.scrollTop&&($(window).scrollTop(),s.data.scrollTop),"function"==typeof t&&t()})})},PF.fn.listing.removeLoader=function(e){var t=[PF.obj.listing.selectors.content_listing_load_more,PF.obj.listing.selectors.content_listing_loading];$(PF.obj.listing.selectors.content_listing_pagination,$content_listing).is("[data-type=endless]")&&t.push(PF.obj.listing.selectors.content_listing_pagination),$.each(t,function(t,o){$(o,e).remove()})},PF.fn.listing.queryString={stock_load:function(){var e=$(PF.obj.listing.selectors.content_listing_visible),t=PF.fn.deparam(e.data("params"));PF.obj.listing.params_hidden=void 0!==e.data("params-hidden")?PF.fn.deparam(e.data("params-hidden")):null,void 0===PF.obj.listing.query_string.action&&(PF.obj.listing.query_string.action=e.data("action")||"list"),void 0===PF.obj.listing.query_string.list&&(PF.obj.listing.query_string.list=e.data("list")),void 0===PF.obj.listing.query_string.sort&&(void 0!==t&&void 0!==t.sort?PF.obj.listing.query_string.sort=t.sort:PF.obj.listing.query_string.sort=$(":visible"+PF.obj.listing.selectors.sort).data("sort")),void 0===PF.obj.listing.query_string.page&&(PF.obj.listing.query_string.page=1),e.data("page",PF.obj.listing.query_string.page),$(PF.obj.listing.selectors.content_listing+"[data-load=ajax]").each(function(){var e=$("[data-tab="+$(this).attr("id")+"]"+PF.obj.listing.selectors.sort),t=PF.fn.deparam($(this).data("params")),o=PF.fn.deparam($(this).data("params-hidden")),i={q:t&&t.q?t.q:null,list:$(this).data("list"),sort:e.exists()?e.data("sort"):t&&t.sort?t.sort:null,page:t&&t.page?t.page:1};o&&o.list&&delete i.list;for(var n in i)i[n]||delete i[n]});for(var o in t)0==/action|list|sort|page/.test(o)&&(PF.obj.listing.query_string[o]=t[o]);if(void 0!==PF.obj.listing.params_hidden){for(var o in PF.obj.listing.params_hidden)0==/action|list|sort|page/.test(o)&&(PF.obj.listing.query_string[o]=PF.obj.listing.params_hidden[o]);PF.obj.listing.query_string.params_hidden=PF.obj.listing.params_hidden}},stock_new:function(){var e=$(PF.obj.listing.selectors.content_listing_visible),t=PF.fn.deparam(e.data("params"));e.data("offset")?PF.obj.listing.query_string.offset=e.data("offset"):delete PF.obj.listing.query_string.offset,PF.obj.listing.query_string.action=e.data("action")||"list",PF.obj.listing.query_string.list=e.data("list"),void 0!==t&&void 0!==t.sort?PF.obj.listing.query_string.sort=t.sort:PF.obj.listing.query_string.sort=$(":visible"+PF.obj.listing.selectors.sort).data("sort"),PF.obj.listing.query_string.page=1},stock_current:function(){this.stock_new(),PF.obj.listing.query_string.page=$(PF.obj.listing.selectors.content_listing_visible).data("page")}},PF.fn.listing.queryString.stock_load(),PF.fn.listing.ajax=function(){if(1!=PF.obj.listing.calling){PF.obj.listing.calling=!0;var e=$(PF.obj.listing.selectors.content_listing_visible),t=$(PF.obj.listing.selectors.pad_content,e);$(PF.obj.listing.selectors.content_listing_load_more,e).hide(),$(PF.obj.listing.selectors.content_listing_loading,e).removeClass("visibility-hidden").show(),PF.obj.listing.XHR=$.ajax({type:"POST",data:$.param($.extend({},PF.obj.listing.query_string,$.ajaxSettings.data))}).complete(function(o){var i=o.responseJSON,n=function(){$(PF.obj.listing.selectors.content_listing_loading+","+PF.obj.listing.selectors.content_listing_pagination+":not([data-visibility=visible])",e).remove()},a=function(){e.data("empty","true").html(PF.obj.listing.template.empty),$("[data-content=list-selection][data-tab="+e.attr("id")+"]").addClass("disabled")};if(4==o.readyState&&void 0!==i){if($("[data-content=list-selection][data-tab="+e.attr("id")+"]").removeClass("disabled"),200!==o.status){var r=void 0!==i.error&&void 0!==i.error.message?i.error.message:"Bad request";PF.fn.growl.call("Error: "+r),e.data("load","")}if(void 0!==i.html&&""!=i.html||0!=$(PF.obj.listing.selectors.list_item,e).length||a(),void 0===i.html||""==i.html)return n(),PF.obj.listing.calling=!1,void("function"==typeof PF.fn.listing_end&&PF.fn.listing_end());e.data({load:"",page:PF.obj.listing.query_string.page});var s=$.extend({},PF.obj.listing.query_string);for(var l in PF.obj.listing.params_hidden)void 0!==s[l]&&delete s[l];delete s.action;for(var l in s)s[l]||delete s[l];if(-1==document.URL.indexOf("?"+$.param(s))){var d=window.location.href;d=d.split("?")[0].replace(/\/$/,"")+"/?"+$.param(s),window.location.hash&&(d=d.replace(window.location.hash,"")),History.pushState({pushed:"pagination",scrollTop:$(window).scrollTop()},document.title,d)}$("a[data-tab="+e.attr("id")+"]").attr("href",document.URL),t.append(i.html),PF.fn.listing.show(i,function(){$(PF.obj.listing.selectors.content_listing_loading,e).addClass("visibility-hidden")})}else PF.obj.listing.calling=!1,e.data("load",""),n(),0==$(PF.obj.listing.selectors.list_item,e).length&&a(),0!==o.readyState&&PF.fn.growl.call(PF.fn._s("An error occurred. Please try again later."));"function"==typeof PF.fn.listing.ajax.callback&&PF.fn.listing.ajax.callback(o)})}},PF.fn.listing.columnizerQueue=function(){$(PF.obj.listing.selectors.content_listing+":hidden").data("queued",!0)},PF.fn.listing.refresh=function(e){PF.fn.listing.columnizer(!0,e,!1),$(PF.obj.listing.selectors.list_item).show()};var width=$(window).width();PF.fn.listing.columnizer=function(e,t,o){var n={phone:1,phablet:3,tablet:4,laptop:5,desktop:6,largescreen:6};if("boolean"!=typeof e)var e=!1;if(void 0===PF.obj.listing.mode&&(e=!0),"boolean"!=typeof o)var o=!1,a=!0;else a=!1;if(!o&&a&&(width!==$(window).width()||e)&&(o=!0),void 0===t)var t=PF.obj.config.animation.normal;var r=$("#content-listing-tabs").exists()?$(PF.obj.listing.selectors.content_listing_visible,"#content-listing-tabs"):$(PF.obj.listing.selectors.content_listing),s=$(PF.obj.listing.selectors.pad_content,r),l=$(e||o?PF.obj.listing.selectors.list_item:PF.obj.listing.selectors.list_item+":not(.jsly)",r);if(r.addClass("jsly"),r.data("device-columns")&&(n=$.extend({},n,r.data("device-columns"))),PF.obj.listing.mode="responsive",PF.obj.listing.device=PF.fn.getDeviceName(),l.exists()){if(void 0===r.data("columns")||e||o){for(l.first().css("width",""),PF.obj.listing.columns=new Array,PF.obj.listing.columns_number=n[PF.fn.getDeviceName()],i=0;i<PF.obj.listing.columns_number;i++)PF.obj.listing.columns[i+1]=0;PF.obj.listing.current_column=1}else PF.obj.listing.columns=r.data("columns"),PF.obj.listing.columns_number=r.data("columns").length-1,PF.obj.listing.current_column=r.data("current_column");var d=1==PF.obj.listing.columns_number?"-10px":"";$("#tabbed-content-group").css({marginLeft:d,marginRight:d}),r.removeClass("small-cols").addClass(PF.obj.listing.columns_number>6?"small-cols":""),s.css("width","100%");var c=0;l.each(function(e){$(this).addClass("jsly");var i=$(".list-item-image",this),n=$(".list-item-image img",this),a=$(".list-item-thumbs",this),s=n.hasClass("jsly-loaded");n.show(),o&&($(this).css({top:"",left:"",height:"",position:""}),i.css({maxHeight:"",height:""}),n.removeClass("jsly").css({width:"",height:""}).parent().css({marginLeft:"",marginTop:""}),$("li",a).css({width:"",height:""}));var d=1==PF.obj.listing.columns_number?"100%":parseInt(1/PF.obj.listing.columns_number*(r.width()-10*(PF.obj.listing.columns_number-1))+"px");if($(this).css("width",d),PF.obj.listing.current_column>PF.obj.listing.columns_number&&(PF.obj.listing.current_column=1),$(this).attr("data-col",PF.obj.listing.current_column),!n.exists()){var u=!0;n=$(".image-container .empty",this)}var f=$(this).is(":visible");l.show();var h=i.hasClass("fixed-size"),p={w:parseInt(n.attr("width")),h:parseInt(n.attr("height"))};if(p.ratio=p.w/p.h,o&&PF.obj.listing.columns_number>1?(n.css({width:"auto",height:"auto"}),$(".image-container:not(.list-item-avatar-cover)",this).css({width:"",height:"auto"})):p.w>r.width()&&($(".image-container:not(.list-item-avatar-cover)",this).css(p.ratio<1?{maxWidth:"100%",height:"auto"}:{height:"100%",width:"auto"}),n.css(p.ratio<1?{maxWidth:"100%",height:"auto"}:{height:"100%",width:"auto"})),u||i.css("min-height")&&!n.hasClass("jsly")){parseInt(i.css("height"));var m={w:$(this).width(),h:h?$(this).width():null},g=Math.min(p.w,p.w<m.w?p.w:m.w);if(h){i.css({height:m.w}),p.ratio<=3&&(p.ratio>1||1==p.ratio)?(p.h=Math.min(p.h,p.w<m.w?p.w:m.w),p.w=p.h*p.ratio):(p.w=g,p.h=p.w/p.ratio);parseInt(i.css("min-height"));i.css("min-height",0)}else p.w=g,p.ratio>=3||p.ratio<1||1==p.ratio?p.h=p.w/p.ratio:(p.h=Math.min(p.h,p.w),p.w=p.h*p.ratio),u&&(p.h=m.w),i.css({height:p.h});n.css({width:p.w,height:p.h}),0==n.width()&&n.css({width:g,height:g/p.ratio}),$(".image-container",this).is(".list-item-avatar-cover")&&n.css(h?{width:"auto",height:"100%"}:{width:"100%",height:"auto"}),0!==n.height()&&(i.height()>n.height()||h)&&n.parent().css({marginTop:(i.outerHeight()-n.height())/2}),i.width()<n.width()&&n.parent().css({marginLeft:-(n.outerWidth()-i.width())/2+"px"});var b=Math.max(2*n.position().left,0),v=Math.max(2*n.position().top,0);if(PF.obj.listing.columns_number>6&&(b>0||v>0)){var w=b/i.width(),y=v/i.height(),_={};w<=.25&&y<=.25&&(w>y?(_.width=b+i.width(),_.height=_.width/p.ratio):(_.height=v+n.height(),_.width=_.height*p.ratio),n.css(_),n.parent().css({marginLeft:-(n.width()-i.width())/2,marginTop:0}))}a.exists()&&$("li",a).css({width:100/$("li",a).length+"%"}).css({height:$("li",a).width()}),f||l.hide()}if(!n.hasClass("jsly")&&$(this).is(":hidden")&&$(this).css("top","100%"),PF.obj.listing.columns[PF.obj.listing.current_column]+=$(this).outerHeight(!0),1==PF.obj.listing.columns_number)$(this).removeClass("position-absolute");else{$(this).is(":animated")&&(t=0),$(this).addClass("position-absolute");var P=$(this).outerWidth(!0)*(PF.obj.listing.current_column-1),F=parseInt($(this).css("left"))!=P;F&&(animate_grid=!0,$(this).animate({left:P},t));var x=PF.obj.listing.columns[PF.obj.listing.current_column]-$(this).outerHeight(!0);parseInt($(this).css("top"))!=x&&(animate_grid=!0,$(this).animate({top:x},t),F&&(c=1))}if(f&&l.show(),s||n.addClass("jsly").hide().imagesLoaded(function(e){$(e.elements).show().addClass("jsly-loaded")}),h)PF.obj.listing.current_column++;else{for(var j,C,S,H=1;H<=PF.obj.listing.columns_number;H++){if(S=PF.obj.listing.columns[H],void 0===C&&(C=S,j=H),0==PF.obj.listing.columns[H]){j=H;break}S<C&&(C=PF.obj.listing.columns[H],j=H)}PF.obj.listing.current_column=j}}),r.data({columns:PF.obj.listing.columns,current_column:PF.obj.listing.current_column});var u=0;if($.each(PF.obj.listing.columns,function(e,t){t>u&&(u=t)}),u>10&&(u-=10),PF.obj.listing.width=r.width(),void 0!==PF.obj.listing.height)var f=PF.obj.listing.height;PF.obj.listing.height=u;var h=void 0!==f&&f!==PF.obj.listing.height;h||(s.height(u),PF.fn.list_fluid_width()),h&&(s.height(f),setTimeout(function(){s.animate({height:u},t,function(){PF.fn.list_fluid_width()})},t*c)),r.data("list-mode",PF.obj.listing.mode),$(PF.obj.listing.selectors.content_listing_visible).data("queued",!1)}},PF.fn.loading={spin:{small:{lines:11,length:0,width:3,radius:7,speed:1,trail:45,blocksize:20},normal:{lines:11,length:0,width:5,radius:10,speed:1,trail:45,blocksize:30},big:{lines:11,length:0,width:7,radius:13,speed:1,trail:45,blocksize:40},huge:{lines:11,length:0,width:9,radius:16,speed:1,trail:45,blocksize:50}},inline:function(e,t){if(void 0!==e){if(e instanceof jQuery==0)var e=$(e);var o={size:"normal",color:$("body").css("color"),center:!1,position:"absolute",shadow:!1,valign:"top"};if(void 0===t)t=o;else for(var i in o)void 0===t[i]&&(t[i]=o[i]);PF.fn.loading.spin[t.size];PF.fn.loading.spin[t.size].color=t.color,PF.fn.loading.spin[t.size].shadow=t.shadow,e.html('<span class="loading-indicator"></span>'+(void 0!==t.message?'<span class="loading-text">'+t.message+"</span>":"")).css({"line-height":PF.fn.loading.spin[t.size].blocksize+"px"}),$(".loading-indicator",e).css({width:PF.fn.loading.spin[t.size].blocksize,height:PF.fn.loading.spin[t.size].blocksize}).spin(PF.fn.loading.spin[t.size]),t.center&&$(".loading-indicator",e.css("textAlign","center")).css({position:t.position,top:"50%",left:"50%",marginTop:-PF.fn.loading.spin[t.size].blocksize/2,marginLeft:-PF.fn.loading.spin[t.size].blocksize/2}),"center"==t.valign&&$(".loading-indicator,.loading-text",e).css("marginTop",(e.height()-PF.fn.loading.spin[t.size].blocksize)/2+"px"),$(".spinner",e).css({top:PF.fn.loading.spin[t.size].blocksize/2+"px",left:PF.fn.loading.spin[t.size].blocksize/2+"px"})}},fullscreen:function(){$("body").append('<div class="fullscreen" id="pf-fullscreen-loader"><div class="fullscreen-loader black-bkg"><span class="loading-txt">'+PF.fn._s("loading")+"</span></div></div>"),$(".fullscreen-loader","#pf-fullscreen-loader").spin(PF.fn.loading.spin.huge),$(".spinner","#pf-fullscreen-loader").css({top:"50%",left:"50%"}),$("#pf-fullscreen-loader").css("opacity",1)},destroy:function(e){var t=$("#pf-fullscreen-loader"),o=$("#pf-onscreen-loader");"fullscreen"==e&&(e=t),"onscreen"==e&&(e=o),void 0!==e?e.remove():(t.remove(),o.remove())}},jQuery.fn.disableForm=function(){return $(this).data("disabled",!0),$(":input",this).each(function(){$(this).attr("disabled",!0)}),this},jQuery.fn.enableForm=function(){return $(this).data("disabled",!1),$(":input",this).removeAttr("disabled"),this},PF.obj.follow_scroll={Y:0,y:0,$node:$(".follow-scroll"),node_h:0,base_h:$(".follow-scroll").outerHeight(),set:function(e){e&&(PF.obj.follow_scroll.base_h=$(".follow-scroll").outerHeight());var t=PF.obj.follow_scroll.$node.closest(".follow-scroll-wrapper").exists();t&&PF.obj.follow_scroll.$node.closest(".follow-scroll-wrapper").css("position","static"),PF.obj.follow_scroll.y=PF.obj.follow_scroll.$node.exists()?PF.obj.follow_scroll.$node.offset().top:null,PF.obj.follow_scroll.node_h=PF.obj.follow_scroll.$node.outerHeight(),t&&PF.obj.follow_scroll.$node.closest(".follow-scroll-wrapper").css("position","")},checkDocumentHeight:function(){var e,t,o=document.body.clientHeight;!function i(){e=document.body.clientHeight,o!=e&&PF.obj.follow_scroll.set(),o=e,t=setTimeout(i,200)}()}},PF.obj.follow_scroll.set(),PF.obj.follow_scroll.process=function(e){if(e&&(PF.obj.follow_scroll.node_h=PF.obj.follow_scroll.base_h),PF.obj.follow_scroll.$node.exists()){var t=PF.obj.follow_scroll.$node.closest("[data-content=follow-scroll-parent]");t.exists()||(t=PF.obj.follow_scroll.$node.closest(".content-width"));var o=PF.obj.follow_scroll.$node.closest(".follow-scroll-wrapper"),i=PF.obj.follow_scroll.node_h,n=$(window).scrollTop()>PF.obj.follow_scroll.y-i;if("fixed"!==$("#top-bar").css("position")&&(PF.obj.follow_scroll.Y-=$(window).scrollTop(),PF.obj.follow_scroll.Y<0&&(PF.obj.follow_scroll.Y=0),n=n&&$(window).scrollTop()>PF.obj.follow_scroll.y),!(n&&o.hasClass("position-fixed")||!n&&!o.hasClass("position-fixed"))){if(o.exists()||(PF.obj.follow_scroll.$node.wrapAll('<div class="follow-scroll-wrapper" />'),o=PF.obj.follow_scroll.$node.closest(".follow-scroll-wrapper")),o.css("min-height",PF.obj.follow_scroll.node_h),PF.obj.follow_scroll.Y=$("#top-bar").outerHeight(!0)+parseFloat($("#top-bar").css("top")),n){var a=PF.obj.follow_scroll.node_h;o.addClass("position-fixed").css({top:PF.obj.follow_scroll.Y}),o.next().is(".follow-scroll-placeholder")?o.parent().find(".follow-scroll-placeholder").show():o.after($('<div class="follow-scroll-placeholder" />').css("min-height",a))}else o.removeClass("position-fixed").css({top:"",width:"",minHeight:""}),o.parent().find(".follow-scroll-placeholder").hide();$("[data-show-on=follow-scroll]")[(n?"remove":"add")+"Class"]("hidden soft-hidden"),$("html").data("top-bar-box-shadow-prevent")||$("html")[(n?"add":"remove")+"Class"]("top-bar-box-shadow-none"),PF.obj.follow_scroll.$node[(n?"add":"remove")+"Class"]("content-width")}}},PF.fn.isDevice=function(e){if("object"==typeof e)e="."+e.join(",.");else var e="."+e;return $("html").is(e)},PF.fn.getDeviceName=function(){var e;return $.each(PF.obj.devices,function(t,o){if(PF.fn.isDevice(o))return e=o,!0}),e},PF.fn.topMenu={vars:{$button:$("[data-action=top-bar-menu-full]","#top-bar"),menu:"#menu-fullscreen",speed:PF.obj.config.animation.fast,menu_top:parseInt($("#top-bar").outerHeight())+parseInt($("#top-bar").css("top"))+parseInt($("#top-bar").css("margin-top"))+parseInt($("#top-bar").css("margin-bottom"))-parseInt($("#top-bar").css("border-bottom-width"))+"px"},show:function(e){if(!$("body").is(":animated")){if(void 0===e)var e=this.vars.speed;this.vars.$button.addClass("current"),$("#top-bar").css("position","fixed").append($("<div/>",{id:"menu-fullscreen",class:"touch-scroll",html:$("<ul/>",{html:$(".top-bar-left").html()+$(".top-bar-right").html()})}).css({borderTopWidth:this.vars.menu_top,left:"-100%"}));var t=$(this.vars.menu);$("li.phone-hide, li > .top-btn-text, li > .top-btn-text > span, li > a > .top-btn-text > span",t).each(function(){$(this).removeClass("phone-hide")}),$("[data-action=top-bar-menu-full]",t).remove(),$(".btn.black, .btn.default, .btn.blue, .btn.green, .btn.orange, .btn.red, .btn.transparent",t).removeClass("btn black default blue green orange red transparent"),setTimeout(function(){t.css({transform:"translate(100%, 0)"})},1),setTimeout(function(){$("html").css({backgroundColor:""})},this.vars.speed)}},hide:function(e){if(!$("body").is(":animated")&&$(this.vars.menu).is(":visible")){if(void 0===e)var e=this.vars.speed;$("#top-bar").css("position",""),this.vars.$button.removeClass("current");var t=$(this.vars.menu);t.css({transform:"none"}),setTimeout(function(){t.remove()},e)}}},function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var o=this._events=this._events||{},i=o[e]=o[e]||[];return-1==i.indexOf(t)&&i.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var o=this._onceEvents=this._onceEvents||{};return(o[e]=o[e]||{})[t]=!0,this}},t.off=function(e,t){var o=this._events&&this._events[e];if(o&&o.length){var i=o.indexOf(t);return-1!=i&&o.splice(i,1),this}},t.emitEvent=function(e,t){var o=this._events&&this._events[e];if(o&&o.length){var i=0,n=o[i];t=t||[];for(var a=this._onceEvents&&this._onceEvents[e];n;){var r=a&&a[n];r&&(this.off(e,n),delete a[n]),n.apply(this,t),n=o[i+=r?0:1]}return this}},t.allOff=t.removeAllListeners=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(o){return t(e,o)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function o(e,t){for(var o in t)e[o]=t[o];return e}function i(e){var t=[];if(Array.isArray(e))t=e;else if("number"==typeof e.length)for(var o=0;o<e.length;o++)t.push(e[o]);else t.push(e);return t}function n(e,t,a){return this instanceof n?("string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=i(e),this.options=o({},this.options),"function"==typeof t?a=t:o(this.options,t),a&&this.on("always",a),this.getImages(),s&&(this.jqDeferred=new s.Deferred),void setTimeout(function(){this.check()}.bind(this))):new n(e,t,a)}function a(e){this.img=e}function r(e,t){this.url=e,this.element=t,this.img=new Image}var s=e.jQuery,l=e.console;n.prototype=Object.create(t.prototype),n.prototype.options={},n.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},n.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&d[t]){for(var o=e.querySelectorAll("img"),i=0;i<o.length;i++){var n=o[i];this.addImage(n)}if("string"==typeof this.options.background){var a=e.querySelectorAll(this.options.background);for(i=0;i<a.length;i++){var r=a[i];this.addElementBackgroundImages(r)}}}};var d={1:!0,9:!0,11:!0};return n.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var o=/url\((['"])?(.*?)\1\)/gi,i=o.exec(t.backgroundImage);null!==i;){var n=i&&i[2];n&&this.addBackground(n,e),i=o.exec(t.backgroundImage)}},n.prototype.addImage=function(e){var t=new a(e);this.images.push(t)},n.prototype.addBackground=function(e,t){var o=new r(e,t);this.images.push(o)},n.prototype.check=function(){function e(e,o,i){setTimeout(function(){t.progress(e,o,i)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},n.prototype.progress=function(e,t,o){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&l&&l.log("progress: "+o,e,t)},n.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},a.prototype=Object.create(t.prototype),a.prototype.check=function(){return this.getIsImageComplete()?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},a.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},a.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},a.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},a.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},a.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},a.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype=Object.create(a.prototype),r.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},r.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},n.makeJQueryPlugin=function(t){(t=t||e.jQuery)&&(s=t,s.fn.imagesLoaded=function(e,t){return new n(this,e,t).jqDeferred.promise(s(this))})},n.makeJQueryPlugin(),n}),function(e){e.fn.tipTip=function(t){var o={activation:"hover",keepAlive:!1,maxWidth:"200px",edgeOffset:6,defaultPosition:"bottom",delay:400,fadeIn:200,fadeOut:200,attribute:"title",content:!1,enter:function(){},afterEnter:function(){},exit:function(){},afterExit:function(){},cssClass:""};if(e("#tiptip_holder").length<=0){var i=e('<div id="tiptip_holder"></div>'),n=e('<div id="tiptip_content"></div>'),a=e('<div id="tiptip_arrow"></div>');e("body").append(i.html(n).prepend(a.html('<div id="tiptip_arrow_inner"></div>')))}else var i=e("#tiptip_holder"),n=e("#tiptip_content"),a=e("#tiptip_arrow");return this.each(function(){function r(){if(!1!==c.enter.call(l,u)){var t;if(c.content?t=e.isFunction(c.content)?c.content.call(l,u):c.content:(t=c.content=l.attr(c.attribute),l.removeAttr(c.attribute)),t){n.html(t),i.hide().removeAttr("class").css({margin:"0px","max-width":c.maxWidth}),c.cssClass&&i.addClass(c.cssClass),a.removeAttr("style");var o=parseInt(l.offset().top),r=parseInt(l.offset().left),s=parseInt(l.outerWidth()),d=parseInt(l.outerHeight()),h=i.outerWidth(),p=i.outerHeight(),m=Math.round((s-h)/2),g=Math.round((d-p)/2),b=Math.round(r+m),v=Math.round(o+d+c.edgeOffset),$="",w="",y=Math.round(h-12)/2;"bottom"==c.defaultPosition?$="_bottom":"top"==c.defaultPosition?$="_top":"left"==c.defaultPosition?$="_left":"right"==c.defaultPosition&&($="_right");var _=m+r<parseInt(e(window).scrollLeft()),P=h+r>parseInt(e(window).width());_&&m<0||"_right"==$&&!P||"_left"==$&&r<h+c.edgeOffset+5?($="_right",w=Math.round(p-13)/2,y=-12,b=Math.round(r+s+c.edgeOffset),v=Math.round(o+g)):(P&&m<0||"_left"==$&&!_)&&($="_left",w=Math.round(p-13)/2,y=Math.round(h),b=Math.round(r-(h+c.edgeOffset+5)),v=Math.round(o+g));var F=o+d+c.edgeOffset+p+8>parseInt(e(window).height()+e(window).scrollTop()),x=o+d-(c.edgeOffset+p+8)<0;F||"_bottom"==$&&F||"_top"==$&&!x?("_top"==$||"_bottom"==$?$="_top":$+="_top",w=p,v=Math.round(o-(p+5+c.edgeOffset))):(x|("_top"==$&&x)||"_bottom"==$&&!F)&&("_top"==$||"_bottom"==$?$="_bottom":$+="_bottom",w=-12,v=Math.round(o+d+c.edgeOffset)),"_right_top"==$||"_left_top"==$?v+=5:"_right_bottom"!=$&&"_left_bottom"!=$||(v-=5),"_left_top"!=$&&"_left_bottom"!=$||(b+=5),a.css({"margin-left":y+"px","margin-top":w+"px"}),i.css({"margin-left":b+"px","margin-top":v+"px"}).addClass("tip"+$),f&&clearTimeout(f),f=setTimeout(function(){i.stop(!0,!0).fadeIn(c.fadeIn)},c.delay),c.afterEnter.call(l,u)}}}function s(){!1!==c.exit.call(l,u)&&(f&&clearTimeout(f),i.fadeOut(c.fadeOut),c.afterExit.call(l,u))}var l=e(this),d=l.data("tipTip"),c=d&&d.options||e.extend(o,t),u={holder:i,content:n,arrow:a,options:c};if(d)switch(t){case"show":r();break;case"hide":s();break;case"destroy":l.unbind(".tipTip").removeData("tipTip")}else{var f=!1;l.data("tipTip",{options:c}),"hover"==c.activation?l.bind("mouseenter.tipTip",function(){r()}).bind("mouseleave.tipTip",function(){c.keepAlive?i.one("mouseleave.tipTip",function(){s()}):s()}):"focus"==c.activation?l.bind("focus.tipTip",function(){r()}).bind("blur.tipTip",function(){s()}):"click"==c.activation?l.bind("click.tipTip",function(e){return e.preventDefault(),r(),!1}).bind("mouseleave.tipTip",function(){c.keepAlive?i.one("mouseleave.tipTip",function(){s()}):s()}):c.activation}})}}(jQuery),function(e){"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],e):e(jQuery)}(function(e){function t(t){return!t||void 0!==t.allowPageScroll||void 0===t.swipe&&void 0===t.swipeStatus||(t.allowPageScroll=d),void 0!==t.click&&void 0===t.tap&&(t.tap=t.click),t||(t={}),t=e.extend({},e.fn.swipe.defaults,t),this.each(function(){var i=e(this),n=i.data(x);n||(n=new o(this,t),i.data(x,n))})}function o(t,o){function j(t){if(!(se()||e(t.target).closest(o.excludedElements,Re).length>0)){var i,n=t.originalEvent?t.originalEvent:t,a=F?n.touches[0]:n;return Ue=w,F?Ne=n.touches.length:t.preventDefault(),Ie=0,Ee=null,ze=null,Oe=0,Le=0,Ae=0,De=1,Me=0,Be=fe(),qe=me(),ae(),!F||Ne===o.fingers||o.fingers===v||q()?(de(0,a),We=Fe(),2==Ne&&(de(1,n.touches[1]),Le=Ae=ve(Be[0].start,Be[1].start)),(o.swipeStatus||o.pinchStatus)&&(i=I(n,Ue))):i=!1,!1===i?(Ue=P,I(n,Ue),i):(le(!0),null)}}function C(e){var t=e.originalEvent?e.originalEvent:e;if(Ue!==_&&Ue!==P&&!re()){var i,n=ce(F?t.touches[0]:t);if(Qe=Fe(),F&&(Ne=t.touches.length),Ue=y,2==Ne&&(0==Le?(de(1,t.touches[1]),Le=Ae=ve(Be[0].start,Be[1].start)):(ce(t.touches[1]),Ae=ve(Be[0].end,Be[1].end),ze=we(Be[0].end,Be[1].end)),De=$e(Le,Ae),Me=Math.abs(Le-Ae)),Ne===o.fingers||o.fingers===v||!F||q()){if(Ee=Pe(n.start,n.end),M(e,Ee),Ie=ye(n.start,n.end),Oe=be(),he(Ee,Ie),(o.swipeStatus||o.pinchStatus)&&(i=I(t,Ue)),!o.triggerOnTouchEnd||o.triggerOnTouchLeave){var a=!0;if(o.triggerOnTouchLeave){var r=xe(this);a=je(n.end,r)}!o.triggerOnTouchEnd&&a?Ue=V(y):o.triggerOnTouchLeave&&!a&&(Ue=V(_)),Ue!=P&&Ue!=_||I(t,Ue)}}else I(t,Ue=P);!1===i&&I(t,Ue=P)}}function S(e){var t=e.originalEvent;return F&&t.touches.length>0?(ne(),!0):(re()&&(Ne=Je),e.preventDefault(),Qe=Fe(),Oe=be(),L()?I(t,Ue=P):o.triggerOnTouchEnd||0==o.triggerOnTouchEnd&&Ue===y?I(t,Ue=_):!o.triggerOnTouchEnd&&G()?E(t,Ue=_,h):Ue===y&&I(t,Ue=P),le(!1),null)}function H(){Ne=0,Qe=0,We=0,Le=0,Ae=0,De=1,ae(),le(!1)}function k(e){var t=e.originalEvent;o.triggerOnTouchLeave&&I(t,Ue=V(_))}function T(){Re.unbind(Se,j),Re.unbind(Ve,H),Re.unbind(He,C),Re.unbind(ke,S),Te&&Re.unbind(Te,k),le(!1)}function V(e){var t=e,i=D(),n=O(),a=L();return!i||a?t=P:!n||e!=y||o.triggerOnTouchEnd&&!o.triggerOnTouchLeave?!n&&e==_&&o.triggerOnTouchLeave&&(t=P):t=_,t}function I(e,t){var o=void 0;return B()||N()?o=E(e,t,u):(R()||q())&&!1!==o&&(o=E(e,t,f)),oe()&&!1!==o?o=E(e,t,p):ie()&&!1!==o?o=E(e,t,m):te()&&!1!==o&&(o=E(e,t,h)),t===P&&H(e),t===_&&(F?0==e.touches.length&&H(e):H(e)),o}function E(t,d,c){var g=void 0;if(c==u){if(Re.trigger("swipeStatus",[d,Ee||null,Ie||0,Oe||0,Ne]),o.swipeStatus&&!1===(g=o.swipeStatus.call(Re,t,d,Ee||null,Ie||0,Oe||0,Ne)))return!1;if(d==_&&U()){if(Re.trigger("swipe",[Ee,Ie,Oe,Ne]),o.swipe&&!1===(g=o.swipe.call(Re,t,Ee,Ie,Oe,Ne)))return!1;switch(Ee){case i:Re.trigger("swipeLeft",[Ee,Ie,Oe,Ne]),o.swipeLeft&&(g=o.swipeLeft.call(Re,t,Ee,Ie,Oe,Ne));break;case n:Re.trigger("swipeRight",[Ee,Ie,Oe,Ne]),o.swipeRight&&(g=o.swipeRight.call(Re,t,Ee,Ie,Oe,Ne));break;case a:Re.trigger("swipeUp",[Ee,Ie,Oe,Ne]),o.swipeUp&&(g=o.swipeUp.call(Re,t,Ee,Ie,Oe,Ne));break;case r:Re.trigger("swipeDown",[Ee,Ie,Oe,Ne]),o.swipeDown&&(g=o.swipeDown.call(Re,t,Ee,Ie,Oe,Ne))}}}if(c==f){if(Re.trigger("pinchStatus",[d,ze||null,Me||0,Oe||0,Ne,De]),o.pinchStatus&&!1===(g=o.pinchStatus.call(Re,t,d,ze||null,Me||0,Oe||0,Ne,De)))return!1;if(d==_&&z())switch(ze){case s:Re.trigger("pinchIn",[ze||null,Me||0,Oe||0,Ne,De]),o.pinchIn&&(g=o.pinchIn.call(Re,t,ze||null,Me||0,Oe||0,Ne,De));break;case l:Re.trigger("pinchOut",[ze||null,Me||0,Oe||0,Ne,De]),o.pinchOut&&(g=o.pinchOut.call(Re,t,ze||null,Me||0,Oe||0,Ne,De))}}return c==h?d!==P&&d!==_||(clearTimeout(Ye),J()&&!Z()?(Xe=Fe(),Ye=setTimeout(e.proxy(function(){Xe=null,Re.trigger("tap",[t.target]),o.tap&&(g=o.tap.call(Re,t,t.target))},this),o.doubleTapThreshold)):(Xe=null,Re.trigger("tap",[t.target]),o.tap&&(g=o.tap.call(Re,t,t.target)))):c==p?d!==P&&d!==_||(clearTimeout(Ye),Xe=null,Re.trigger("doubletap",[t.target]),o.doubleTap&&(g=o.doubleTap.call(Re,t,t.target))):c==m&&(d!==P&&d!==_||(clearTimeout(Ye),Xe=null,Re.trigger("longtap",[t.target]),o.longTap&&(g=o.longTap.call(Re,t,t.target)))),g}function O(){var e=!0;return null!==o.threshold&&(e=Ie>=o.threshold),e}function L(){var e=!1;return null!==o.cancelThreshold&&null!==Ee&&(e=pe(Ee)-Ie>=o.cancelThreshold),e}function A(){return null===o.pinchThreshold||Me>=o.pinchThreshold}function D(){return!o.maxTimeThreshold||!(Oe>=o.maxTimeThreshold)}function M(e,t){if(o.allowPageScroll===d||q())e.preventDefault();else{var s=o.allowPageScroll===c;switch(t){case i:(o.swipeLeft&&s||!s&&o.allowPageScroll!=g)&&e.preventDefault();break;case n:(o.swipeRight&&s||!s&&o.allowPageScroll!=g)&&e.preventDefault();break;case a:(o.swipeUp&&s||!s&&o.allowPageScroll!=b)&&e.preventDefault();break;case r:(o.swipeDown&&s||!s&&o.allowPageScroll!=b)&&e.preventDefault()}}}function z(){var e=W(),t=Q(),o=A();return e&&t&&o}function q(){return!!(o.pinchStatus||o.pinchIn||o.pinchOut)}function R(){return!(!z()||!q())}function U(){var e=D(),t=O(),o=W(),i=Q();return!L()&&i&&o&&t&&e}function N(){return!!(o.swipe||o.swipeStatus||o.swipeLeft||o.swipeRight||o.swipeUp||o.swipeDown)}function B(){return!(!U()||!N())}function W(){return Ne===o.fingers||o.fingers===v||!F}function Q(){return 0!==Be[0].end.x}function G(){return!!o.tap}function J(){return!!o.doubleTap}function X(){return!!o.longTap}function Y(){if(null==Xe)return!1;var e=Fe();return J()&&e-Xe<=o.doubleTapThreshold}function Z(){return Y()}function K(){return(1===Ne||!F)&&(isNaN(Ie)||0===Ie)}function ee(){return Oe>o.longTapThreshold&&Ie<$}function te(){return!(!K()||!G())}function oe(){return!(!Y()||!J())}function ie(){return!(!ee()||!X())}function ne(){Ge=Fe(),Je=event.touches.length+1}function ae(){Ge=0,Je=0}function re(){var e=!1;return Ge&&Fe()-Ge<=o.fingerReleaseThreshold&&(e=!0),e}function se(){return!(!0!==Re.data(x+"_intouch"))}function le(e){!0===e?(Re.bind(He,C),Re.bind(ke,S),Te&&Re.bind(Te,k)):(Re.unbind(He,C,!1),Re.unbind(ke,S,!1),Te&&Re.unbind(Te,k,!1)),Re.data(x+"_intouch",!0===e)}function de(e,t){var o=void 0!==t.identifier?t.identifier:0;return Be[e].identifier=o,Be[e].start.x=Be[e].end.x=t.pageX||t.clientX,Be[e].start.y=Be[e].end.y=t.pageY||t.clientY,Be[e]}function ce(e){var t=ue(void 0!==e.identifier?e.identifier:0);return t.end.x=e.pageX||e.clientX,t.end.y=e.pageY||e.clientY,t}function ue(e){for(var t=0;t<Be.length;t++)if(Be[t].identifier==e)return Be[t]}function fe(){for(var e=[],t=0;t<=5;t++)e.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0});return e}function he(e,t){t=Math.max(t,pe(e)),qe[e].distance=t}function pe(e){if(qe[e])return qe[e].distance}function me(){var e={};return e[i]=ge(i),e[n]=ge(n),e[a]=ge(a),e[r]=ge(r),e}function ge(e){return{direction:e,distance:0}}function be(){return Qe-We}function ve(e,t){var o=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return Math.round(Math.sqrt(o*o+i*i))}function $e(e,t){return(t/e*1).toFixed(2)}function we(){return De<1?l:s}function ye(e,t){return Math.round(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))}function _e(e,t){var o=e.x-t.x,i=t.y-e.y,n=Math.atan2(i,o),a=Math.round(180*n/Math.PI);return a<0&&(a=360-Math.abs(a)),a}function Pe(e,t){var o=_e(e,t);return o<=45&&o>=0?i:o<=360&&o>=315?i:o>=135&&o<=225?n:o>45&&o<135?r:a}function Fe(){return(new Date).getTime()}function xe(t){var o=(t=e(t)).offset();return{left:o.left,right:o.left+t.outerWidth(),top:o.top,bottom:o.top+t.outerHeight()}}function je(e,t){return e.x>t.left&&e.x<t.right&&e.y>t.top&&e.y<t.bottom}var Ce=F||!o.fallbackToMouseEvents,Se=Ce?"touchstart":"mousedown",He=Ce?"touchmove":"mousemove",ke=Ce?"touchend":"mouseup",Te=Ce?null:"mouseleave",Ve="touchcancel",Ie=0,Ee=null,Oe=0,Le=0,Ae=0,De=1,Me=0,ze=0,qe=null,Re=e(t),Ue="start",Ne=0,Be=null,We=0,Qe=0,Ge=0,Je=0,Xe=0,Ye=null;try{Re.bind(Se,j),Re.bind(Ve,H)}catch(t){e.error("events not supported "+Se+","+Ve+" on jQuery.swipe")}this.enable=function(){return Re.bind(Se,j),Re.bind(Ve,H),Re},this.disable=function(){return T(),Re},this.destroy=function(){return T(),Re.data(x,null),Re},this.option=function(t,i){if(void 0!==o[t]){if(void 0===i)return o[t];o[t]=i}else e.error("Option "+t+" does not exist on jQuery.swipe.options");return null}}var i="left",n="right",a="up",r="down",s="in",l="out",d="none",c="auto",u="swipe",f="pinch",h="tap",p="doubletap",m="longtap",g="horizontal",b="vertical",v="all",$=10,w="start",y="move",_="end",P="cancel",F="ontouchstart"in window,x="TouchSwipe",j={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"label, button, input, select, textarea, a, .noSwipe"};e.fn.swipe=function(o){var i=e(this),n=i.data(x);if(n&&"string"==typeof o){if(n[o])return n[o].apply(this,Array.prototype.slice.call(arguments,1));e.error("Method "+o+" does not exist on jQuery.swipe")}else if(!(n||"object"!=typeof o&&o))return t.apply(this,arguments);return i},e.fn.swipe.defaults=j,e.fn.swipe.phases={PHASE_START:w,PHASE_MOVE:y,PHASE_END:_,PHASE_CANCEL:P},e.fn.swipe.directions={LEFT:i,RIGHT:n,UP:a,DOWN:r,IN:s,OUT:l},e.fn.swipe.pageScroll={NONE:d,HORIZONTAL:g,VERTICAL:b,AUTO:c},e.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:v}}),function(e){"use strict";function t(e,o,i){var n,a=document.createElement("img");return a.onerror=function(n){return t.onerror(a,n,e,o,i)},a.onload=function(n){return t.onload(a,n,e,o,i)},"string"==typeof e?(t.fetchBlob(e,function(o){o?(e=o,n=t.createObjectURL(e)):(n=e,i&&i.crossOrigin&&(a.crossOrigin=i.crossOrigin)),a.src=n},i),a):t.isInstanceOf("Blob",e)||t.isInstanceOf("File",e)?(n=a._objectURL=t.createObjectURL(e))?(a.src=n,a):t.readFile(e,function(e){var t=e.target;t&&t.result?a.src=t.result:o&&o(e)}):void 0}function o(e,o){!e._objectURL||o&&o.noRevoke||(t.revokeObjectURL(e._objectURL),delete e._objectURL)}var i=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.fetchBlob=function(e,t,o){t()},t.isInstanceOf=function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},t.transform=function(e,t,o,i,n){o(e,n)},t.onerror=function(e,t,i,n,a){o(e,a),n&&n.call(e,t)},t.onload=function(e,i,n,a,r){o(e,r),a&&t.transform(e,r,a,n,{})},t.createObjectURL=function(e){return!!i&&i.createObjectURL(e)},t.revokeObjectURL=function(e){return!!i&&i.revokeObjectURL(e)},t.readFile=function(e,t,o){if(window.FileReader){var i=new FileReader;if(i.onload=i.onerror=t,o=o||"readAsDataURL",i[o])return i[o](e),i}return!1},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.loadImage=t}(window),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):e("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(e){"use strict";var t=e.transform;e.transform=function(o,i,n,a,r){t.call(e,e.scale(o,i,r),i,n,a,r)},e.transformCoordinates=function(){},e.getTransformedOptions=function(e,t){var o,i,n,a,r=t.aspectRatio;if(!r)return t;o={};for(i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);return o.crop=!0,n=e.naturalWidth||e.width,a=e.naturalHeight||e.height,n/a>r?(o.maxWidth=a*r,o.maxHeight=a):(o.maxWidth=n,o.maxHeight=n/r),o},e.renderImageToCanvas=function(e,t,o,i,n,a,r,s,l,d){return e.getContext("2d").drawImage(t,o,i,n,a,r,s,l,d),e},e.hasCanvasOption=function(e){return e.canvas||e.crop||!!e.aspectRatio},e.scale=function(t,o,i){function n(){var e=Math.max((l||y)/y,(d||_)/_);e>1&&(y*=e,_*=e)}function a(){var e=Math.min((r||y)/y,(s||_)/_);e<1&&(y*=e,_*=e)}o=o||{};var r,s,l,d,c,u,f,h,p,m,g,b=document.createElement("canvas"),v=t.getContext||e.hasCanvasOption(o)&&b.getContext,$=t.naturalWidth||t.width,w=t.naturalHeight||t.height,y=$,_=w;if(b.originalWidth=$,b.originalHeight=w,v&&(o=e.getTransformedOptions(t,o,i),f=o.left||0,h=o.top||0,o.sourceWidth?(c=o.sourceWidth,void 0!==o.right&&void 0===o.left&&(f=$-c-o.right)):c=$-f-(o.right||0),o.sourceHeight?(u=o.sourceHeight,void 0!==o.bottom&&void 0===o.top&&(h=w-u-o.bottom)):u=w-h-(o.bottom||0),y=c,_=u),r=o.maxWidth,s=o.maxHeight,l=o.minWidth,d=o.minHeight,v&&r&&s&&o.crop?(y=r,_=s,(g=c/u-r/s)<0?(u=s*c/r,void 0===o.top&&void 0===o.bottom&&(h=(w-u)/2)):g>0&&(c=r*u/s,void 0===o.left&&void 0===o.right&&(f=($-c)/2))):((o.contain||o.cover)&&(l=r=r||l,d=s=s||d),o.cover?(a(),n()):(n(),a())),v){if((p=o.pixelRatio)>1&&(b.style.width=y+"px",b.style.height=_+"px",y*=p,_*=p,b.getContext("2d").scale(p,p)),(m=o.downsamplingRatio)>0&&m<1&&y<c&&_<u)for(;c*m>y;)b.width=c*m,b.height=u*m,e.renderImageToCanvas(b,t,f,h,c,u,0,0,b.width,b.height),f=0,h=0,c=b.width,u=b.height,t=document.createElement("canvas"),t.width=c,t.height=u,e.renderImageToCanvas(t,b,0,0,c,u,0,0,c,u);return b.width=y,b.height=_,e.transformCoordinates(b,o),e.renderImageToCanvas(b,t,f,h,c,u,0,0,y,_)}return t.width=y,t.height=_,t}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):e("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(e){"use strict";var t=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.blobSlice=t&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},e.metaDataParsers={jpeg:{65505:[]}},e.parseMetaData=function(t,o,i,n){i=i||{},n=n||{};var a=this,r=i.maxMetaDataSize||262144;!!(window.DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&e.blobSlice)&&e.readFile(e.blobSlice.call(t,0,r),function(t){if(t.target.error)return console.log(t.target.error),void o(n);var r,s,l,d,c=t.target.result,u=new DataView(c),f=2,h=u.byteLength-4,p=f;if(65496===u.getUint16(0)){for(;f<h&&((r=u.getUint16(f))>=65504&&r<=65519||65534===r);){if(s=u.getUint16(f+2)+2,f+s>u.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(l=e.metaDataParsers.jpeg[r])for(d=0;d<l.length;d+=1)l[d].call(a,u,f,s,n,i);p=f+=s}!i.disableImageHead&&p>6&&(c.slice?n.imageHead=c.slice(0,p):n.imageHead=new Uint8Array(c).subarray(0,p))}else console.log("Invalid JPEG file: Missing JPEG marker.");o(n)},"readAsArrayBuffer")||o(n)},e.hasMetaOption=function(e){return e&&e.meta};var o=e.transform;e.transform=function(t,i,n,a,r){e.hasMetaOption(i)?e.parseMetaData(a,function(r){o.call(e,t,i,n,a,r)},i,r):o.apply(e,arguments)}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(e){"use strict";"fetch"in window&&"Request"in window&&(e.fetchBlob=function(t,o,i){return e.hasMetaOption(i)?fetch(new Request(t,i)).then(function(e){return e.blob()}).then(o).catch(function(e){console.log(e),o()}):void o()})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(e){"use strict";e.ExifMap=function(){return this},e.ExifMap.prototype.map={Orientation:274},e.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},e.getExifThumbnail=function(e,t,o){var i,n,a;{if(o&&!(t+o>e.byteLength)){for(i=[],n=0;n<o;n+=1)a=e.getUint8(t+n),i.push((a<16?"0":"")+a.toString(16));return"data:image/jpeg,%"+i.join("%")}console.log("Invalid Exif data: Invalid thumbnail data.")}},e.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,o){return e.getUint16(t,o)},size:2},4:{getValue:function(e,t,o){return e.getUint32(t,o)},size:4},5:{getValue:function(e,t,o){return e.getUint32(t,o)/e.getUint32(t+4,o)},size:8},9:{getValue:function(e,t,o){return e.getInt32(t,o)},size:4},10:{getValue:function(e,t,o){return e.getInt32(t,o)/e.getInt32(t+4,o)},size:8}},e.exifTagTypes[7]=e.exifTagTypes[1],e.getExifValue=function(t,o,i,n,a,r){var s,l,d,c,u,f,h=e.exifTagTypes[n];if(h){if(s=h.size*a,!((l=s>4?o+t.getUint32(i+8,r):i+8)+s>t.byteLength)){if(1===a)return h.getValue(t,l,r);for(d=[],c=0;c<a;c+=1)d[c]=h.getValue(t,l+c*h.size,r);if(h.ascii){for(u="",c=0;c<d.length&&"\0"!==(f=d[c]);c+=1)u+=f;return u}return d}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")},e.parseExifTag=function(t,o,i,n,a){var r=t.getUint16(i,n);a.exif[r]=e.getExifValue(t,o,i,t.getUint16(i+2,n),t.getUint32(i+4,n),n)},e.parseExifTags=function(e,t,o,i,n){var a,r,s;if(o+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(a=e.getUint16(o,i),!((r=o+2+12*a)+4>e.byteLength)){for(s=0;s<a;s+=1)this.parseExifTag(e,t,o+2+12*s,i,n);return e.getUint32(r,i)}console.log("Invalid Exif data: Invalid directory size.")}},e.parseExifData=function(t,o,i,n,a){if(!a.disableExif){var r,s,l,d=o+10;if(1165519206===t.getUint32(o+4)){if(d+8>t.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==t.getUint16(o+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(t.getUint16(d)){case 18761:r=!0;break;case 19789:r=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==t.getUint16(d+2,r))return void console.log("Invalid Exif data: Missing TIFF marker.");s=t.getUint32(d+4,r),n.exif=new e.ExifMap,(s=e.parseExifTags(t,d,d+s,r,n))&&!a.disableExifThumbnail&&(l={exif:{}},s=e.parseExifTags(t,d,d+s,r,l),l.exif[513]&&(n.exif.Thumbnail=e.getExifThumbnail(t,d+l.exif[513],l.exif[514]))),n.exif[34665]&&!a.disableExifSub&&e.parseExifTags(t,d,d+n.exif[34665],r,n),n.exif[34853]&&!a.disableExifGps&&e.parseExifTags(t,d,d+n.exif[34853],r,n)}}},e.metaDataParsers.jpeg[65505].push(e.parseExifData)}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-exif"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-exif")):e(window.loadImage)}(function(e){"use strict";e.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},e.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},e.ExifMap.prototype.getText=function(e){var t=this.get(e);switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[e][t];case"ExifVersion":case"FlashpixVersion":if(!t)return;return String.fromCharCode(t[0],t[1],t[2],t[3]);case"ComponentsConfiguration":if(!t)return;return this.stringValues[e][t[0]]+this.stringValues[e][t[1]]+this.stringValues[e][t[2]]+this.stringValues[e][t[3]];case"GPSVersionID":if(!t)return;return t[0]+"."+t[1]+"."+t[2]+"."+t[3]}return String(t)},function(e){var t,o=e.tags,i=e.map;for(t in o)o.hasOwnProperty(t)&&(i[o[t]]=t)}(e.ExifMap.prototype),e.ExifMap.prototype.getAll=function(){var e,t,o={};for(e in this)this.hasOwnProperty(e)&&(t=this.tags[e])&&(o[t]=this.getText(t));return o}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-scale","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-scale"),require("./load-image-meta")):e(window.loadImage)}(function(e){"use strict";var t=e.hasCanvasOption,o=e.hasMetaOption,i=e.transformCoordinates,n=e.getTransformedOptions;e.hasCanvasOption=function(o){return!!o.orientation||t.call(e,o)},e.hasMetaOption=function(t){return t&&!0===t.orientation||o.call(e,t)},e.transformCoordinates=function(t,o){i.call(e,t,o);var n=t.getContext("2d"),a=t.width,r=t.height,s=t.style.width,l=t.style.height,d=o.orientation;if(d&&!(d>8))switch(d>4&&(t.width=r,t.height=a,t.style.width=l,t.style.height=s),d){case 2:n.translate(a,0),n.scale(-1,1);break;case 3:n.translate(a,r),n.rotate(Math.PI);break;case 4:n.translate(0,r),n.scale(1,-1);break;case 5:n.rotate(.5*Math.PI),n.scale(1,-1);break;case 6:n.rotate(.5*Math.PI),n.translate(0,-r);break;case 7:n.rotate(.5*Math.PI),n.translate(a,-r),n.scale(-1,1);break;case 8:n.rotate(-.5*Math.PI),n.translate(-a,0)}},e.getTransformedOptions=function(t,o,i){var a,r,s=n.call(e,t,o),l=s.orientation;if(!0===l&&i&&i.exif&&(l=i.exif.get("Orientation")),!l||l>8||1===l)return s;a={};for(r in s)s.hasOwnProperty(r)&&(a[r]=s[r]);switch(a.orientation=l,l){case 2:a.left=s.right,a.right=s.left;break;case 3:a.left=s.right,a.top=s.bottom,a.right=s.left,a.bottom=s.top;break;case 4:a.top=s.bottom,a.bottom=s.top;break;case 5:a.left=s.top,a.top=s.left,a.right=s.bottom,a.bottom=s.right;break;case 6:a.left=s.top,a.top=s.right,a.right=s.bottom,a.bottom=s.left;break;case 7:a.left=s.bottom,a.top=s.right,a.right=s.top,a.bottom=s.left;break;case 8:a.left=s.bottom,a.top=s.left,a.right=s.top,a.bottom=s.right}return a.orientation>4&&(a.maxWidth=s.maxHeight,a.maxHeight=s.maxWidth,a.minWidth=s.minHeight,a.minHeight=s.minWidth,a.sourceWidth=s.sourceHeight,a.sourceHeight=s.sourceWidth),a}}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var o,i,n,a,r,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(a=l.length,o=0;o<a;o+=1)r[o]=str(o,l)||"null";return n=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+s+"]":"["+r.join(",")+"]",gap=s,n}if(rep&&"object"==typeof rep)for(a=rep.length,o=0;o<a;o+=1)"string"==typeof rep[o]&&(i=rep[o],(n=str(i,l))&&r.push(quote(i)+(gap?": ":":")+n));else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(n=str(i,l))&&r.push(quote(i)+(gap?": ":":")+n);return n=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+s+"}":"{"+r.join(",")+"}",gap=s,n}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,o){var i;if(gap="",indent="","number"==typeof o)for(i=0;i<o;i+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var o,i,n=e[t];if(n&&"object"==typeof n)for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(void 0!==(i=walk(n,o))?n[o]=i:delete n[o]);return reviver.call(e,t,n)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var o=e.History=e.History||{},i=e.jQuery;if(void 0!==o.Adapter)throw new Error("History.js Adapter has already been loaded...");o.Adapter={bind:function(e,t,o){i(e).bind(t,o)},trigger:function(e,t,o){i(e).trigger(t,o)},extractEventData:function(e,t,o){return t&&t.originalEvent&&t.originalEvent[e]||o&&o[e]||void 0},onDomLoad:function(e){i(e)}},void 0!==o.init&&o.init()}(window),function(e,t){"use strict";var o=e.document,i=e.setTimeout||i,n=e.clearTimeout||n,a=e.setInterval||a,r=e.History=e.History||{};if(void 0!==r.initHtml4)throw new Error("History.js HTML4 Support has already been loaded...");r.initHtml4=function(){if(void 0!==r.initHtml4.initialized)return!1;r.initHtml4.initialized=!0,r.enabled=!0,r.savedHashes=[],r.isLastHash=function(e){return e===r.getHashByIndex()},r.isHashEqual=function(e,t){return e=encodeURIComponent(e).replace(/%25/g,"%"),t=encodeURIComponent(t).replace(/%25/g,"%"),e===t},r.saveHash=function(e){return!r.isLastHash(e)&&(r.savedHashes.push(e),!0)},r.getHashByIndex=function(e){return void 0===e?r.savedHashes[r.savedHashes.length-1]:e<0?r.savedHashes[r.savedHashes.length+e]:r.savedHashes[e]},r.discardedHashes={},r.discardedStates={},r.discardState=function(e,t,o){var i,n=r.getHashByState(e);return i={discardedState:e,backState:o,forwardState:t},r.discardedStates[n]=i,!0},r.discardHash=function(e,t,o){var i={discardedHash:e,backState:o,forwardState:t};return r.discardedHashes[e]=i,!0},r.discardedState=function(e){var t=r.getHashByState(e);return r.discardedStates[t]||!1},r.discardedHash=function(e){return r.discardedHashes[e]||!1},r.recycleState=function(e){var t=r.getHashByState(e);return r.discardedState(e)&&delete r.discardedStates[t],!0},r.emulated.hashChange&&(r.hashChangeInit=function(){r.checkerFunction=null;var t,i,n,s,l="",d=Boolean(r.getHash());return r.isInternetExplorer()?(t="historyjs-iframe",(i=o.createElement("iframe")).setAttribute("id",t),i.setAttribute("src","#"),i.style.display="none",o.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),n="",s=!1,r.checkerFunction=function(){if(s)return!1;s=!0;var t=r.getHash(),o=r.getHash(i.contentWindow.document);return t!==l?(l=t,o!==t&&(n=o=t,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=r.escapeHash(t)),r.Adapter.trigger(e,"hashchange")):o!==n&&(n=o,d&&""===o?r.back():r.setHash(o,!1)),s=!1,!0}):r.checkerFunction=function(){var t=r.getHash()||"";return t!==l&&(l=t,r.Adapter.trigger(e,"hashchange")),!0},r.intervalList.push(a(r.checkerFunction,r.options.hashChangeInterval)),!0},r.Adapter.onDomLoad(r.hashChangeInit)),r.emulated.pushState&&(r.onHashChange=function(t){var o,i=t&&t.newURL||r.getLocationHref(),n=r.getHashByUrl(i),a=null;return r.isLastHash(n)?(r.busy(!1),!1):(r.doubleCheckComplete(),r.saveHash(n),n&&r.isTraditionalAnchor(n)?(r.Adapter.trigger(e,"anchorchange"),r.busy(!1),!1):(a=r.extractState(r.getFullUrl(n||r.getLocationHref()),!0),r.isLastSavedState(a)?(r.busy(!1),!1):(r.getHashByState(a),(o=r.discardedState(a))?(r.getHashByIndex(-2)===r.getHashByState(o.forwardState)?r.back(!1):r.forward(!1),!1):(r.pushState(a.data,a.title,encodeURI(a.url),!1),!0))))},r.Adapter.bind(e,"hashchange",r.onHashChange),r.pushState=function(t,o,i,n){if(i=encodeURI(i).replace(/%25/g,"%"),r.getHashByUrl(i))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(!1!==n&&r.busy())return r.pushQueue({scope:r,callback:r.pushState,args:arguments,queue:n}),!1;r.busy(!0);var a=r.createStateObject(t,o,i),s=r.getHashByState(a),l=r.getState(!1),d=r.getHashByState(l),c=r.getHash(),u=r.expectedStateId==a.id;return r.storeState(a),r.expectedStateId=a.id,r.recycleState(a),r.setTitle(a),s===d?(r.busy(!1),!1):(r.saveState(a),u||r.Adapter.trigger(e,"statechange"),!r.isHashEqual(s,c)&&!r.isHashEqual(s,r.getShortUrl(r.getLocationHref()))&&r.setHash(s,!1),r.busy(!1),!0)},r.replaceState=function(t,o,i,n){if(i=encodeURI(i).replace(/%25/g,"%"),r.getHashByUrl(i))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(!1!==n&&r.busy())return r.pushQueue({scope:r,callback:r.replaceState,args:arguments,queue:n}),!1;r.busy(!0);var a=r.createStateObject(t,o,i),s=r.getHashByState(a),l=r.getState(!1),d=r.getHashByState(l),c=r.getStateByIndex(-2);return r.discardState(l,a,c),s===d?(r.storeState(a),r.expectedStateId=a.id,r.recycleState(a),r.setTitle(a),r.saveState(a),r.Adapter.trigger(e,"statechange"),r.busy(!1)):r.pushState(a.data,a.title,a.url,!1),!0}),r.emulated.pushState&&r.getHash()&&!r.emulated.hashChange&&r.Adapter.onDomLoad(function(){r.Adapter.trigger(e,"hashchange")})},void 0!==r.init&&r.init()}(window),function(e,t){"use strict";var o=e.console||t,i=e.document,n=e.navigator,a=!1,r=e.setTimeout,s=e.clearTimeout,l=e.setInterval,d=e.clearInterval,c=e.JSON,u=e.alert,f=e.History=e.History||{},h=e.history;try{(a=e.sessionStorage).setItem("TEST","1"),a.removeItem("TEST")}catch(e){a=!1}if(c.stringify=c.stringify||c.encode,c.parse=c.parse||c.decode,void 0!==f.init)throw new Error("History.js Core has already been loaded...");f.init=function(e){return void 0!==f.Adapter&&(void 0!==f.initCore&&f.initCore(),void 0!==f.initHtml4&&f.initHtml4(),!0)},f.initCore=function(p){if(void 0!==f.initCore.initialized)return!1;if(f.initCore.initialized=!0,f.options=f.options||{},f.options.hashChangeInterval=f.options.hashChangeInterval||100,f.options.safariPollInterval=f.options.safariPollInterval||500,f.options.doubleCheckInterval=f.options.doubleCheckInterval||500,f.options.disableSuid=f.options.disableSuid||!1,f.options.storeInterval=f.options.storeInterval||1e3,f.options.busyDelay=f.options.busyDelay||250,f.options.debug=f.options.debug||!1,f.options.initialTitle=f.options.initialTitle||i.title,f.options.html4Mode=f.options.html4Mode||!1,f.options.delayInit=f.options.delayInit||!1,f.intervalList=[],f.clearAllIntervals=function(){var e,t=f.intervalList;if(void 0!==t&&null!==t){for(e=0;e<t.length;e++)d(t[e]);f.intervalList=null}},f.debug=function(){(f.options.debug||!1)&&f.log.apply(f,arguments)},f.log=function(){var e,t,n,a,r,s=void 0!==o&&void 0!==o.log&&void 0!==o.log.apply,l=i.getElementById("log");for(s?(a=Array.prototype.slice.call(arguments),e=a.shift(),void 0!==o.debug?o.debug.apply(o,[e,a]):o.log.apply(o,[e,a])):e="\n"+arguments[0]+"\n",t=1,n=arguments.length;t<n;++t){if("object"==typeof(r=arguments[t])&&void 0!==c)try{r=c.stringify(r)}catch(e){}e+="\n"+r+"\n"}return l?(l.value+=e+"\n-----\n",l.scrollTop=l.scrollHeight-l.clientHeight):s||u(e),!0},f.getInternetExplorerMajorVersion=function(){return f.getInternetExplorerMajorVersion.cached=void 0!==f.getInternetExplorerMajorVersion.cached?f.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=i.createElement("div"),o=t.getElementsByTagName("i");(t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e")&&o[0];);return e>4&&e}()},f.isInternetExplorer=function(){return f.isInternetExplorer.cached=void 0!==f.isInternetExplorer.cached?f.isInternetExplorer.cached:Boolean(f.getInternetExplorerMajorVersion())},f.options.html4Mode?f.emulated={pushState:!0,hashChange:!0}:f.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(n.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(n.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in i)||f.isInternetExplorer()&&f.getInternetExplorerMajorVersion()<8)},f.enabled=!f.emulated.pushState,f.bugs={setHash:Boolean(!f.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),safariPoll:Boolean(!f.emulated.pushState&&"Apple Computer, Inc."===n.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(n.userAgent)),ieDoubleCheck:Boolean(f.isInternetExplorer()&&f.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(f.isInternetExplorer()&&f.getInternetExplorerMajorVersion()<7)},f.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},f.cloneObject=function(e){var t,o;return e?(t=c.stringify(e),o=c.parse(t)):o={},o},f.getRootUrl=function(){var e=i.location.protocol+"//"+(i.location.hostname||i.location.host);return i.location.port&&(e+=":"+i.location.port),e+="/"},f.getBaseHref=function(){var e=i.getElementsByTagName("base"),t=null,o="";return 1===e.length&&(t=e[0],o=t.href.replace(/[^\/]+$/,"")),(o=o.replace(/\/+$/,""))&&(o+="/"),o},f.getBaseUrl=function(){return f.getBaseHref()||f.getBasePageUrl()||f.getRootUrl()},f.getPageUrl=function(){return((f.getState(!1,!1)||{}).url||f.getLocationHref()).replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,o){return/\./.test(e)?e:e+"/"})},f.getBasePageUrl=function(){return f.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,o){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/"},f.getFullUrl=function(e,t){var o=e,i=e.substring(0,1);return t=void 0===t||t,/[a-z]+\:\/\//.test(e)||(o="/"===i?f.getRootUrl()+e.replace(/^\/+/,""):"#"===i?f.getPageUrl().replace(/#.*/,"")+e:"?"===i?f.getPageUrl().replace(/[\?#].*/,"")+e:t?f.getBaseUrl()+e.replace(/^(\.\/)+/,""):f.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),o.replace(/\#$/,"")},f.getShortUrl=function(e){var t=e,o=f.getBaseUrl(),i=f.getRootUrl();return f.emulated.pushState&&(t=t.replace(o,"")),t=t.replace(i,"/"),f.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},f.getLocationHref=function(e){return(e=e||i).URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:-1==e.URL.indexOf("#")&&-1!=e.location.href.indexOf("#")?e.location.href:e.URL||e.location.href},f.store={},f.idToState=f.idToState||{},f.stateToId=f.stateToId||{},f.urlToId=f.urlToId||{},f.storedStates=f.storedStates||[],f.savedStates=f.savedStates||[],f.normalizeStore=function(){f.store.idToState=f.store.idToState||{},f.store.urlToId=f.store.urlToId||{},f.store.stateToId=f.store.stateToId||{}},f.getState=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var o=f.getLastSavedState();return!o&&t&&(o=f.createStateObject()),e&&(o=f.cloneObject(o),o.url=o.cleanUrl||o.url),o},f.getIdByState=function(e){var t,o=f.extractId(e.url);if(!o)if(t=f.getStateString(e),void 0!==f.stateToId[t])o=f.stateToId[t];else if(void 0!==f.store.stateToId[t])o=f.store.stateToId[t];else{for(;o=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),void 0!==f.idToState[o]||void 0!==f.store.idToState[o];);f.stateToId[t]=o,f.idToState[o]=e}return o},f.normalizeState=function(e){var t,o;return e&&"object"==typeof e||(e={}),void 0!==e.normalized?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=f.getFullUrl(e.url?e.url:f.getLocationHref()),t.hash=f.getShortUrl(t.url),t.data=f.cloneObject(e.data),t.id=f.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,o=!f.isEmptyObject(t.data),(t.title||o)&&!0!==f.options.disableSuid&&(t.hash=f.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=f.getFullUrl(t.hash),(f.emulated.pushState||f.bugs.safariPoll)&&f.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},f.createStateObject=function(e,t,o){var i={data:e,title:t,url:o};return i=f.normalizeState(i)},f.getStateById=function(e){return e=String(e),f.idToState[e]||f.store.idToState[e]||t},f.getStateString=function(e){var t,o;return t=f.normalizeState(e),o={data:t.data,title:e.title,url:e.url},c.stringify(o)},f.getStateId=function(e){var t;return t=f.normalizeState(e),t.id},f.getHashByState=function(e){var t;return t=f.normalizeState(e),t.hash},f.extractId=function(e){var t,o;return o=-1!=e.indexOf("#")?e.split("#")[0]:e,t=/(.*)\&_suid=([0-9]+)$/.exec(o),t?t[1]||e:e,(t?String(t[2]||""):"")||!1},f.isTraditionalAnchor=function(e){return!/[\/\?\.]/.test(e)},f.extractState=function(e,t){var o,i,n=null;return t=t||!1,(o=f.extractId(e))&&(n=f.getStateById(o)),n||(i=f.getFullUrl(e),(o=f.getIdByUrl(i)||!1)&&(n=f.getStateById(o)),!n&&t&&!f.isTraditionalAnchor(e)&&(n=f.createStateObject(null,null,i))),n},f.getIdByUrl=function(e){return f.urlToId[e]||f.store.urlToId[e]||t},f.getLastSavedState=function(){return f.savedStates[f.savedStates.length-1]||t},f.getLastStoredState=function(){return f.storedStates[f.storedStates.length-1]||t},f.hasUrlDuplicate=function(e){var t;return t=f.extractState(e.url),t&&t.id!==e.id},f.storeState=function(e){return f.urlToId[e.url]=e.id,f.storedStates.push(f.cloneObject(e)),e},f.isLastSavedState=function(e){var t,o,i,n=!1;return f.savedStates.length&&(t=e.id,o=f.getLastSavedState(),i=o.id,n=t===i),n},f.saveState=function(e){return!f.isLastSavedState(e)&&(f.savedStates.push(f.cloneObject(e)),!0)},f.getStateByIndex=function(e){return void 0===e?f.savedStates[f.savedStates.length-1]:e<0?f.savedStates[f.savedStates.length+e]:f.savedStates[e]},f.getCurrentIndex=function(){return f.savedStates.length<1?0:f.savedStates.length-1},f.getHash=function(e){var t=f.getLocationHref(e);return f.getHashByUrl(t)},f.unescapeHash=function(e){var t=f.normalizeHash(e);return t=decodeURIComponent(t)},f.normalizeHash=function(e){return e.replace(/[^#]*#/,"").replace(/#.*/,"")},f.setHash=function(e,t){var o,n;return!1!==t&&f.busy()?(f.pushQueue({scope:f,callback:f.setHash,args:arguments,queue:t}),!1):(f.busy(!0),(o=f.extractState(e,!0))&&!f.emulated.pushState?f.pushState(o.data,o.title,o.url,!1):f.getHash()!==e&&(f.bugs.setHash?(n=f.getPageUrl(),f.pushState(null,null,n+"#"+e,!1)):i.location.hash=e),f)},f.escapeHash=function(t){var o=f.normalizeHash(t);return o=e.encodeURIComponent(o),f.bugs.hashEscape||(o=o.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),o},f.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=f.unescapeHash(t)},f.setTitle=function(e){var t,o=e.title;o||(t=f.getStateByIndex(0))&&t.url===e.url&&(o=t.title||f.options.initialTitle);try{i.getElementsByTagName("title")[0].innerHTML=o.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}return i.title=o,f},f.queues=[],f.busy=function(e){if(void 0!==e?f.busy.flag=e:void 0===f.busy.flag&&(f.busy.flag=!1),!f.busy.flag){s(f.busy.timeout);var t=function(){var e,o,i;if(!f.busy.flag)for(e=f.queues.length-1;e>=0;--e)0!==(o=f.queues[e]).length&&(i=o.shift(),f.fireQueueItem(i),f.busy.timeout=r(t,f.options.busyDelay))};f.busy.timeout=r(t,f.options.busyDelay)}return f.busy.flag},f.busy.flag=!1,f.fireQueueItem=function(e){return e.callback.apply(e.scope||f,e.args||[])},f.pushQueue=function(e){return f.queues[e.queue||0]=f.queues[e.queue||0]||[],f.queues[e.queue||0].push(e),f},f.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),void 0!==t&&(e.queue=t),f.busy()?f.pushQueue(e):f.fireQueueItem(e),f},f.clearQueue=function(){return f.busy.flag=!1,f.queues=[],f},f.stateChanged=!1,f.doubleChecker=!1,f.doubleCheckComplete=function(){return f.stateChanged=!0,f.doubleCheckClear(),f},f.doubleCheckClear=function(){return f.doubleChecker&&(s(f.doubleChecker),f.doubleChecker=!1),f},f.doubleCheck=function(e){return f.stateChanged=!1,f.doubleCheckClear(),f.bugs.ieDoubleCheck&&(f.doubleChecker=r(function(){return f.doubleCheckClear(),f.stateChanged||e(),!0},f.options.doubleCheckInterval)),f},f.safariStatePoll=function(){var t=f.extractState(f.getLocationHref());if(!f.isLastSavedState(t))return t||f.createStateObject(),f.Adapter.trigger(e,"popstate"),f},f.back=function(e){return!1!==e&&f.busy()?(f.pushQueue({scope:f,callback:f.back,args:arguments,queue:e}),!1):(f.busy(!0),f.doubleCheck(function(){f.back(!1)}),h.go(-1),!0)},f.forward=function(e){return!1!==e&&f.busy()?(f.pushQueue({scope:f,callback:f.forward,args:arguments,queue:e}),!1):(f.busy(!0),f.doubleCheck(function(){f.forward(!1)}),h.go(1),!0)},f.go=function(e,t){var o;if(e>0)for(o=1;o<=e;++o)f.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(o=-1;o>=e;--o)f.back(t)}return f},f.emulated.pushState){var m=function(){};f.pushState=f.pushState||m,f.replaceState=f.replaceState||m}else f.onPopState=function(t,o){var i,n,a=!1,r=!1;return f.doubleCheckComplete(),(i=f.getHash())?((n=f.extractState(i||f.getLocationHref(),!0))?f.replaceState(n.data,n.title,n.url,!1):(f.Adapter.trigger(e,"anchorchange"),f.busy(!1)),f.expectedStateId=!1,!1):(a=f.Adapter.extractEventData("state",t,o)||!1,(r=a?f.getStateById(a):f.expectedStateId?f.getStateById(f.expectedStateId):f.extractState(f.getLocationHref()))||(r=f.createStateObject(null,null,f.getLocationHref())),f.expectedStateId=!1,f.isLastSavedState(r)?(f.busy(!1),!1):(f.storeState(r),f.saveState(r),f.setTitle(r),f.Adapter.trigger(e,"statechange"),f.busy(!1),!0))},f.Adapter.bind(e,"popstate",f.onPopState),f.pushState=function(t,o,i,n){if(f.getHashByUrl(i)&&f.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==n&&f.busy())return f.pushQueue({scope:f,callback:f.pushState,args:arguments,queue:n}),!1;f.busy(!0);var a=f.createStateObject(t,o,i);return f.isLastSavedState(a)?f.busy(!1):(f.storeState(a),f.expectedStateId=a.id,h.pushState(a.id,a.title,a.url),f.Adapter.trigger(e,"popstate")),!0},f.replaceState=function(t,o,i,n){if(f.getHashByUrl(i)&&f.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==n&&f.busy())return f.pushQueue({scope:f,callback:f.replaceState,args:arguments,queue:n}),!1;f.busy(!0);var a=f.createStateObject(t,o,i);return f.isLastSavedState(a)?f.busy(!1):(f.storeState(a),f.expectedStateId=a.id,h.replaceState(a.id,a.title,a.url),f.Adapter.trigger(e,"popstate")),!0};if(a){try{f.store=c.parse(a.getItem("History.store"))||{}}catch(e){f.store={}}f.normalizeStore()}else f.store={},f.normalizeStore();f.Adapter.bind(e,"unload",f.clearAllIntervals),f.saveState(f.storeState(f.extractState(f.getLocationHref(),!0))),a&&(f.onUnload=function(){var e,t,o;try{e=c.parse(a.getItem("History.store"))||{}}catch(t){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in f.idToState)f.idToState.hasOwnProperty(t)&&(e.idToState[t]=f.idToState[t]);for(t in f.urlToId)f.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=f.urlToId[t]);for(t in f.stateToId)f.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=f.stateToId[t]);f.store=e,f.normalizeStore(),o=c.stringify(e);try{a.setItem("History.store",o)}catch(e){if(e.code!==DOMException.QUOTA_EXCEEDED_ERR)throw e;a.length&&(a.removeItem("History.store"),a.setItem("History.store",o))}},f.intervalList.push(l(f.onUnload,f.options.storeInterval)),f.Adapter.bind(e,"beforeunload",f.onUnload),f.Adapter.bind(e,"unload",f.onUnload)),f.emulated.pushState||(f.bugs.safariPoll&&f.intervalList.push(l(f.safariStatePoll,f.options.safariPollInterval)),"Apple Computer, Inc."!==n.vendor&&"Mozilla"!==(n.appCodeName||"")||(f.Adapter.bind(e,"hashchange",function(){f.Adapter.trigger(e,"popstate")}),f.getHash()&&f.Adapter.onDomLoad(function(){f.Adapter.trigger(e,"hashchange")})))},(!f.options||!f.options.delayInit)&&f.init()}(window),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(o){if(o.async){var i,n,a;return{send:function(r,s){(i=e('<form style="display:none;"></form>')).attr("accept-charset",o.formAcceptCharset),a=/\?/.test(o.url)?"&":"?","DELETE"===o.type?(o.url=o.url+a+"_method=DELETE",o.type="POST"):"PUT"===o.type?(o.url=o.url+a+"_method=PUT",o.type="POST"):"PATCH"===o.type&&(o.url=o.url+a+"_method=PATCH",o.type="POST"),n=e('<iframe src="javascript:false;" name="iframe-transport-'+(t+=1)+'"></iframe>').bind("load",function(){var t,a=e.isArray(o.paramName)?o.paramName:[o.paramName];n.unbind("load").bind("load",function(){var t;try{if(!(t=n.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}s(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",n.prop("name")).prop("action",o.url).prop("method",o.type),o.formData&&e.each(o.formData,function(t,o){e('<input type="hidden"/>').prop("name",o.name).val(o.value).appendTo(i)}),o.fileInput&&o.fileInput.length&&"POST"===o.type&&(t=o.fileInput.clone(),o.fileInput.after(function(e){return t[e]}),o.paramName&&o.fileInput.each(function(t){e(this).prop("name",a[t]||o.paramName)}),i.append(o.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),i.submit(),t&&t.length&&o.fileInput.each(function(o,i){var n=e(t[o]);e(i).prop("name",n.prop("name")),n.replaceWith(i)})}),i.append(n).appendTo(document.body)},abort:function(){n&&n.unbind("load").prop("src","javascript".concat(":false;")),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var o=t&&t[0];return o&&e.isXMLDoc(o)?o:e.parseXML(o.XMLDocument&&o.XMLDocument.xml||e(o.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var o,i=document.createElement(e||"div");for(o in t)i[o]=t[o];return i}function t(e){for(var t=1,o=arguments.length;o>t;t++)e.appendChild(arguments[t]);return e}function o(e,t,o,i){var n=["opacity",t,~~(100*e),o,i].join("-"),a=.01+o/i*100,r=Math.max(1-(1-e)/t*(100-a),e),s=l.substring(0,l.indexOf("Animation")).toLowerCase(),c=s&&"-"+s+"-"||"";return u[n]||(d.insertRule("@"+c+"keyframes "+n+"{0%{opacity:"+r+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+t)%100+"%{opacity:"+e+"}100%{opacity:"+r+"}}",d.cssRules.length),u[n]=1),n}function i(e,t){var o,i,n=e.style;if(t=t.charAt(0).toUpperCase()+t.slice(1),void 0!==n[t])return t;for(i=0;i<c.length;i++)if(o=c[i]+t,void 0!==n[o])return o}function n(e,t){for(var o in t)e.style[i(e,o)||o]=t[o];return e}function a(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)void 0===e[i]&&(e[i]=o[i])}return e}function r(e,t){return"string"==typeof e?e:e[t%e.length]}function s(e){this.opts=a(e||{},s.defaults,f)}var l,d,c=["webkit","Moz","ms","O"],u={},f={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",shadow:!1,hwaccel:!1,position:"relative"};if(s.defaults={},a(s.prototype,{spin:function(t){this.stop();var o=this,i=o.opts,a=o.el=e(null,{className:i.className});if(n(a,{position:i.position,width:0,zIndex:i.zIndex,left:i.left,top:i.top}),t&&t.insertBefore(a,t.firstChild||null),a.setAttribute("role","progressbar"),o.lines(a,o.opts),!l){var r,s=0,d=(i.lines-1)*(1-i.direction)/2,c=i.fps,u=c/i.speed,f=(1-i.opacity)/(u*i.trail/100),h=u/i.lines;!function e(){s++;for(var t=0;t<i.lines;t++)r=Math.max(1-(s+(i.lines-t)*h)%u*f,i.opacity),o.opacity(a,t*i.direction+d,r,i);o.timeout=o.el&&setTimeout(e,~~(1e3/c))}()}return o},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(i,a){function s(t,o){return n(e(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:t,boxShadow:o,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*c+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var d,c=0,u=(a.lines-1)*(1-a.direction)/2;c<a.lines;c++)d=n(e(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:l&&o(a.opacity,a.trail,u+c*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&t(d,n(s("#000","0 0 4px #000"),{top:"2px"})),t(i,t(d,s(r(a.color,c),"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(e,t,o){t<e.childNodes.length&&(e.childNodes[t].style.opacity=o)}}),"undefined"!=typeof document){d=function(){var o=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],o),o.sheet||o.styleSheet}();var h=n(e("group"),{behavior:"url(#default#VML)"});!i(h,"transform")&&h.adj?function(){function o(t,o){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',o)}d.addRule(".spin-vml","behavior:url(#default#VML)"),s.prototype.lines=function(e,i){function a(){return n(o("group",{coordsize:c+" "+c,coordorigin:-d+" "+-d}),{width:c,height:c})}function s(e,s,l){t(f,t(n(a(),{rotation:360/i.lines*e+"deg",left:~~s}),t(n(o("roundrect",{arcsize:i.corners}),{width:d,height:i.scale*i.width,left:i.scale*i.radius,top:-i.scale*i.width>>1,filter:l}),o("fill",{color:r(i.color,e),opacity:i.opacity}),o("stroke",{opacity:0}))))}var l,d=i.scale*(i.length+i.width),c=2*i.scale*d,u=-(i.width+i.length)*i.scale*2+"px",f=n(a(),{position:"absolute",top:u,left:u});if(i.shadow)for(l=1;l<=i.lines;l++)s(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=i.lines;l++)s(l);return t(e,f)},s.prototype.opacity=function(e,t,o,i){var n=e.firstChild;i=i.shadow&&i.lines||0,n&&t+i<n.childNodes.length&&(n=n.childNodes[t+i],n=n&&n.firstChild,(n=n&&n.firstChild)&&(n.opacity=o))}}():l=i(h,"animation")}return s}),function(e){if("object"==typeof exports)e(require("jquery"),require("spin"));else if("function"==typeof define&&define.amd)define(["jquery","spin"],e);else{if(!window.Spinner)throw new Error("Spin.js not present");e(window.jQuery,window.Spinner)}}(function(e,t){e.fn.spin=function(o,i){return this.each(function(){var n=e(this),a=n.data();a.spinner&&(a.spinner.stop(),delete a.spinner),!1!==o&&(o=e.extend({color:i||n.css("color")},e.fn.spin.presets[o]||o),a.spinner=new t(o).spin(this))})},e.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}}),jQuery.fn.hasScrollBar=function(){var e={},t=this.get(0);return e.vertical=t.scrollHeight>t.clientHeight,e.horizontal=t.scrollWidth>t.clientWidth,e},function(e){function t(t,o){this.el=e(t),this.options=o||{},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,this.autoHide=!1!==this.options.autoHide,this.padding=void 0==this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),this.inner.css({width:"+="+(this.y?n():0),height:"+="+(this.x?n():0)}),this.refresh()}function o(t){this.pane=t,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(e.proxy(this,"mouseenter")),this.pane.el.mouseleave(e.proxy(this,"mouseleave")),this.el.mousedown(e.proxy(this,"mousedown")),this.innerPaneScrollListener=e.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=e.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var o=this.pane.options.initialDisplay;!1!==o&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(e.proxy(this,"hide"),parseInt(o,10)||3e3)))}function i(e,t){function o(){}o.prototype=t.prototype,e.prototype=new o}function n(){if(void 0===a){var t=e('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');e("body").append(t);var o=e(t).innerWidth(),i=e("div",t).innerWidth();e(t).remove(),a=o-i}return a}e.fn.antiscroll=function(t){return this.each(function(){e(this).data("antiscroll")&&e(this).data("antiscroll").destroy(),e(this).data("antiscroll",new e.Antiscroll(this,t))})},e.Antiscroll=t,t.prototype.refresh=function(){var e=this.inner.get(0).scrollWidth>this.el.width()+(this.y?n():0),t=this.inner.get(0).scrollHeight>this.el.height()+(this.x?n():0);this.x&&(!this.horizontal&&e?this.horizontal=new o.Horizontal(this):this.horizontal&&!e?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&t?this.vertical=new o.Vertical(this):this.vertical&&!t?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())},t.prototype.destroy=function(){return this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this},t.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),t.call(this,this.el,this.options),this},o.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},o.prototype.mouseenter=function(){this.enter=!0,this.show()},o.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},o.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(e.proxy(this,"hide"),1500))),this.update()},o.prototype.mousedown=function(t){t.preventDefault(),this.dragging=!0,this.startPageY=t.pageY-parseInt(this.el.css("top"),10),this.startPageX=t.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};this.pane;var o=e.proxy(this,"mousemove"),i=this;e(this.el[0].ownerDocument).mousemove(o).mouseup(function(){i.dragging=!1,this.onselectstart=null,e(this).unbind("mousemove",o),i.enter||i.hide()})},o.prototype.show=function(e){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)},o.prototype.hide=function(){!1!==this.pane.autoHide&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},i(o.Horizontal=function(t){this.el=e('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">',t.el),o.call(this,t)},o),o.Horizontal.prototype.update=function(){var e=this.pane.el.width(),t=e-2*this.pane.padding,o=this.pane.inner.get(0);return this.el.css("width",t*e/o.scrollWidth).css("left",t*o.scrollLeft/o.scrollWidth),e<o.scrollWidth},o.Horizontal.prototype.mousemove=function(e){var t=this.pane.el.width()-2*this.pane.padding,o=e.pageX-this.startPageX,i=this.el.width(),n=this.pane.inner.get(0),a=Math.min(Math.max(o,0),t-i);n.scrollLeft=(n.scrollWidth-this.pane.el.width())*a/(t-i)},o.Horizontal.prototype.mousewheel=function(e,t,o,i){if(o<0&&0==this.pane.inner.get(0).scrollLeft||o>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return e.preventDefault(),!1},i(o.Vertical=function(t){this.el=e('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">',t.el),o.call(this,t)},o),o.Vertical.prototype.update=function(){var e=this.pane.el.height(),t=e-2*this.pane.padding,o=this.innerEl,i=t*e/o.scrollHeight;i=i<20?20:i;var n=t*o.scrollTop/o.scrollHeight;return n+i>t&&(n=n-(n+i-t)-3),this.el.css("height",i).css("top",n),e<o.scrollHeight},o.Vertical.prototype.mousemove=function(e){var t=this.pane.el.height(),o=t-2*this.pane.padding,i=e.pageY-this.startPageY,n=this.el.height(),a=this.innerEl,r=Math.min(Math.max(i,0),o-n);a.scrollTop=(a.scrollHeight-t)*r/(o-n)},o.Vertical.prototype.mousewheel=function(e,t,o,i){if(i>0&&0==this.innerEl.scrollTop||i<0&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return e.preventDefault(),!1};var a}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var n,a=t||window.event,r=[].slice.call(arguments,1),s=0,l=0,d=0,c=0,u=0;return t=e.event.fix(a),t.type="mousewheel",a.wheelDelta&&(s=a.wheelDelta),a.detail&&(s=-1*a.detail),a.deltaY&&(s=d=-1*a.deltaY),a.deltaX&&(s=-1*(l=a.deltaX)),void 0!==a.wheelDeltaY&&(d=a.wheelDeltaY),void 0!==a.wheelDeltaX&&(l=-1*a.wheelDeltaX),c=Math.abs(s),(!o||c<o)&&(o=c),u=Math.max(Math.abs(d),Math.abs(l)),(!i||u<i)&&(i=u),n=s>0?"floor":"ceil",s=Math[n](s/o),l=Math[n](l/i),d=Math[n](d/i),r.unshift(t,s,l,d),(e.event.dispatch||e.event.handle).apply(this,r)}var o,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(e.event.fixHooks)for(var r=n.length;r;)e.event.fixHooks[n[--r]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=a.length;e;)this.addEventListener(a[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=a.length;e;)this.removeEventListener(a[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function(e){e.fn.delayedAction=function(t){var o=e.extend({},{delayedAction:function(){},cancelledAction:function(){},hoverTime:1e3},t);return this.each(function(){var t=e(this);t.hover(function(){t.data("timerId",setTimeout(function(){t.data("hover",!1),o.delayedAction(t)},o.hoverTime)),t.data("hover",!0)},function(){t.data("hover")&&(clearTimeout(t.data("timerId")),o.cancelledAction(t)),t.data("hover",!1)})})}}(jQuery),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=e()}}(function(){return function e(t,o,i){function n(r,s){if(!o[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=o[r]={exports:{}};t[r][0].call(c.exports,function(e){var o=t[r][1][e];return n(o||e)},c,c.exports,e,t,o,i)}return o[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(e,t,o){var i=e("matches-selector");t.exports=function(e,t,o){for(var n=o?e:e.parentNode;n&&n!==document;){if(i(n,t))return n;n=n.parentNode}}},{"matches-selector":5}],2:[function(e,t,o){function i(e,t,o,i){return function(o){o.delegateTarget=n(o.target,t,!0),o.delegateTarget&&i.call(e,o)}}var n=e("closest");t.exports=function(e,t,o,n,a){var r=i.apply(this,arguments);return e.addEventListener(o,r,a),{destroy:function(){e.removeEventListener(o,r,a)}}}},{closest:1}],3:[function(e,t,o){o.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},o.nodeList=function(e){var t=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||o.node(e[0]))},o.string=function(e){return"string"==typeof e||e instanceof String},o.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{}],4:[function(e,t,o){function i(e,t,o){return e.addEventListener(t,o),{destroy:function(){e.removeEventListener(t,o)}}}function n(e,t,o){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,o)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,o)})}}}function a(e,t,o){return s(document.body,e,t,o)}var r=e("./is"),s=e("delegate");t.exports=function(e,t,o){if(!e&&!t&&!o)throw new Error("Missing required arguments");if(!r.string(t))throw new TypeError("Second argument must be a String");if(!r.fn(o))throw new TypeError("Third argument must be a Function");if(r.node(e))return i(e,t,o);if(r.nodeList(e))return n(e,t,o);if(r.string(e))return a(e,t,o);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},{"./is":3,delegate:2}],5:[function(e,t,o){var i=Element.prototype,n=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;t.exports=function(e,t){if(n)return n.call(e,t);for(var o=e.parentNode.querySelectorAll(t),i=0;i<o.length;++i)if(o[i]==e)return!0;return!1}},{}],6:[function(e,t,o){t.exports=function(e){var t;if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName)e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var o=window.getSelection(),i=document.createRange();i.selectNodeContents(e),o.removeAllRanges(),o.addRange(i),t=o.toString()}return t}},{}],7:[function(e,t,o){function i(){}i.prototype={on:function(e,t,o){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:o}),this},once:function(e,t,o){function i(){n.off(e,i),t.apply(o,arguments)}var n=this;return i._=t,this.on(e,i,o)},emit:function(e){var t=[].slice.call(arguments,1),o=((this.e||(this.e={}))[e]||[]).slice(),i=0,n=o.length;for(i;n>i;i++)o[i].fn.apply(o[i].ctx,t);return this},off:function(e,t){var o=this.e||(this.e={}),i=o[e],n=[];if(i&&t)for(var a=0,r=i.length;r>a;a++)i[a].fn!==t&&i[a].fn._!==t&&n.push(i[a]);return n.length?o[e]=n:delete o[e],this}},t.exports=i},{}],8:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}o.__esModule=!0;var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("select")),r=function(){function e(t){i(this,e),this.resolveOptions(t),this.initSelection()}return e.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},e.prototype.initSelection=function(){if(this.text&&this.target)throw new Error('Multiple attributes declared, use either "target" or "text"');if(this.text)this.selectFake();else{if(!this.target)throw new Error('Missing required attributes, use either "target" or "text"');this.selectTarget()}},e.prototype.selectFake=function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return e.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=a.default(this.fakeElem),this.copyText()},e.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},e.prototype.selectTarget=function(){this.selectedText=a.default(this.target),this.copyText()},e.prototype.copyText=function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)},e.prototype.handleResult=function(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},e.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},e.prototype.destroy=function(){this.removeFake()},n(e,[{key:"action",set:function(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!=typeof e||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');this._target=e}},get:function(){return this._target}}]),e}();o.default=r,t.exports=o.default},{select:6}],9:[function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){var o="data-clipboard-"+e;if(t.hasAttribute(o))return t.getAttribute(o)}o.__esModule=!0;var s=i(e("./clipboard-action")),l=i(e("tiny-emitter")),d=i(e("good-listener")),c=function(e){function t(o,i){n(this,t),e.call(this),this.resolveOptions(i),this.listenClick(o)}return a(t,e),t.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},t.prototype.listenClick=function(e){var t=this;this.listener=d.default(e,"click",function(e){return t.onClick(e)})},t.prototype.onClick=function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new s.default({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})},t.prototype.defaultAction=function(e){return r("action",e)},t.prototype.defaultTarget=function(e){var t=r("target",e);return t?document.querySelector(t):void 0},t.prototype.defaultText=function(e){return r("text",e)},t.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},t}(l.default);o.default=c,t.exports=o.default},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)}),$(function(){function e(e){var t=!1;if((e=e.originalEvent).dataTransfer.types)for(var o=0;o<e.dataTransfer.types.length;o++)if("Files"==e.dataTransfer.types[o]){t=!0;break}return t}function t(){if(!PF.fn.isDevice(["phone","phablet"])){var e,t=$(".top-bar-notifications-list ul",".top-bar:visible");t.css("height",""),e=t.height(),t.data("height",e).css("height","auto"),t.height()>e&&(t.height(e),t.closest(".antiscroll-wrap").antiscroll())}}function o(e){e.addClass("list-item-play-gif--loading");var t=e.closest(".list-item"),o=$(".image-container",t),i=$("img",o);i.attr("src");if(void 0!==t.data("object")){var n=$.parseJSON(decodeURIComponent(t.data("object")));o.append(o.html()),$load=t.find(".image-container img").eq(1).attr("src",n.image.url).addClass("hidden"),$load.imagesLoaded(function(){e.remove(),i.remove(),$(this.elements).removeClass("hidden")})}}$(window).on("resize",function(){CHV.fn.uploader.boxSizer(),"function"==typeof user_background_full_fix&&user_background_full_fix(),CHV.fn.bindSelectableItems(),CHV.fn.listingViewer.placeholderSizing()}),window.opener&&"/upload"==window.location.pathname&&""==window.location.search.substr(1)&&($(window).on("load",function(e){window.opener.postMessage({id:window.name,requestAction:"postSettings"},"*")}),$(window).on("message",function(e){var t=e.originalEvent.data;void 0!==t.id&&void 0!==t.settings&&window.name===t.id&&(CHV.obj.opener.uploadPlugin[t.id]=t.settings)}));var i=CHV.fn.uploader.selectors.root,n=CHV.fn.uploader.selectors.queue,a=$(i),r=$(n);if($(document).on("click","[data-action=top-bar-upload]",function(e){$("body").is("#upload")||CHV.fn.uploader.toggle()}),$("[data-action=close-upload]",a).click(function(){a.is(":animated")||$("[data-action=top-bar-upload]","#top-bar").click()}),$("[data-action=reset-upload]",a).click(function(){CHV.fn.uploader.isUploading&&$("[data-action=cancel-upload-remaining], [data-action=cancel-upload]",a).trigger("click"),CHV.fn.uploader.reset()}),$("[data-action=cancel-upload-remaining], [data-action=cancel-upload]",a).click(function(){CHV.fn.uploader.isUploading=!1,$("[data-action=cancel]",r).click(),Object.size(CHV.fn.uploader.results.success)>0?CHV.fn.uploader.displayResults():CHV.fn.uploader.reset()}),$(document).on("click","[data-action=upload-privacy]:not(disabled)",function(e){e.isDefaultPrevented()||(current_privacy=$(this).data("privacy"),target_privacy="public"==current_privacy?"private":"public",this_lock=$(".icon",this).data("lock"),this_unlock=$(".icon",this).data("unlock"),$(".icon",this).removeClass(this_lock+" "+this_unlock).addClass("public"==current_privacy?this_lock:this_unlock),$(this).data("privacy",target_privacy),$("[data-action=upload-privacy-copy]").html($("[data-action=upload-privacy]").html()),$upload_button=$("[data-action=upload]",a),$upload_button.text($upload_button.data(target_privacy)),$(this).tipTip("hide"))}),$(CHV.fn.uploader.selectors.file+", "+CHV.fn.uploader.selectors.camera).on("change",function(e){$(CHV.fn.uploader.selectors.root).data("shown")?CHV.fn.uploader.add(e):CHV.fn.uploader.toggle({callback:function(e){CHV.fn.uploader.add(e)}},e)}).on("click",function(e){!$(this).data("login-needed")||PF.fn.is_user_logged()}),$(CHV.fn.uploader.selectors.root).exists()&&($("body").on({dragenter:function(t){if(t.preventDefault(),!e(t))return!1;$(CHV.fn.uploader.selectors.dropzone).exists()||$("body").append($('<div id="'+CHV.fn.uploader.selectors.dropzone.replace("#","")+'"/>').css({width:"100%",height:"100%",position:"fixed",zIndex:1e3,left:0,top:0}))}}),$(document).on({dragover:function(t){if(t.preventDefault(),!e(t))return!1;$(CHV.fn.uploader.selectors.root).data("shown")||CHV.fn.uploader.toggle({reset:!1})},dragleave:function(e){$(CHV.fn.uploader.selectors.dropzone).remove(),$.isEmptyObject(CHV.fn.uploader.files)&&CHV.fn.uploader.toggle()},drop:function(e){e.preventDefault(),CHV.fn.uploader.add(e),$(CHV.fn.uploader.selectors.dropzone).remove()}},CHV.fn.uploader.selectors.dropzone)),$(document).on("keyup change","[data-action=resize-combo-input]",function(e){var t=$(this).closest("[data-action=resize-combo-input]"),o=$("[name=form-width]",t),i=$("[name=form-height]",t),n=o.data("initial")/i.data("initial"),a={width:Math.round(o.prop("value")/n),height:Math.round(i.prop("value")*n)};$(e.target).is(o)?i.prop("value",Math.round(a.width)):o.prop("value",Math.round(a.height))}),$(document).on("click",n+" [data-action=edit]",function(){for(var e=$(this).closest("li"),t=(e.closest("ul"),e.data("id")),o=CHV.fn.uploader.files[t],i=PF.obj.modal.selectors.root,n=$.extend({},o.formValues||o.parsedMeta),a=["album_id","category_id","nsfw"],r=0;r<a.length;r++){var s=a[r];if(void 0===n[s]){var l=$("[name=upload-"+s.replace("_","-")+"]",CHV.fn.uploader.selectors.root),d=l.prop(l.is(":checkbox")?"checked":"value");n[s]=l.is(":checkbox")?d?"1":null:d}}PF.fn.modal.call({type:"html",template:$("#anywhere-upload-edit-item").html(),callback:function(){if($.each(n,function(e,t){var n="[name=form-"+e.replace(/_/g,"-")+"]",a=$(n,i);if(!a.exists())return!0;if(a.is(":checkbox"))a.prop("checked",a.attr("value")==t);else if(a.is("select")){var r=a.find('[value="'+t+'"]');r.exists()||(r=a.find("option:first")),r.prop("selected",!0)}else a.prop("value",t);"width"!=e&&"height"!=e||a.prop("max",o.parsedMeta[e]).data("initial",o.parsedMeta[e])}),"image/gif"!==o.parsedMeta.mimetype&&$("[ data-content=animated-gif-warning]",i).remove(),$(".image-preview",i).length){$(".image-preview",i).append($("<canvas/>",{class:"canvas"}));var e=$(".queue-item[data-id="+t+"] .preview .canvas")[0],a=$(".image-preview .canvas",i)[0];a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0)}},confirm:function(){if(PF.fn.form_modal_has_changed()){var e=!1;return $.each(["width","height"],function(t,o){var n=$("[name=form-"+o+"]",i),a=parseInt(n.val()),r=parseInt(n.attr("min"));if(a>parseInt(n.attr("max"))||a<r)return n.highlight(),e=!0,!0}),e?(PF.fn.growl.expirable(PF.fn._s("Check the errors in the form to continue.")),!1):(void 0===o.formValues&&(o.formValues={title:null,category_id:null,width:null,height:null,nsfw:null,expiration:null,description:null,album_id:null}),$(":input[name]",i).each(function(e,t){var i=$(this).attr("name").replace("form-","").replace(/-/g,"_");if(void 0===o.formValues[i])return!0;o.formValues[i]=$(this).is(":checkbox")?$(this).is(":checked")?$(this).prop("value"):null:$(this).prop("value")}),CHV.fn.uploader.files[t].formValues=o.formValues,!0)}PF.fn.modal.close()}})}),$(document).on("click",n+" [data-action=cancel]",function(){var e=$(this).closest("li"),t=e.closest("ul"),o=e.data("id"),i=t.height(),n=!1;if(!e.hasClass("completed")&&!e.hasClass("failed")){if($("#tiptip_holder").hide(),e.tipTip("destroy").remove(),i!==t.height()&&CHV.fn.uploader.boxSizer(),$("li",r).exists()||$("[data-group=upload-queue-ready], [data-group=upload-queue], [data-group=upload-queue-ready]",a).css("display",""),CHV.fn.uploader.files[o]&&void 0!==CHV.fn.uploader.files[o].xhr&&(CHV.fn.uploader.files[o].xhr.abort(),n=!0),void 0!==CHV.fn.uploader.files[o]&&void 0!==CHV.fn.uploader.files[o].fromClipboard){var s=CHV.fn.uploader.files[o].md5,l=CHV.fn.uploader.clipboardImages.indexOf(s);l>-1&&CHV.fn.uploader.clipboardImages.splice(l,1)}delete CHV.fn.uploader.files[o],CHV.fn.uploader.queueSize(),0==Object.size(CHV.fn.uploader.files)?"success"in CHV.fn.uploader&&"results"in CHV.fn.uploader&&(0!=Object.size(CHV.fn.uploader.results.success)||0!=Object.size(CHV.fn.uploader.results.error))||CHV.fn.uploader.reset():n&&0!==$("li.waiting",t).first().length&&CHV.fn.uploader.upload($("li.waiting",t).first())}}),$(document).on("click","[data-action=upload]",function(){$("[data-group=upload], [data-group=upload-queue-ready]",a).hide(),a.removeClass("queueReady").addClass("queueUploading").find("[data-group=uploading]").show(),CHV.fn.uploader.queueSize(),CHV.fn.uploader.canAdd=!1,$queue_items=$("li",r),$queue_items.addClass("uploading waiting"),CHV.fn.uploader.timestamp=(new Date).getTime(),CHV.fn.uploader.upload($queue_items.first("li"))}),$("body#user").exists()&&PF.obj.listing.query_string.page>1){var s=History.getState();if(s.data&&void 0!==s.data.scrollTop)$(window).scrollTop()!==s.data.scrollTop&&$(window).scrollTop(s.data.scrollTop);else{var l=$("#background-cover").height()-160;$("html, body").animate({scrollTop:l},0)}}if($("#top-bar-shade").exists()&&$("#top-bar-shade").css("opacity")&&$("#top-bar-shade").data("initial-opacity",Number($("#top-bar-shade").css("opacity"))),PF.fn.isDevice("phone")&&$("#top-bar-shade").css("opacity",1),$(window).on("scroll resize",function(){if(PF.fn.isDevice("phone"))return $("#background-cover-src").css("transform",""),void $("#top-bar-shade").css("opacity",1);var e=$(window).scrollTop(),t=$("#top-bar-shade").exists()&&!$("html").hasClass("top-bar-box-shadow-none");if(!(e<0)){var o=$("#top-bar"),i=Number(e/($("#background-cover, [data-content=follow-scroll-opacity]").height()-o.height()));i>1&&(i=1),t&&($("#top-bar-shade").data("initial-opacity")&&(i+=$("#top-bar-shade").data("initial-opacity")),$("#top-bar-shade").css({opacity:i})),1!=i&&$("#background-cover-src").css({transform:"translate(0, "+.8*e+"px)"})}}),CHV.fn.bindSelectableItems(),$("body#image").exists())if($(CHV.obj.image_viewer.selector+" [data-load=full]").length>0){$(document).on("click",CHV.obj.image_viewer.loader,function(e){CHV.fn.viewerLoadImage()}),$(CHV.obj.image_viewer.loader).data("size")>CHV.obj.config.image.load_max_filesize?$(CHV.obj.image_viewer.loader).css("display","block"):CHV.fn.viewerLoadImage();var d;$(document).bind("DOMSubtreeModified",function(){$("html").height()>$(window).innerHeight()&&!$("html").hasClass("scrollbar-y")&&($("html").addClass("scrollbar-y"),$(document).data({width:$(this).width(),height:$(this).height()}),clearTimeout(d),d=setTimeout(CHV.fn.image_viewer_full_fix,100))}),$(window).on("resize",function(){clearTimeout(d),d=setTimeout(CHV.fn.image_viewer_full_fix,100)}),$(document).on("keyup",function(e){var t=$(e.target),o=e.charCode||e.keyCode;if(!t.is(":input")&&CHV.obj.image_viewer.$navigation.exists()&&(37==o||39==o)){var i=$("[data-action="+(37==o?"prev":"next")+"]",CHV.obj.image_viewer.$navigation).attr("href");void 0!==i&&""!==i&&(window.location=$("[data-action="+(37==o?"prev":"next")+"]",CHV.obj.image_viewer.$navigation).attr("href"))}})}else CHV.fn.viewerImageZoomClass();if($(document).on("click",CHV.obj.image_viewer.container,function(e){if($(this).hasClass("cursor-zoom-in")||$(this).hasClass("cursor-zoom-out")){var t=$(this).hasClass("cursor-zoom-in");if($(this).removeClass("cursor-zoom-in cursor-zoom-out"),t){var o,i=$(this)[0].getBoundingClientRect().width,n=$(this)[0].getBoundingClientRect().height,a=$("img",this).attr("width")/$("img",this).attr("height");void 0===$(this).data("dimentions")&&$(this).data({dimentions:{width:i,height:n},ratio:a}),$("img",this).attr("width")>$(window).width()?($(this).css({width:"100%"}),o=$(this).width(),$(this).css({width:i})):o=$("img",this).attr("width"),$(this).addClass("cursor-zoom-out").css({width:o,height:o/a+"px"})}else $(this).addClass("cursor-zoom-in").css($(this).data("dimentions"));e.preventDefault()}}),$(document).on("contextmenu","html.device-mobile a.image-container",function(e){return e.preventDefault(),!1}),$(document).on("click","[data-action=openerPostMessage]",function(e){if(window.opener){e.preventDefault();var t=$($(this).is("[data-action-target]")?$(this).attr("data-action-target"):this),o=t[t.is(":input")?"val":"html"]();window.opener.postMessage({id:window.name,message:o},"*")}}),$(document).on("click","[data-action=list-tools] [data-action]",function(e){var t=$(e.target).closest("[data-id]");t&&t.find("[data-action=select]").exists()&&(e.ctrlKey||e.metaKey)&&e.altKey&&(CHV.fn.list_editor.toggleSelectItem(t,!t.hasClass("selected")),e.preventDefault(),e.stopPropagation())}),PF.fn.listing.ajax.callback=function(e){200===e.status&&CHV.fn.list_editor.listMassActionSet("select")},$(document).on("click","[data-action=list-select-all]",function(){CHV.fn.list_editor.selectItem($(".list-item:visible:not(.selected)")),CHV.fn.list_editor.listMassActionSet("clear")}),$(document).on("click","[data-action=list-clear-all]",function(){PF.fn.close_pops(),CHV.fn.list_editor.clearSelection()}),$(document).on("click","[data-action=list-tools] [data-action]",function(e){if(e.isPropagationStopped())return!1;var t=$(this).closest(PF.obj.listing.selectors.list_item+", .viewer"),o=t.attr("data-id");if(void 0!==t.attr("data-type")){i=t.attr("data-type");var i,n=$("[data-type="+i+"][data-id="+o+"]");switch($(this).data("action")){case"select":CHV.fn.list_editor.toggleSelectItem(t,!t.hasClass("selected"));break;case"codes":var a="[data-modal=form-embed-codes]",r=[];$("textarea",a).html(""),r.push({image:$.parseJSON(decodeURIComponent(t.attr("data-object")))}),CHV.fn.fillEmbedCodes(r,a,"html"),PF.fn.modal.call({type:"html",template:$(a).html(),buttons:!1});break;case"edit":s="[data-modal=form-edit-single]";switch(i){case"image":$("[name=form-image-title]",s).attr("value",t.attr("data-title")),$("[name=form-image-description]",s).html(PF.fn.htmlEncode(t.attr("data-description"))),$("[name=form-album-id]",s).find("option").removeAttr("selected"),$("[name=form-album-id]",s).find('[value="'+t.attr("image"==i?"data-album-id":"data-id")+'"]').attr("selected",!0),$("[name=form-category-id]",s).find("option").removeAttr("selected"),$("[name=form-category-id]",s).find('[value="'+t.attr("data-category-id")+'"]').attr("selected",!0),$("[name=form-album-name]",s).attr("value",""),$("[name=form-album-description]",s).html(""),$("[name=form-privacy]",s).find("option").removeAttr("selected");break;case"album":$("[data-action=album-switch]",s).remove(),$("[name=form-album-name]",s).attr("value",t.attr("data-name")),$("[name=form-album-description]",s).html(PF.fn.htmlEncode(t.attr("data-description"))),$("[name=form-privacy]",s).find("option").removeAttr("selected"),$("[name=form-privacy]",s).find('[value="'+t.attr("data-privacy")+'"]').attr("selected",!0),"password"==t.attr("data-privacy")?($("[data-combo-value=password]").show(),$("[name=form-album-password]",s).attr("value",t.attr("data-password"))):($("[data-combo-value=password]").hide(),$("[name=form-album-password]",s).attr("value",""))}PF.fn.modal.call({type:"html",template:$(s).html(),ajax:{url:PF.obj.config.json_api,deferred:{success:function(e){CHV.fn.list_editor.updateItem("[data-type="+i+"][data-id="+o+"]",e.responseJSON[i],"edit")}}},confirm:function(){var e=$(PF.obj.modal.selectors.root);if(("image"==i||"album"==i)&&$("[data-content=form-new-album]",e).is(":visible")&&""==$("[name=form-album-name]",e).val())return PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1;{if(PF.fn.form_modal_has_changed()){switch(PF.obj.modal.form_data={action:"edit",edit:t.attr("data-type"),single:!0,owner:CHV.obj.resource.user.id,editing:{id:o,description:$("[name=form-"+i+"-description]",e).val()}},i){case"image":PF.obj.modal.form_data.editing.title=$("[name=form-image-title]",e).val(),PF.obj.modal.form_data.editing.category_id=$("[name=form-category-id]",e).val()||null,PF.obj.modal.form_data.editing.nsfw=$("[name=form-nsfw]",e).prop("checked")?1:0;break;case"album":PF.obj.modal.form_data.editing.name=$("[name=form-album-name]",e).val(),PF.obj.modal.form_data.editing.privacy=$("[name=form-privacy]",e).val(),"password"==PF.obj.modal.form_data.editing.privacy&&(PF.obj.modal.form_data.editing.password=$("[name=form-album-password]",e).val())}return PF.obj.modal.form_data.editing.new_album=$("[data-content=form-new-album]",e).is(":visible"),PF.obj.modal.form_data.editing.new_album?(PF.obj.modal.form_data.editing.album_name=$("[name=form-album-name]",e).val(),PF.obj.modal.form_data.editing.album_privacy=$("[name=form-privacy]",e).val(),"password"==PF.obj.modal.form_data.editing.album_privacy&&(PF.obj.modal.form_data.editing.album_password=$("[name=form-album-password]",e).val()),PF.obj.modal.form_data.editing.album_description=$("[name=form-album-description]",e).val()):PF.obj.modal.form_data.editing.album_id=$("[name=form-album-id]",e).val(),!0}PF.fn.modal.close()}}});break;case"move":var s="[data-modal=form-move-single]";$("[name=form-album-id]",s).find("option").removeAttr("selected"),$("[name=form-album-id]",s).find('[value="'+t.attr("image"==i?"data-album-id":"data-id")+'"]').attr("selected",!0),$("[name=form-album-name]",s).attr("value",""),$("[name=form-album-description]",s).html(""),$("[name=form-privacy]",s).find("option").removeAttr("selected"),PF.fn.modal.call({type:"html",template:$(s).html(),ajax:{url:PF.obj.config.json_api,deferred:{success:function(e){CHV.fn.list_editor.updateMoveItemLists(e.responseJSON,i,n)}}},load:function(){},confirm:function(){var e=$(PF.obj.modal.selectors.root);if($("[data-content=form-new-album]",e).is(":visible")&&""==$("[name=form-album-name]",e).val())return PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1;{if(PF.fn.form_modal_has_changed())return PF.obj.modal.form_data={action:"edit",edit:t.attr("data-type"),single:!0,owner:CHV.obj.resource.user.id,editing:{id:o}},PF.obj.modal.form_data.editing.new_album=$("[data-content=form-new-album]",e).is(":visible"),PF.obj.modal.form_data.editing.new_album?(PF.obj.modal.form_data.editing.album_name=$("[name=form-album-name]",e).val(),PF.obj.modal.form_data.editing.album_privacy=$("[name=form-privacy]",e).val(),"password"==PF.obj.modal.form_data.editing.album_privacy&&(PF.obj.modal.form_data.editing.album_password=$("[name=form-album-password]",e).val()),PF.obj.modal.form_data.editing.album_description=$("[name=form-album-description]",e).val()):PF.obj.modal.form_data.editing.album_id=$("[name=form-album-id]",e).val(),!0;PF.fn.modal.close()}}});break;case"delete":PF.fn.modal.call({type:"html",template:$("[data-modal=form-delete-single]").html(),button_submit:PF.fn._s("Confirm"),ajax:{url:PF.obj.config.json_api,deferred:{success:function(e){"album"==i&&($("[name=form-album-id]","[data-modal]").find('[value="'+o+'"]').remove(),CHV.fn.list_editor.updateUserCounters("image",e.responseJSON.success.affected,"-")),CHV.fn.list_editor.deleteFromList(t)}}},confirm:function(){return PF.obj.modal.form_data={action:"delete",single:!0,delete:t.attr("data-type"),deleting:{id:o}},!0}})}}else console.log("Error: data-type not defined")}),$(".pop-box-menu a","[data-content=list-selection]").click(function(e){var t=$(PF.obj.listing.selectors.content_listing_visible);{if(void 0!==t.data("list")){dealing_with=t.data("list");var o=$(PF.obj.listing.selectors.list_item+".selected",t),i=$.map(o,function(e,t){return $(e).data("id")});switch($(this).closest(".pop-btn").click(),$(this).data("action")){case"get-embed-codes":var n="[data-modal=form-embed-codes]",a=[];$("textarea",n).html(""),o.each(function(){a.push({image:$.parseJSON(decodeURIComponent($(this).data("object")))})}),CHV.fn.fillEmbedCodes(a,n,"html"),PF.fn.modal.call({type:"html",template:$(n).html(),buttons:!1});break;case"clear":CHV.fn.list_editor.clearSelection(),e.stopPropagation();break;case"move":case"create-album":var r="[data-modal="+(n="move"==$(this).data("action")?"form-move-multiple":"form-create-album")+"]",s=/image/.test(dealing_with)?"album-id":"id";$("[name=form-album-id]",r).find("[value=null]").remove(),$("[name=form-album-id]",r).find("option").removeAttr("selected"),$("[name=form-album-name]",r).attr("value",""),$("[name=form-album-description]",r).html(""),$("[name=form-privacy]",r).find("option").removeAttr("selected");var l=o.first().data(s),d=!0;o.each(function(){if($(this).data(s)!==l)return d=!1,!1}),d||$("[name=form-album-id]",r).prepend('<option value="null">'+PF.fn._s("Select existing album")+"</option>"),$("[name=form-album-id]",r).find('[value="'+(d?o.first().data(s):"null")+'"]').attr("selected",!0),PF.fn.modal.call({type:"html",template:$(r).html(),ajax:{url:PF.obj.config.json_api,deferred:{success:function(e){CHV.fn.list_editor.updateMoveItemLists(e.responseJSON,dealing_with,o)}}},load:function(){},confirm:function(){var e=$(PF.obj.modal.selectors.root),t=!1;if($("[data-content=form-new-album]",e).is(":visible")&&""==$("[name=form-album-name]",e).val())return PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1;$("[data-content=form-new-album]",e).is(":visible")&&(t=!0);{if(PF.fn.form_modal_has_changed()){return PF.obj.modal.form_data={action:t?"create-album":"move",type:dealing_with,owner:CHV.obj.resource.user.id,multiple:!0,album:{ids:i,new:t}},t?(PF.obj.modal.form_data.album.name=$("[name=form-album-name]",e).val(),PF.obj.modal.form_data.album.privacy=$("[name=form-privacy]",e).val(),"password"==PF.obj.modal.form_data.album.privacy&&(PF.obj.modal.form_data.album.password=$("[name=form-album-password]",e).val()),PF.obj.modal.form_data.album.description=$("[name=form-album-description]",e).val()):PF.obj.modal.form_data.album.id=$("[name=form-album-id]",e).val(),!0}PF.fn.modal.close()}}});break;case"delete":PF.fn.modal.call({template:$("[data-modal=form-delete-multiple]").html(),button_submit:PF.fn._s("Confirm"),ajax:{url:PF.obj.config.json_api,deferred:{success:function(e){"albums"==dealing_with&&(o.each(function(){$("[name=form-album-id]","[data-modal]").find('[value="'+$(this).data("id")+'"]').remove()}),CHV.fn.list_editor.updateUserCounters("image",e.responseJSON.success.affected,"-")),CHV.fn.list_editor.deleteFromList(o)}}},confirm:function(){return PF.obj.modal.form_data={action:"delete",from:"list",delete:dealing_with,multiple:!0,deleting:{ids:i}},!0}})}return!PF.fn.isDevice(["phone","phablet"])&&void 0}console.log("Error: data-list not defined")}}),$("body#image").exists()&&$(window).scroll(function(){CHV.obj.topBar.transparencyScrollToggle()}),$(document).on("click","[data-action=disconnect]",function(){var e=$(this),t=e.data("connection");PF.fn.modal.confirm({message:e.data("confirm-message"),ajax:{data:{action:"disconnect",disconnect:t,user_id:CHV.obj.resource.user.id},deferred:{success:function(e){var o=e.responseJSON;$("[data-connection="+t+"]").fadeOut(function(){$($("[data-connect="+t+"]")).fadeIn(),$(this).remove(),0==$("[data-connection]").length&&$("[data-content=empty-message]").show(),PF.fn.growl.expirable(o.success.message)})},error:function(e){var t=e.responseJSON;PF.fn.growl.call(t.error.message)}}}})}),$(document).on("click","[data-action=delete-avatar]",function(){var e=$(".user-settings-avatar"),t=$(".loading-placeholder",e),o=$("#top-bar");t.removeClass("hidden"),PF.fn.loading.inline(t,{center:!0}),$.ajax({type:"POST",data:{action:"delete",delete:"avatar",owner:CHV.obj.resource.user.id}}).complete(function(i){t.addClass("hidden").empty(),200==i.status?(CHV.obj.logged_user.id==CHV.obj.resource.user.id&&($("img.user-image",o).hide(),$(".default-user-image",o).removeClass("hidden")),$(".default-user-image",e).removeClass("hidden").css({opacity:0}),$(".btn-alt",e).closest("div").hide(),$("img.user-image",e).fadeOut(function(){$(".default-user-image",e).animate({opacity:1})})):PF.fn.growl.expirable(PF.fn._s("An error occurred. Please try again later."))})}),$(document).on("change","[data-content=user-avatar-upload-input]",function(e){e.preventDefault(),e.stopPropagation();var t=$(this),o=$(".user-settings-avatar"),i=$(".loading-placeholder",".user-settings-avatar"),n=$("#top-bar"),a=$(this)[0].files[0];if(!t.data("uploading"))if(0!=/^image\/.*$/.test(a.type))if(a.size>CHV.obj.config.user.avatar_max_filesize)PF.fn.growl.call(PF.fn._s("Please select a picture of at most %s size.",CHV.obj.config.user.avatar_max_filesize));else{i.removeClass("hidden"),PF.fn.loading.inline(i,{center:!0}),t.data("uploading",!0);var r=new FormData;r.append("source",a),r.append("action","upload"),r.append("type","file"),r.append("what","avatar"),r.append("owner",CHV.obj.resource.user.id),r.append("auth_token",PF.obj.config.auth_token),avatarXHR=new XMLHttpRequest,avatarXHR.open("POST",PF.obj.config.json_api,!0),avatarXHR.send(r),avatarXHR.onreadystatechange=function(){if(4==this.readyState){var e=("json"!==this.responseType?JSON.parse(this.response):this.response).success.image;i.addClass("hidden").empty(),200==this.status?(change_avatar=function(t){$("img.user-image",t).attr("src",e.url).removeClass("hidden").show()},hide_default=function(e){$(".default-user-image",e).addClass("hidden")},hide_default(o),$(".btn-alt",o).closest("div").show(),change_avatar(o),CHV.obj.logged_user.id==CHV.obj.resource.user.id&&(change_avatar(n),hide_default(n)),PF.fn.growl.expirable(PF.fn._s("Profile image updated."))):PF.fn.growl.expirable(PF.fn._s("An error occurred. Please try again later.")),t.data("uploading",!1)}}}else PF.fn.growl.call(PF.fn._s("Please select a valid image file type."))}),$(document).on("change","[data-content=user-background-upload-input]",function(e){e.preventDefault(),e.stopPropagation();var t=$(this),o=$("[data-content=user-background-cover]"),i=$("[data-content=user-background-cover-src]"),n=$(".loading-placeholder",o),a=($("#top-bar"),$(this)[0].files[0]);if(!t.data("uploading"))if(0!=/^image\/.*$/.test(a.type))if(a.size>CHV.obj.config.user.background_max_filesize)PF.fn.growl.call(PF.fn._s("Please select a picture of at most %s size.",CHV.obj.config.user.background_max_filesize));else{n.removeClass("hidden"),PF.fn.loading.inline(n,{center:!0,size:"big",color:"#FFF"}),t.data("uploading",!0);var r=new FormData;r.append("source",a),r.append("action","upload"),r.append("type","file"),r.append("what","background"),r.append("owner",CHV.obj.resource.user.id),r.append("auth_token",PF.obj.config.auth_token),avatarXHR=new XMLHttpRequest,avatarXHR.open("POST",PF.obj.config.json_api,!0),avatarXHR.send(r),avatarXHR.onreadystatechange=function(){if(4==this.readyState){var e=("json"!==this.responseType?JSON.parse(this.response):this.response).success.image;if(200==this.status){var a=$("<img/>");a.attr("src",e.url).imagesLoaded(function(){n.addClass("hidden").empty(),i.css("background-image","url("+e.url+")").hide().fadeIn(),$("[data-content=user-change-background]",o).removeClass("hidden"),o.removeClass("no-background"),$("[data-content=user-upload-background]").hide(),$("[data-content=user-change-background]").show(),PF.fn.growl.expirable(PF.fn._s("Profile background image updated.")),a.remove(),"function"==typeof user_background_full_fix&&user_background_full_fix()})}else n.addClass("hidden").empty(),PF.fn.growl.expirable(PF.fn._s("An error occurred. Please try again later."));t.data("uploading",!1)}}}else PF.fn.growl.call(PF.fn._s("Please select a valid image file type."))}),CHV.fn.user_background={delete:{submit:function(){return PF.obj.modal.form_data={action:"delete",delete:"background",owner:CHV.obj.resource.user.id},!0},deferred:{success:{before:function(e){$("[data-content=user-background-cover-src]").css("background-image","none"),$("[data-content=user-background-cover]").addClass("no-background").height(""),$("[data-content=user-upload-background]").removeClass("hidden").show(),$("[data-content=user-change-background]").hide(),$("#top-bar").removeClass("transparent background-transparent"),$("#top-bar-shade").remove()},done:function(e){PF.fn.modal.close(function(){PF.fn.growl.expirable(PF.fn._s("Profile background image deleted."))})}},error:function(e){PF.fn.growl.expirable(PF.fn._s("Error deleting profile background image."))}}}},CHV.str.mainform="[data-content=main-form]",CHV.obj.timezone={selector:"[data-content=timezone]",input:"#timezone-region"},$(document).on("keyup change",CHV.str.mainform+" :input",function(){$(this).is("[name=username]")&&$("[data-text=username]").text($(this).val())}),$(document).on("change",CHV.obj.timezone.input,function(){var e=$(this).val(),t=$("#timezone-combo-"+e);t.find("option:first").prop("selected",!0),$(CHV.obj.timezone.selector).val(t.val()).change()}),$(document).on("change","[id^=timezone-combo-]",function(){var e=$(this).val();$(CHV.obj.timezone.selector).val(e).change()}),$(document).on("keyup change blur","[name^=new-password]",function(){var e=$("[name=new-password]"),t=$("[name=new-password-confirm]"),o=e.val()==t.val(),i=t.closest(".input-password").find(".input-warning");$(this).is(t)&&t.data("touched",!0),t.data("touched")&&i.text(o?"":i.data("text"))[o?"addClass":"removeClass"]("hidden-visibility")}),$(document).on("submit",CHV.obj.mainform,function(){switch($(this).data("type")){case"password":var e=$("[name=new-password]",this),t=$("[name=new-password-confirm]",this);if((""!==e.val()||""!==t.val())&&e.val()!==t.val())return e.highlight(),t.highlight(),PF.fn.growl.expirable(PF.fn._s("Passwords don't match")),!1}}),$("body#image").exists()&&window.scrollY>0&&$("#top-bar").removeClass("transparent"),$(CHV.fn.uploader.selectors.root).exists()&&(CHV.fn.uploader.$pasteCatcher=$("<div />",{contenteditable:"true",id:CHV.fn.uploader.selectors.paste.replace(/#/,"")}),$("body").append(CHV.fn.uploader.$pasteCatcher),$(document).keydown(function(e){var t=e.keyCode;(e.ctrlKey||e.metaKey)&&86==t&&!$(e.target).is(":input")&&CHV.fn.uploader.$pasteCatcher.focus()}),window.addEventListener("paste",CHV.fn.uploader.pasteImageHandler)),$(document).on("click","[data-action=like]",function(){if(PF.fn.is_user_logged()){var e=$(this);if(!e.data("XHR")){e.data("XHR",!0);var t=$(this).is("[data-liked]")?$(this):$(this).closest("[data-liked]"),o=!t.closest("[data-list], .viewer").exists()&&void 0!==CHV.obj.resource,i=t.is("[data-liked=1]"),n=i?"dislike":"like",a={id:o?CHV.obj.resource.id:$(this).closest("[data-id]").attr("data-id"),type:o?CHV.obj.resource.type:$(this).closest("[data-type]").attr("data-type")},r=o?e:$("[data-type="+a.type+"][data-id="+a.id+"]"),s={data:{action:n},cache:!1};s.data[n]={object:a.type,id:a.id},$.ajax(s).complete(function(t){var n=t.responseJSON;e.data("XHR",!1),200===n.status_code?(o&&void 0!==n.content&&$("[data-text=likes-count]").html(n.content.likes),r.attr("data-liked",i?0:1)):PF.fn.growl.expirable(PF.fn._s("An error occurred. Please try again later."))})}}else PF.fn.modal.call({type:"login"})}),$(document).on("click","[data-action=follow]",function(){if(PF.fn.is_user_logged()){var e=$(this);if(!e.data("XHR")){e.data("XHR",!0);var t=$(this).is("[data-followed]")?$(this):$(this).closest("[data-followed]"),o=void 0!==CHV.obj.resource,i=t.is("[data-followed=1]"),n=i?"unfollow":"follow",a={id:o?CHV.obj.resource.id:$(this).closest("[data-id]").data("id"),type:o?CHV.obj.resource.type:$(this).closest("[data-type]").data("type")},r={data:{action:n},cache:!1};r.data[n]={object:a.type,id:a.id},$.ajax(r).complete(function(n){var a=n.responseJSON;if(e.data("XHR",!1),200===a.status_code){if(o&&void 0!==a.user_followed){var r=$("[data-text=followers-label]"),s={single:r.data("label-single"),plural:r.data("label-plural")};$("[data-text=followers-count]").html(a.user_followed.followers),r.html(PF.fn._n(s.single,s.plural,a.user_followed.followers))}t.attr("data-followed",i?0:1)}else PF.fn.growl.expirable(PF.fn._s("An error occurred. Please try again later."))})}}else PF.fn.modal.call({type:"login"})}),$(document).on("click","[data-action=top-bar-notifications]",function(e){var o=this,i=$(this),n=$(".top-bar-notifications-container",i),a=$(".top-bar-notifications-list",i),r=$("ul",a),s=$(".loading",n);i.data("XHR")||(s.removeClass("hidden"),PF.fn.loading.inline(s,{size:"small",message:PF.fn._s("loading")}),$.ajax({data:{action:"notifications"},cache:!1}).complete(function(e){var l=e.responseJSON;if(200!==l.status_code)return PF.fn.growl.expirable(PF.fn._s("An error occurred. Please try again later.")),i.data("XHR",!1),void s.addClass("hidden").html("");if(i.data("XHR",!0),s.remove(),l.html){a.removeClass("hidden"),r.html(l.html),t();var d=$("li.new",r);d.addClass("transition"),setTimeout(function(){d.removeClass("new"),$("[data-content=notifications-counter]",o).removeClass("on").html("0"),setTimeout(function(){d.removeClass("transition")},150)},1500)}else $(".empty",n).removeClass("hidden")}))}),void 0!==CHV.obj.config.mode&&"code"==CHV.obj.config.mode){var c="";if(-1===window.name.indexOf("imgbb_")?c=window.name:"undefined"!=typeof localStorage&&(c=localStorage.getItem("code")),""!=c&&-1===c.indexOf("imgbb_")){var u="[data-modal=form-embed-code]";$("textarea",u).html(decodeURIComponent(c)),PF.fn.modal.call({type:"html",template:$(u).html(),buttons:!1})}}$(document).on("click",".list-item a.image-container",function(e){var t=$(this).closest(".list-item").find("[data-action=load-image]");t.length>0&&(o(t),e.preventDefault())}),$(document).on("click",".list-item [data-action=load-image]",function(e){o($(this)),e.preventDefault(),e.stopPropagation()}),$(document).on("click","#album [data-tab=tab-codes]",function(){if(PF.fn.is_user_logged()){var e=$(".content-listing-loading","#tab-codes");if(e.exists()){var t=$("#embed-codes");$.ajax({data:{action:"get-album-contents",albumid:CHV.obj.resource.id},cache:!1}).always(function(o){PF.fn.loading.destroy(e),CHV.fn.fillEmbedCodes(o.contents,"#tab-codes"),t.removeClass("soft-hidden")})}}}),$("body").is("#upload")&&CHV.fn.uploader.toggle({show:!0}),$(document).on("keyup",function(e){if(!$(PF.obj.modal.selectors.root).exists()&&$(".viewer").exists()&&e.which in CHV.fn.listingViewer.keys){var t=[88,27,37,39],o=CHV.fn.listingViewer.keys[e.which];-1==t.indexOf(e.which)?$("[data-action="+o+"]",CHV.fn.listingViewer.selectors.root).click():o in CHV.fn.listingViewer&&CHV.fn.listingViewer[o]()}}),$(document).on("click",CHV.fn.listingViewer.selectors.root+" [data-action^=viewer-]",function(){var e=$(this).data("action").substring("viewer-".length);e in CHV.fn.listingViewer&&CHV.fn.listingViewer[e]()}),$(document).on("click","a[data-href]:not([rel=popup-link]):not(.popup-link)",function(){var e=$(this).attr("data-href"),t=$(this).attr("href");(e||t)&&(location.href=t||e)}),void 0!==CHV.obj.config&&CHV.obj.config.listing.viewer&&$(document).on("click",PF.obj.listing.selectors.list_item+"[data-type=image] a.image-container",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest(PF.obj.listing.selectors.list_item);t.exists()&&CHV.fn.listingViewer.open(t)}),$(document).on("contextmenu","html.device-mobile "+CHV.fn.listingViewer.selectors.src,function(e){return e.preventDefault(),!1});var f=PF.fn.deparam(window.location.search);if(f&&"list"in f&&"viewer"in f){var h=$(PF.obj.listing.selectors.list_item,PF.obj.listing.selectors.content_listing_visible)["next"==f.viewer?"first":"last"]();CHV.fn.listingViewer.open(h)}}),"undefined"==typeof CHV&&(CHV={obj:{},fn:{},str:{}}),window.opener&&"/upload"==window.location.pathname&&""==window.location.search.substr(1)&&(CHV.obj.opener={uploadPlugin:{}}),CHV.fn.listingViewer={selectors:{bodyShown:".--viewer-shown",template:"#viewer-template",root:".viewer",rootShow:".viewer--show",rootHide:".viewer--hide",rootZero:".viewer--zero",rootNavPrev:".viewer--nav-prev",rootNavNext:".viewer--nav-next",src:".viewer-src",tools:".viewer-tools",loader:".viewer-loader",owner:".viewer-owner",ownerGuest:".viewer-owner--guest",ownerUser:".viewer-owner--user",inputMap:".viewer-kb-input"},keys:{83:"select",76:"like",69:"edit",65:"move",46:"delete",88:"close",27:"close",67:"codes",37:"prev",39:"next"},keymap:{select:["S",PF.fn._s("Toggle select")],like:["L",PF.fn._s("Like")],edit:["E",PF.fn._s("Edit")],move:["A",PF.fn._s("Album")],delete:["Del",PF.fn._s("Delete")],close:["X",PF.fn._s("Close")],codes:["C",PF.fn._s("Embed codes")],prev:["◀",PF.fn._s("Previous")],next:["▶",PF.fn._s("Next")]},loading:null,idleTimer:0,$item:null,show:function(){this.getEl("root").removeClass(this.selectors.rootHide.substring(1)).addClass(this.selectors.rootShow.substring(1)),$("body").addClass(this.selectors.bodyShown.substring(1)),new Hammer($(CHV.fn.listingViewer.selectors.root).get(0),{direction:Hammer.DIRECTION_VERTICAL}).on("swipeleft swiperight",function(e){var t="left"==e.type.substring("swipe".length)?"next":"prev";CHV.fn.listingViewer[t]()}),$("html").hasClass("device-mobile")&&this.fullscreen()},getItem:function(){return this.$item},getEl:function(e){var t=!e.startsWith("template")&&!e.startsWith("root")&&this.selectors.root;return t?$(this.selectors[e],t):$(this.selectors[e])},getObject:function(e){if(e||void 0===this.object){var t=decodeURIComponent(this.getItem().attr("data-object"));this.object=JSON&&JSON.parse(t)||$.parseJSON(t)}return this.object},placeholderSizing:function(){if(this.getEl("root").exists()){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0)/Math.max(document.documentElement.clientHeight,window.innerHeight||0),t=this.getEl("src")[0],o=e<t.getAttribute("width")/t.getAttribute("height");t.classList.remove("--width-auto","--height-auto"),t.classList.add("--"+(o?"height":"width")+"-auto")}},filler:function(e){var t=this,o=this.getEl("root");if(e){var i=$(this.getParsedTemplate());o.html(i.html())}o[(this.getItem().hasClass("selected")?"add":"remove")+"Class"]("selected");var n=["prev","next"];$.each(n,function(e,i){var n=t.selectors["rootNav"+(i.charAt(0).toUpperCase()+i.slice(1).toLowerCase())],a=$(PF.obj.listing.selectors.content_listing_pagination+":visible").length>0?"add":t.getItem()[i]().exists()?"add":"remove";o[a+"Class"](n.substring(1))}),$.each(this.getItem().get(0).attributes,function(e,t){if(!t.name.startsWith("data-"))return!0;o.attr(t.name,t.value)});var a=void 0===this.object.user?"user":"guest";a="owner"+(a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()),this.getEl(a).remove(),void 0!==this.object.user&&$(this.object.user.avatar?".default-user-image":"img.user-image",this.getEl("ownerUser")).remove();var r=this.getItem().find(".list-item-image-tools");this.getEl("tools").append(r.html()),$.each(r.find("[data-action]"),function(e,o){var i=$(this).attr("data-action"),n=t.keymap[i];$('<div class="viewer-kb-key"><kbd>'+n[0]+"</kbd><span>"+n[1]+"</span></div>").appendTo(t.getEl("inputMap"))}),this.placeholderSizing(),this.trickyLoad()},toggleFullscreen:function(e){var t=e?this.getEl("root")[0]:document;(e?t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen:t.exitFullscreen||t.webkitExitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen).call(t)},fullscreen:function(){this.toggleFullscreen(!0)},normalscreen:function(){this.toggleFullscreen(!1)},remove:function(){this.getEl("root").remove()},getParsedTemplate:function(){var e=this.getObject(!0),t=this.getEl("template").html(),o=t.match(/%(\S+)%/g);return o&&$.each(o,function(o,i){var n;i.slice(1,-1).split(".").map(function(t){var o=n||e;t in o&&(n=o[t])});var a=new RegExp(i,"g");t=t.replace(a,n)}),t},insertEl:function(){var e=this.getParsedTemplate();this.getEl("rootZero").remove(),$(e).appendTo("body")},toggleIdle:function(e,t){var o=this,t=void 0===t||t;$("html")[(e?"add":"remove")+"Class"]("--idle"),e||(clearTimeout(o.idleTimer),t&&(o.idleTimer=setTimeout(function(){var e=$(".fullscreen"),t=o.getEl("root");o.toggleIdle(t.length>0&&0==e.length)},5e3)))},open:function(e){this.setItem(e),this.insertEl(),this.filler(),this.show(),this.toggleIdle(!1);var t=this;this.getEl("root").on("mousemove mouseout",function(){t.toggleIdle(!1)})},setItem:function(e){this.$item=e},trickyLoad:function(){var e=this.getEl("loader");if(this.object.image.url!=this.object.display_url){var t=this.getEl("src").parent().html(),o=$(t).attr("src",this.object.image.url);o.insertBefore(this.getEl("src")),PF.fn.loading.inline(e,{color:"white",size:"small",center:!0,valign:!0}),e.hide().fadeIn("slow"),o.imagesLoaded(function(){o.next().remove(),PF.fn.loading.destroy(e)})}else e.remove()},close:function(){var e=this;$(this.selectors.root).removeClass(this.selectors.rootShow.substring(1)).addClass(this.selectors.rootHide.substring(1)),$("body").removeClass(this.selectors.bodyShown.substring(1)),this.toggleIdle(!1,!1),setTimeout(function(){e.remove()},200)},browse:function(e){var t=this.getItem()[e]();if(t.exists()){this.setItem(t),this.filler(!0);var o=$(PF.obj.listing.selectors.content_listing_pagination,PF.obj.listing.selectors.content_listing_visible).find("[data-action=load-more]"),i=t[e+"All"]().length;o.length>0&&i<=5&&!PF.obj.listing.calling&&"next"==e&&$("[data-action=load-more]").click()}else{var n=$("[data-pagination="+e+"]",PF.obj.listing.selectors.content_listing_pagination+":visible").attr("href");if(!n)return;PF.fn.deparam(window.location.search);window.location.href=n+"&viewer="+e}},prev:function(){this.browse("prev")},next:function(){this.browse("next")}},CHV.obj.image_viewer={selector:"#image-viewer",container:"#image-viewer-container",navigation:".image-viewer-navigation",loading:"#image-viewer-loading",loader:"#image-viewer-loader"},CHV.obj.image_viewer.$container=$(CHV.obj.image_viewer.container),CHV.obj.image_viewer.$navigation=$(CHV.obj.image_viewer.navigation),CHV.obj.image_viewer.$loading=$(CHV.obj.image_viewer.loading),CHV.fn.bindSelectableItems=function(){var e="content-listing-wrapper",t="#"+e;$(t).exists()?$(t).hasClass("ui-selectable")&&$(t).selectable("destroy"):$("[data-content=list-selection]").closest(".content-width").wrap("<div id='"+e+"' />"),$("[data-content=list-selection]").exists()&&$("html.device-nonmobile "+t).selectable({delay:150,filter:PF.obj.listing.selectors.list_item,cancel:".content-empty, .header, #tab-share, #tab-full-info, .viewer-title, .header-link, .top-bar, .content-listing-pagination *, #fullscreen-modal, #top-user, #background-cover, .list-item-desc, .list-item-image-tools, [data-action=load-image], #tab-codes",selecting:function(e,t){var o=$(t.selecting),i=o.hasClass("selected");CHV.fn.list_editor[(i?"unselect":"select")+"Item"](o)},unselecting:function(e,t){CHV.fn.list_editor.unselectItem($(t.unselecting))}})},CHV.fn.isCachedImage=function(e){var t=new Image;return t.src=e,t.complete||t.width+t.height>0},CHV.fn.viewerImageZoomClass=function(){CHV.obj.image_viewer.$container.hasClass("jscursor-zoom-in")&&CHV.obj.image_viewer.$container.addClass("cursor-zoom-in").removeClass("jscursor-zoom-in")},CHV.fn.viewerLoadImage=function(){CHV.obj.image_viewer.$loading.exists()&&(CHV.obj.image_viewer.$loading.removeClass("soft-hidden").css({zIndex:2}),PF.fn.loading.inline(CHV.obj.image_viewer.$loading,{color:"white",size:"small",center:!0,valign:!0}),CHV.obj.image_viewer.$loading.hide().fadeIn("slow")),$(CHV.obj.image_viewer.loader).remove(),CHV.obj.image_viewer.image.html=CHV.obj.image_viewer.$container.html(),CHV.obj.image_viewer.$container.prepend($(CHV.obj.image_viewer.image.html).css({top:0,zIndex:0})),CHV.obj.image_viewer.$container.find("img").eq(0).css("zIndex",1),CHV.obj.image_viewer.$container.find("img").eq(1).attr("src",CHV.obj.image_viewer.image.url).css({width:"100%",height:"auto"}),CHV.obj.image_viewer.$container.find("img").eq(1).imagesLoaded(function(){CHV.obj.image_viewer.$container.find("img").eq(1).css({width:"",height:""}),CHV.obj.image_viewer.$container.find("img").eq(0).remove(),PF.fn.loading.destroy(CHV.obj.image_viewer.$loading)})},CHV.obj.embed_tpl={},CHV.obj.topBar={transparencyScrollToggle:function(){var e=$(window).scrollTop();$("#top-bar")[(e>0?"remove":"add")+"Class"]("transparent")}},CHV.obj.uploaderReset={isUploading:!1,canAdd:!0,queueStatus:"ready",uploadThreads:0,uploadParsedIds:[],uploadProcessedIds:[],files:{},results:{success:{},error:{}},toggleWorking:0,filesAddId:0,clipboardImages:[]},CHV.fn.uploader={selectors:{root:"#anywhere-upload",show:".upload-box--show",queue:"#anywhere-upload-queue",queue_complete:".queue-complete",queue_item:".queue-item",close_cancel:"[data-button=close-cancel]",file:"#anywhere-upload-input",camera:"#anywhere-upload-input-camera",upload_item_template:"#anywhere-upload-item-template",item_progress_bar:"[data-content=progress-bar]",item_progress_percent:"[data-text=progress-percent]",failed_result:"[data-content=failed-upload-result]",fullscreen_mask:"#fullscreen-uploader-mask",dropzone:"#uploader-dropzone",paste:"#anywhere-upload-paste",input:"[data-action=anywhere-upload-input]"},toggle:function(e,t){this.queueSize();var o=$("[data-action=top-bar-upload]",".top-bar"),i=!$(CHV.fn.uploader.selectors.root).data("shown");if(void 0!==(e=$.extend({callback:null,reset:!0},e)).show&&e.show&&(i=!0),PF.fn.growl.close(!0),PF.fn.close_pops(),!(1==this.toggleWorking||$(CHV.fn.uploader.selectors.root).is(":animated")||CHV.fn.uploader.isUploading||o.data("login-needed")&&!PF.fn.is_user_logged())){this.toggleWorking=1;var n={time:500,easing:null},a=function(){!i&&e.reset&&CHV.fn.uploader.reset(),PF.obj.follow_scroll.$node.exists()&&(PF.obj.follow_scroll.$node.removeClass("fixed"),PF.obj.follow_scroll.set()),PF.fn.topMenu.hide(),"function"==typeof e.callback&&e.callback(t),CHV.fn.uploader.boxSizer(),CHV.fn.uploader.toggleWorking=0};if($(CHV.fn.uploader.selectors.root)[(i?"add":"remove")+"Class"](this.selectors.show.substring(1)),i){if(!$("body").is("#upload")&&PF.fn.isDevice(["phone","phablet"])&&$("html").addClass("overflow-hidden"),$("html").data({"followed-scroll":$("html").hasClass("followed-scroll"),"top-bar-box-shadow-prevent":!0}).removeClass("followed-scroll"),$("#top-bar").data({stock_classes:$("#top-bar").attr("class")}),$(".current[data-nav]",".top-bar").each(function(){$(this).is("[data-action=top-bar-menu-full]")||$(this).removeClass("current").attr("data-current",1)}),PF.fn.isDevice("mobile")){var r=$(".upload-box-heading",$(CHV.fn.uploader.selectors.root));r.css({position:"relative",top:.5*($(window).height()-r.height())+"px"})}e.reset&&CHV.fn.uploader.reset(),CHV.fn.uploader.focus(function(){setTimeout(function(){a()},n.time)})}else{$("[data-nav][data-current=1]",".top-bar").each(function(){$(this).addClass("current")}),$(CHV.fn.uploader.selectors.fullscreen_mask).css({opacity:0}),setTimeout(function(){$(CHV.fn.uploader.selectors.fullscreen_mask).remove(),$("html").data("followed-scroll")&&$("html").addClass("followed-scroll")},250);var s=$(CHV.fn.uploader.selectors.root).outerHeight()-parseInt($(CHV.fn.uploader.selectors.root).data("initial-height"))+"px";$(CHV.fn.uploader.selectors.root).css({transform:"translate(0,-"+s+")"}),setTimeout(function(){$("#top-bar").attr("class",$("#top-bar").data("stock_classes")),$("html").removeClass($(".follow-scroll-wrapper.position-fixed").exists()?"":"top-bar-box-shadow-none")},1*n.time/3),setTimeout(function(){$(CHV.fn.uploader.selectors.root).css({top:""}),$("body#image").exists()&&CHV.obj.topBar.transparencyScrollToggle(),a(),$("html,body").removeClass("overflow-hidden").data({"top-bar-box-shadow-prevent":!1})},n.time)}$(CHV.fn.uploader.selectors.root).data("shown",i),o.toggleClass("current").removeClass("opened")}},reset:function(){$.extend(this,$.extend(!0,{},CHV.obj.uploaderReset)),$("li",this.selectors.queue).remove(),$(this.selectors.root).height("").css({"overflow-y":"","overflow-x":""}),$(this.selectors.queue).addClass("queueEmpty").removeClass(this.selectors.queue_complete.substring(1)),$(this.selectors.input,this.selectors.root).each(function(){}),$("[data-group=upload-result] textarea",this.selectors.root).prop("value",""),$.each(["upload-queue-ready","uploading","upload-result","upload-queue-ready","upload-queue"],function(e,t){$("[data-group="+t+"]").hide()}),$("[data-group=upload]",this.selectors.root).show(),$("[name=upload-album-id]",this.selectors.root).prop("value",function(){var e=$("option[selected]",this);if(e.exists())return e.attr("value")}),$(this.selectors.root).removeClass("queueCompleted queueReady queueHasResults").addClass("queueEmpty").attr("data-queue-size",0),$("[name=upload-category-id]",this.selectors.root).prop("value",""),$("[name=upload-nsfw]",this.selectors.root).prop("checked",this.defaultChecked),this.boxSizer(!0)},focus:function(e){$(this.selectors.fullscreen_mask).exists()||($("body").is("#upload")||$("body").append($("<div/>",{id:this.selectors.fullscreen_mask.replace("#",""),class:"fullscreen soft-black"}).css({top:PF.fn.isDevice("phone")?0:$(CHV.fn.uploader.selectors.root).data("top")})),setTimeout(function(){$("body").is("#upload")||$(CHV.fn.uploader.selectors.fullscreen_mask).css({opacity:1}),setTimeout(function(){"function"==typeof e&&e()},PF.fn.isDevice(["phone","phablet"])?0:250)},1))},boxSizer:function(e){var t=$(this.selectors.root).is(this.selectors.show),o=t||e;t&&!$("body").is("#upload")&&$("html")[(PF.fn.isDevice(["phone","phablet"])?"add":"remove")+"Class"]("overflow-hidden"),o&&($(this.selectors.root).height(""),!$("body").is("#upload")&&$(this.selectors.root).height()>$(window).height()?($(this.selectors.root).height($(window).height()).css({"overflow-y":"scroll","overflow-x":"auto"}),$("body").addClass("overflow-hidden")):($(this.selectors.root).css("overflow-y",""),$("body").removeClass("overflow-hidden")))},pasteURL:function(){var e=$("[name=urls]","#fullscreen-modal").val();void 0!==e&&"undefined"!=e&&""!=e&&CHV.fn.uploader.add({},e)},pasteImageHandler:function(e){if(!$(e.target).is(":input")){if(void 0!==e.clipboardData&&e.clipboardData.items)var t=e.clipboardData.items;else setTimeout(function(){return e.clipboardData={},e.clipboardData.items=[],$.each($("img",CHV.fn.uploader.$pasteCatcher),function(t,o){e.clipboardData.items.push(PF.fn.dataURItoBlob($(this).attr("src")))}),$(CHV.fn.uploader.selectors.paste).html(""),CHV.fn.uploader.pasteImageHandler(e)},1);if(t)if(0==t.length){if(void 0!==window.clipboardData&&window.clipboardData.getData){var o=window.clipboardData.getData("Text");void 0!==o&&"undefined"!=o&&""!=o&&($(CHV.fn.uploader.selectors.root).data("shown")?CHV.fn.uploader.add({},o):CHV.fn.uploader.toggle({callback:function(){CHV.fn.uploader.add({},o)}}))}}else{for(var i=!1,n=0;n<t.length;n++)-1!==t[n].type.indexOf("image")&&(i=!0);for(n=0;n<t.length;n++)if(-1!==t[n].type.indexOf("image")){var a=t[n]instanceof Blob?t[n]:t[n].getAsFile(),r=new FileReader;r.onload=function(e){var t=$(CHV.fn.uploader.selectors.root).data("shown");a.name=PF.fn._s("Clipboard image")+" "+PF.fn.getDateTime();var o={originalEvent:{dataTransfer:{files:[a]},preventDefault:function(){},stopPropagation:function(){},clipboard:!0,dataURL:e.target.result,name:a.name}};t?CHV.fn.uploader.add(o):CHV.fn.uploader.toggle({callback:function(){CHV.fn.uploader.add(o)}})},r.readAsDataURL(a)}else"string"==t[n].kind&&-1!==t[n].type.indexOf("text")&&-1===t[n].type.indexOf("html")&&0==i&&t[n].getAsString(function(e){void 0!==e&&"undefined"!=e&&""!=e&&($(CHV.fn.uploader.selectors.root).data("shown")?CHV.fn.uploader.add({},e):CHV.fn.uploader.toggle({callback:function(){CHV.fn.uploader.add({},e)}}))})}}},add:function(e,t){function o(e,i){if(e in a){var n=a[e];$(CHV.fn.uploader.selectors.queue_item+":not([data-id]) .load-url",CHV.fn.uploader.selectors.queue)[void 0!==n.url?"show":"remove"](),loadImage.parseMetaData(n.url?n.url:n,function(s){$(CHV.fn.uploader.selectors.queue_item+":not([data-id]) .preview:empty",CHV.fn.uploader.selectors.queue).first().closest("li").attr("data-id",n.uid),loadImage(n.url?n.url:n,function(e){++g;var l=$(CHV.fn.uploader.selectors.queue_item+"[data-id="+n.uid+"]",CHV.fn.uploader.selectors.queue);if("error"===e.type){if(void 0===v[n.uid])if(v[n.uid]=0,void 0!==n.url&&"undefined"!=n.url&&""!=n.url){var d=new XMLHttpRequest;d.open("GET",PF.obj.config.json_api+"?action=image&auth_token="+PF.obj.config.auth_token+"&url="+encodeURIComponent(n.url),!0),d.timeout=3e4,d.send(),d.onreadystatechange=function(){if(4==this.readyState){v[n.uid]=1;var e=!1;if(200==d.status){var i="json"!==this.responseType?JSON.parse(this.response):this.response;if(void 0!==i&&void 0!==i.urls&&1==i.urls.length){if(t=i.urls[0],void 0===CHV.fn.uploader.files[n.uid])return void PF.fn.loading.destroy("fullscreen");a[n.uid]={uid:n.uid,name:n.url,url:t},CHV.fn.uploader.files[n.uid]=a[n.uid],e=!0}}e||r.push({uid:n.uid,name:n.name.truncate_middle()}),o(n.uid,!0)}}}else v[n.uid]=1,r.push({uid:n.uid,name:n.name.truncate_middle()})}else{$("[data-group=upload-queue]",CHV.fn.uploader.selectors.root).is(":visible")||$("[data-group=upload-queue]",CHV.fn.uploader.selectors.root).css("display","block");var c="image/jpeg";if(void 0!==s.buffer){for(var u=new Uint8Array(s.buffer).subarray(0,4),f="",h=0;h<u.length;h++)f+=u[h].toString(16);var p={"89504e47":"image/png",47494638:"image/gif",ffd8ffe0:"image/jpeg"};$.each(["ffd8ffe1","ffd8ffe2"],function(e,t){p[t]=p.ffd8ffe0}),void 0!==p[f]&&(c=p[f])}var b=null;if(void 0!==n.name){var w=decodeURIComponent(PF.fn.baseName(n.name));b=$.trim(w.substring(0,100).capitalizeFirstLetter())}if(void 0===CHV.fn.uploader.files[n.uid])return void PF.fn.loading.destroy("fullscreen");CHV.fn.uploader.files[n.uid].parsedMeta={title:b,width:e.originalWidth,height:e.originalHeight,mimetype:c},l.show(),$(CHV.fn.uploader.selectors.root).addClass("queueReady").removeClass("queueEmpty"),$("[data-group=upload-queue-ready]",CHV.fn.uploader.selectors.root).show(),$("[data-group=upload]",CHV.fn.uploader.selectors.root).hide(),l.find(".load-url").remove(),l.find(".preview").removeClass("soft-hidden").show().append(e),$img=l.find(".preview").find("img,canvas"),$img.attr("class","canvas"),queue_item_h=l.height(),queue_item_w=l.width();var y=parseInt($img.attr("width"))||$img.width(),_=parseInt($img.attr("height"))||$img.height(),P=y/_;if($img.hide(),y>_||y==_){var F=_<queue_item_h?_:queue_item_h;y>_&&$img.height(F).width(F*P)}if(y<_||y==_){var x=y<queue_item_w?y:queue_item_w;y<_&&$img.width(x).height(x/P)}y==_&&$img.height(F).width(x),$img.css({marginTop:-$img.height()/2,marginLeft:-$img.width()/2}).show(),CHV.fn.uploader.boxSizer()}if(1==v.every(function(e){return e>0})&&(g==a.length||1==i)){if(void 0!==m&&(r=r.concat(m)),PF.fn.loading.destroy("fullscreen"),r.length>0){for(var j="",h=0;h<r.length;h++)j+="<li>"+r[h].name+"</li>",delete CHV.fn.uploader.files[r[h].uid],$("li[data-id="+r[h].uid+"]",CHV.fn.uploader.selectors.queue).find("[data-action=cancel]").click();PF.fn.modal.simple({title:PF.fn._s("Some files couldn't be added"),message:"<ul>"+j+"</ul>"})}else CHV.fn.uploader.focus();CHV.fn.uploader.boxSizer()}},$.extend({},b,{orientation:s.exif?s.exif.get("Orientation"):1})),setTimeout(function(){o(e+1,!1)},25)})}else PF.fn.loading.destroy("fullscreen")}var i;if(!this.canAdd)return(e=e.originalEvent).preventDefault(),e.stopPropagation(),!1;$fileinput=$(this.selectors.file),$fileinput.replaceWith($fileinput=$fileinput.clone(!0));var n=$(this.selectors.upload_item_template).html(),a=[];if(void 0===t){if((e=e.originalEvent).preventDefault(),e.stopPropagation(),a=e.dataTransfer||e.target,a=$.makeArray(a.files),e.clipboard){if(i=PF.fn.md5(e.dataURL),-1!=$.inArray(i,this.clipboardImages))return null;this.clipboardImages.push(i)}for(var r=[],s=0;s<a.length;s++){var l,d=a[s];l=void 0===d.type||""==d.type?d.name.substr(d.name.lastIndexOf(".")+1).toLowerCase():d.type.replace("image/",""),d.size>CHV.obj.config.image.max_filesize?r.push({uid:s,name:d.name.truncate_middle()+" - "+PF.fn._s("File too big.")}):-1!=CHV.obj.config.upload.image_types.indexOf(l)||0!=/android/i.test(navigator.userAgent)?(i&&(d.md5=i),d.fromClipboard=1==e.clipboard,d.uid=s):r.push({uid:s,name:d.name.truncate_middle()+" - "+PF.fn._s("Invalid or unsupported file format.")})}for(s=0;s<r.length;s++){var c=r[s];a.splice(c.id,1)}if(r.length>0&&0==a.length){for(var u="",s=0;s<r.length;s++)u+="<li>"+r[s].name+"</li>";return void PF.fn.modal.simple({title:PF.fn._s("Some files couldn't be added"),message:"<ul><li>"+u+"</ul>"})}if(0==a.length)return}else{var f=(t=t.replace(/(\[([^\]]+)\])/g,"")).match_image_urls();if(t=t.replace(/(<([^>]+)>)/g,""),f)for(index=0;index<f.length;++index)t=t.replace(f[index],""),t+="\n"+f[index];if(!(a=t.match_urls()))return;a=a.array_unique(),a=a.filter(function(e){return-1!==e.indexOf("/")&&-1!==e.indexOf(".")}),a=$.map(a,function(e,t){return{uid:t,name:e,url:e}})}if($.isEmptyObject(this.files))for(s=0;s<a.length;s++)this.files[a[s].uid]=a[s],this.filesAddId++;else{var h=[];for(var p in this.files)void 0!==this.files[p]&&"function"!=typeof this.files[p]&&h.push(encodeURI(this.files[p].name));a=$.map(a,function(e,t){if("undefined"!==e.fromClipboard&&1==e.fromClipboard);else if(-1!=$.inArray(encodeURI(e.name),h))return null;return e.uid=CHV.fn.uploader.filesAddId+t,CHV.fn.uploader.filesAddId++,e});for(s=0;s<a.length;s++)this.files[a[s].uid]=a[s]}$(this.selectors.queue,this.selectors.root).append(n.repeat(a.length)),$(this.selectors.queue+" "+this.selectors.queue_item+":not([data-id])",this.selectors.root).hide();var m=r,r=[],g=0,b={canvas:!0,maxWidth:590},v=[];a.length>0&&(PF.fn.loading.fullscreen(),o(0,!1),this.queueSize())},queueSize:function(){$(this.selectors.root).attr("data-queue-size",Object.size(this.files)),$("[data-text=queue-objects]",this.selectors.root).text(PF.fn._n("image","images",Object.size(this.files))),$("[data-text=queue-size]",this.selectors.root).text(Object.size(this.files))},queueProgress:function(e,t){var o=Object.size(this.files);this.files[t].progress=e.loaded/e.total;for(var i=0,n=0;n<o;n++)void 0!==this.files[n]&&"progress"in this.files[n]&&(i+=this.files[n].progress);$("[data-text=queue-progress]",this.selectors.root).text(parseInt(100*i/o))},upload:function(e){var t=e.data("id"),o=!!e.next().exists()&&e.next().data("id");if(-1===$.inArray(t,this.uploadParsedIds)){var i=this;this.uploadParsedIds.push(t);var n=this.files[t];if(void 0!==n){var a=void 0!==n.url,r=a?n.url:n,s=void 0!==n.formValues;if(void 0!==n){this.uploadThreads+=1,this.uploadThreads<2&&o&&this.upload(e.next()),this.isUploading=!0;var l=new FormData,d={source:null,type:a?"url":"file",action:"upload",privacy:$("[data-privacy]",this.selectors.root).first().data("privacy"),timestamp:this.timestamp,auth_token:PF.obj.config.auth_token,category_id:$("[name=upload-category-id]",this.selectors.root).val()||null,nsfw:$("[name=upload-nsfw]",this.selectors.root).prop("checked")?1:0,album_id:$("[name=upload-album-id]",this.selectors.root).val()||null};a?d.source=r:l.append("source",r,n.name),void 0!==CHV.obj.config.location&&(d.url=CHV.obj.config.location),void 0!==CHV.obj.config.mode&&(d.mode=CHV.obj.config.mode),s&&$.each(n.formValues,function(e,t){d[e.replace(/image_/g,"")]=t}),$.each(d,function(e,t){if(null===t)return!0;l.append(e,t)}),this.files[t].xhr=new XMLHttpRequest,e.removeClass("waiting"),$(".block.edit, .queue-item-button.edit",e).remove(),a?(this.queueSize(),this.queueProgress({loaded:1,total:1},t),this.itemLoading(e)):this.files[t].xhr.upload.onprogress=function(o){o.lengthComputable&&(CHV.fn.uploader.queueProgress(o,t),percentComplete=parseInt(o.loaded/o.total*100),$(CHV.fn.uploader.selectors.item_progress_percent,e).text(percentComplete),$(CHV.fn.uploader.selectors.item_progress_bar,e).width(100-percentComplete+"%"),100==percentComplete&&($(CHV.fn.uploader.selectors.item_progress_percent,e).text(""),CHV.fn.uploader.itemLoading(e)))},this.files[t].xhr.onreadystatechange=function(){var n=!1;if(4==this.readyState&&void 0!==CHV.fn.uploader.files[t].xhr&&0!==CHV.fn.uploader.files[t].xhr.status){i.uploadProcessedIds.push(t),i.uploadThreads-=1,$(".loading-indicator",e).remove(),e.removeClass("waiting uploading");try{var a="json"!==this.responseType?JSON.parse(this.response):this.response;void 0!==a&&200==this.status?$("[data-group=image-link]",e).attr("href",a.image.url_viewer):("PDOException"==a.error.context&&(a.error.message="Database error"),a.error.message=CHV.fn.uploader.files[t].name.truncate_middle()+" - "+a.error.message),CHV.fn.uploader.results[200==this.status?"success":"error"][t]=a,200!==this.status&&(n=!0)}catch(e){n=!0;var r;r=void 0===a?{status:500,statusText:"Internal server error"}:{status:400,statusText:a.error.message},a={status_code:r.status,error:{message:CHV.fn.uploader.files[t].name.truncate_middle()+" - Server error ("+r.statusText+")",code:r.status,context:"XMLHttpRequest"},status_txt:r.statusText};var s=Object.size(CHV.fn.uploader.results.error)+1;CHV.fn.uploader.results.error[s]=a}e.addClass(n?"failed":"completed"),void 0!==a.error&&void 0!==a.error.message&&(e.attr("rel","tooltip").data("tiptip","top").attr("title",a.error.message),PF.fn.bindtipTip(e)),i.uploadThreads<2&&o&&(CHV.fn.uploader.upload(e.next()),$(CHV.fn.uploader.selectors.root).addClass("queueHasResults")),i.uploadProcessedIds.length==Object.size(i.files)&&CHV.fn.uploader.displayResults(),$(".done",e).fadeOut()}},this.files[t].xhr.open("POST",PF.obj.config.json_api,!0),this.files[t].xhr.setRequestHeader("Accept","application/json"),this.files[t].xhr.send(l)}else e.next().exists()&&this.upload(e.next())}}else e.next().exists()&&this.upload(e.next())},itemLoading:function(e){PF.fn.loading.inline($(".progress",e),{color:"#FFF",size:"normal",center:!0,position:"absolute",shadow:!0}),$("[data-action=cancel], [data-action=edit]",e).hide()},displayResults:function(){CHV.fn.uploader.isUploading=!1;for(var e=["error","mixed","success"],t={},o=0;o<e.length;o++)t[e[o]]="[data-group=upload-result][data-result=%RESULT%]".replace("%RESULT%",e[o]);if(Object.size(this.results.error)>0){var i=[];for(var o in this.results.error)"object"==typeof this.results.error[o]&&(i[o]=this.results.error[o].error.message);i.length>0&&$(this.selectors.failed_result).html("<li>"+i.join("</li><li>")+"</li>")}else $(t.error,this.selectors.root).hide();if($("[data-text=queue-progress]",this.selectors.root).text(100),$("[data-group=uploading]",this.selectors.root).hide(),$(this.selectors.root).removeClass("queueUploading queueHasResults").addClass("queueCompleted"),$(this.selectors.queue).addClass(this.selectors.queue_complete.substring(1)),Object.size(this.results.success)>0&&$("[data-group=upload-result] textarea",this.selectors.root).exists()&&(CHV.fn.fillEmbedCodes(this.results.success,CHV.fn.uploader.selectors.root,"val"),void 0!==CHV.obj.config.location&&-1!==window.name.indexOf("imgbb_"))){if(CHV.obj.config.hotlink)n=$("textarea[name=bbcode-embed-medium]",CHV.fn.uploader.selectors.root);else var n=$("textarea[name=bbcode-embed-thumbnail]",CHV.fn.uploader.selectors.root);if(n.length>0&&""!=n.val()){if((n.val().match(/ /g)||[]).length>5)a=encodeURIComponent("\n"+n.val().replace(new RegExp("\n","g")," ").replace(new RegExp("  ","g")," ").replace(new RegExp("`","g")," ")+"\n");else var a=encodeURIComponent("\n"+n.val().replace(new RegExp(" ","g"),"\n").replace(new RegExp("\n","g"),"\n\n").replace(new RegExp("\n\n\n","g"),"\n\n").replace(new RegExp("`","g")," ")+"\n");var r=window.navigator.userAgent,s=CHV.obj.config.location+"#"+window.name;r.indexOf("MSIE ")>0||r.indexOf("Trident/")>0||r.indexOf("Edge/")>0?s=CHV.obj.config.location+"#"+a:window.name=a,"undefined"!=typeof localStorage&&localStorage.setItem("code",a),window.location.href=s}}if(Object.size(this.results.success)>0&&Object.size(this.results.error)>0?$(t.mixed+", "+t.success,this.selectors.root).show():Object.size(this.results.success)>0?$(t.success,this.selectors.root).show():Object.size(this.results.error)>0&&$(t.error,this.selectors.root).show(),$(t.success,this.selectors.root).is(":visible")&&($(t.success,this.selectors.root).find("[data-group^=user], [data-group=guest]").hide(),$(t.success,this.selectors.root).find("[data-group="+(PF.fn.is_user_logged()?"user":"guest")+"]").show(),Object.size(this.results.success)>0)){var l=Object.keys(this.results.success)[0];if(void 0!==this.results.success[l].image.album){var d=[];for(var c in this.results.success){var u=this.results.success[c].image;u.album&&u.album.id_encoded&&-1==d.indexOf(u.album.id_encoded)&&d.push(u.album.id_encoded)}var f={link:null,text:null};if(d.length<=1?(f.link=this.results.success[l].image.album.url,f.text=this.results.success[l].image.album.name):(f.link=this.results.success[l].image.user.url_albums,f.text=PF.fn._s("%s's Albums",this.results.success[l].image.user.name_short_html)),$("[data-text=upload-target]",this.selectors.root).text(f.text),$("[data-link=upload-target]",this.selectors.root).attr("href",f.link),PF.fn.is_user_logged()){var h=d.length>0?"album":"stream";$("[data-group=user-"+h+"]",this.selectors.root).show()}}}if(this.boxSizer(),this.queueStatus="done",window.opener&&"/upload"==window.location.pathname&&""==window.location.search.substr(1)&&void 0!==CHV.obj.opener.uploadPlugin[window.name]){if($('[data-action="copy"]',this.selectors.root).remove(),CHV.obj.opener.uploadPlugin[window.name].hasOwnProperty("autoInsert")&&CHV.obj.opener.uploadPlugin[window.name].autoInsert){var p=$(':input[name="'+CHV.obj.opener.uploadPlugin[window.name].autoInsert+'"]',CHV.fn.uploader.selectors.root).val();if(p)return window.opener.postMessage({id:window.name,message:p},"*"),void window.close()}}else $('[data-action="openerPostMessage"]',this.selectors.root).remove()}},$.extend(CHV.fn.uploader,$.extend(!0,{},CHV.obj.uploaderReset)),CHV.fn.fillEmbedCodes=function(e,t,o){void 0===o&&(o="val");var i=getCookie("USER_SELECTED_EMBED");"undefined"!==i&&$('#form-embed-toggle-combo div[data-combo-value="'+i+'"]',t).length>0&&($("#form-embed-toggle",t).find("option").attr("selected",!1),$('#form-embed-toggle option[value="'+i+'"]',t).attr("selected","selected"),$("#form-embed-toggle-combo div[data-combo-value]",t).addClass("soft-hidden"),$('#form-embed-toggle-combo div[data-combo-value="'+i+'"]',t).removeClass("soft-hidden")),$.each(e,function(e,i){if(void 0!==i){var n="id_encoded"in i?i:i.image;if(!n.medium){n.medium={};for(var a=["filename","name","width","height","extension","size","size_formatted","url"],r=0;r<a.length;r++)n.medium[a[r]]=n[a[r]]}var s=Object.flatten(n);$.each(CHV.obj.embed_tpl,function(e,i){$.each(i.options,function(e,i){var n=i,a=$("textarea[name="+e+"]",t),r=n.template;for(var l in s)s.hasOwnProperty(l)&&(r=r.replace(new RegExp("%"+l.toUpperCase()+"%","g"),s[l]));a[o](a.val()+r+("thumb"==a.data("size")?" ":"\n"))})})}}),$.each(CHV.obj.embed_tpl,function(e,i){$.each(i.options,function(e,n){var a=$("textarea[name="+e+"]",t);if(void 0!==i.backlink){var r=i.backlink;void 0!==CHV.obj.config.location?-1!==window.name.indexOf("imgbb_")&&(r=r.replace(new RegExp(" ","g"),"`")):"thumb"==a.data("size")&&(r=""),a[o]($.trim(a.val())+r)}else a[o]($.trim(a.val()))})})},CHV.fn.resource_privacy_toggle=function(e){e||(e="public"),$("[data-content=privacy-private]").hide(),"public"!==e&&$("[data-content=privacy-private]").show()},CHV.fn.submit_create_album=function(){var e=$(PF.obj.modal.selectors.root);return""==$("[name=form-album-name]",e).val()?(PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1):(PF.obj.modal.form_data={action:"create-album",type:"album",album:{name:$("[name=form-album-name]",e).val(),description:$("[name=form-album-description]",e).val(),privacy:$("[name=form-privacy]",e).val(),password:"password"==$("[name=form-privacy]",e).val()?$("[name=form-album-password]",e).val():null,new:!0}},!0)},CHV.fn.complete_create_album={success:function(e){var t=e.responseJSON.album;window.location=t.url},error:function(e){var t=e.responseJSON;PF.fn.growl.call(PF.fn._s(t.error.message))}},CHV.fn.submit_upload_edit=function(){var e=$(PF.obj.modal.selectors.root),t=!1;return $("[data-content=form-new-album]",e).is(":visible")&&""==$("[name=form-album-name]",e).val()?(PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1):($("[data-content=form-new-album]",e).is(":visible")&&(t=!0),PF.obj.modal.form_data={action:t?"create-album":"move",type:"images",album:{ids:$.map(CHV.fn.uploader.results.success,function(e){return e.image.id_encoded}),new:t}},t?(PF.obj.modal.form_data.album.name=$("[name=form-album-name]",e).val(),PF.obj.modal.form_data.album.description=$("[name=form-album-description]",e).val(),PF.obj.modal.form_data.album.privacy=$("[name=form-privacy]",e).val(),"password"==PF.obj.modal.form_data.album.privacy&&(PF.obj.modal.form_data.album.password=$("[name=form-album-password]",e).val())):PF.obj.modal.form_data.album.id=$("[name=form-album-id]",e).val(),!0)},CHV.fn.complete_upload_edit={success:function(e){var t=e.responseJSON.album;window.location=t.url},error:function(e){var t=e.responseJSON;PF.fn.growl.call(PF.fn._s(t.error.message))}},CHV.fn.before_image_edit=function(){var e=$("[data-ajax-deferred='CHV.fn.complete_image_edit']");$("[data-content=form-new-album]",e).hide(),$("#move-existing-album",e).show()},CHV.fn.submit_image_edit=function(){var e=$(PF.obj.modal.selectors.root),t=!1;return $("[data-content=form-new-album]",e).is(":visible")&&""==$("[name=form-album-name]",e).val()?(PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1):($("[data-content=form-new-album]",e).is(":visible")&&(t=!0),PF.obj.modal.form_data={action:"edit",edit:"image",editing:{id:CHV.obj.resource.id,category_id:$("[name=form-category-id]",e).val()||null,title:$("[name=form-image-title]",e).val()||null,description:$("[name=form-image-description]",e).val()||null,nsfw:$("[name=form-nsfw]",e).prop("checked")?1:0,new_album:t}},t?(PF.obj.modal.form_data.editing.album_privacy=$("[name=form-privacy]",e).val(),"password"==PF.obj.modal.form_data.editing.album_privacy&&(PF.obj.modal.form_data.editing.album_password=$("[name=form-album-password]",e).val()),PF.obj.modal.form_data.editing.album_name=$("[name=form-album-name]",e).val(),PF.obj.modal.form_data.editing.album_description=$("[name=form-album-description]",e).val()):PF.obj.modal.form_data.editing.album_id=$("[name=form-album-id]",e).val(),!0)},CHV.fn.complete_image_edit={success:function(e){var t=e.responseJSON.image;if(t.album.id_encoded||(t.album.id_encoded=""),CHV.obj.image_viewer.album.id_encoded!==t.album.id_encoded){CHV.obj.image_viewer.album.id_encoded=t.album.id_encoded;var o={html:t.album.slice&&t.album.slice.html?t.album.slice.html:null,prev:t.album.slice&&t.album.slice.prev?t.album.slice.prev:null,next:t.album.slice&&t.album.slice.next?t.album.slice.next:null};$("[data-content=album-slice]").html(o.html),$("[data-content=album-panel-title]")[o.html?"show":"hide"](),$("a[data-action=prev]").attr("href",o.prev),$("a[data-action=next]").attr("href",o.next),$("a[data-action]",".image-viewer-navigation").each(function(){$(this)[void 0===$(this).attr("href")?"addClass":"removeClass"]("hidden")})}CHV.fn.resource_privacy_toggle(t.album.privacy),$.each(["description","title"],function(e,o){var i=$("[data-text=image-"+o+"]");i.html(PF.fn.nl2br(PF.fn.htmlEncode(t[o]))),""!==i.html()&&i.show()}),CHV.fn.common.updateDoctitle(t.title),PF.fn.growl.expirable(PF.fn._s("Image edited successfully.")),CHV.fn.list_editor.addAlbumtoModals(t.album);var i=$("[data-submit-fn='CHV.fn.submit_image_edit']");$.each(["description","name","password"],function(e,t){var o=$("[name=form-album-"+t+"]",i);o.is("textarea")?o.val("").html(""):o.val("").attr("value","")}),$("[name=form-privacy] option",i).each(function(){$(this).removeAttr("selected")}),$("[data-combo-value=password]",i).hide(),$("[name=form-album-id]",i).find("option").removeAttr("selected"),$("[name=form-album-id]",i).find('[value="'+t.album.id_encoded+'"]').attr("selected",!0)}},CHV.fn.before_album_edit=function(e){$("[data-action=album-switch]","[data-before-fn='CHV.fn.before_album_edit']").remove()},CHV.fn.submit_album_edit=function(){var e=$(PF.obj.modal.selectors.root);return $("[name=form-album-name]",e).val()?(PF.obj.modal.form_data={action:"edit",edit:"album",editing:{id:CHV.obj.resource.id,name:$("[name=form-album-name]",e).val(),privacy:$("[name=form-privacy]",e).val(),description:$("[name=form-album-description]",e).val()}},"password"==PF.obj.modal.form_data.editing.privacy&&(PF.obj.modal.form_data.editing.password=$("[name=form-album-password]",e).val()),!0):(PF.fn.growl.call(PF.fn._s("You must enter the album name.")),$("[name=form-album-name]",e).highlight(),!1)},CHV.fn.complete_album_edit={success:function(e){var t=e.responseJSON.album;$("[data-text=album-name]").html(PF.fn.htmlEncode(t.name)),$("[data-text=album-description]").html(PF.fn.htmlEncode(t.description)),CHV.fn.resource_privacy_toggle(t.privacy);var o=CHV.obj.resource.type;CHV.obj.resource.type=null,CHV.fn.list_editor.updateItem($(".list-item"),e.responseJSON),CHV.obj.resource.type=o,$("[data-modal]").each(function(){$('option[value="'+t.id_encoded+'"]',this).text(t.name+("public"!==t.privacy?" ("+PF.fn._s("private")+")":""))}),CHV.fn.common.updateDoctitle(t.name),PF.fn.growl.expirable(PF.fn._s("Album edited successfully."))}},CHV.fn.common={validateForm:function(e){if(void 0===e)var e=PF.obj.modal.selectors.root;var t=!0;return $.each($(":input:visible",e),function(e,o){""==$(this).val()&&$(this).attr("required")&&($(this).highlight(),t=!1)}),!!t||(PF.fn.growl.call(PF.fn._s("Please fill all the required fields.")),!1)},updateDoctitle:function(e){void 0!==CHV.obj.page_info&&(CHV.obj.page_info.pre_doctitle=e,CHV.obj.page_info.doctitle=CHV.obj.page_info.pre_doctitle+CHV.obj.page_info.pos_doctitle,document.title=CHV.obj.page_info.doctitle)}},CHV.fn.submit_resource_delete=function(){return PF.obj.modal.form_data={action:"delete",delete:CHV.obj.resource.type,from:"resource",owner:void 0!==CHV.obj.resource.user?CHV.obj.resource.user.id:null,deleting:CHV.obj.resource},!0},CHV.fn.complete_resource_delete={success:function(e){e.responseJSON;$("body").fadeOut("normal",function(){var e;void 0!==(e="album"==CHV.obj.resource.type||"image"==CHV.obj.resource.type?CHV.obj.resource.parent_url:CHV.obj.resource.user?CHV.obj.resource.user.url:CHV.obj.resource.url)&&(window.location=e+"?deleted")})}},CHV.fn.list_editor={selectionCount:function(){$(PF.obj.listing.selectors.content_listing).each(function(){var e=$("[data-content=pop-selection]","[data-content=list-selection][data-tab="+$(this).attr("id")+"]"),t=$(PF.obj.listing.selectors.list_item+".selected",this).length;all_count=$(PF.obj.listing.selectors.list_item,this).length,e[t>0?"removeClass":"addClass"]("disabled"),$("[data-text=selection-count]",e).text(t>0?t:""),$(this).is(":visible")&&CHV.fn.list_editor.listMassActionSet(all_count==t?"clear":"select")})},removeFromList:function(e,t){if(void 0!==e){var e=e instanceof jQuery==0?$(e):e,o=$(PF.obj.listing.selectors.content_listing_visible),i=e.length;e.fadeOut("fast");var n=e.first().data("type"),a=parseInt($("[data-text="+n+"-count]").text())-i;CHV.fn.list_editor.updateUserCounters(e.first().data("type"),i,"-"),e.promise().done(function(){$("body").removeClass(CHV.fn.listingViewer.selectors.bodyShown.substr(1));var n={};e.each(function(){$("[data-id="+$(this).data("id")+"]").each(function(){var e=$(this).closest(PF.obj.listing.selectors.content_listing).attr("id");n[e]||(n[e]=0),n[e]+=1})}),1==i?$("[data-id="+$(this).data("id")+"]").remove():e.each(function(){$("[data-id="+$(this).data("id")+"]").remove()}),PF.fn.listing.columnizerQueue(),PF.fn.listing.refresh(),CHV.fn.list_editor.selectionCount(),void 0!==t&&"string"==typeof t&&PF.fn.growl.expirable(t);for(var r in n){var s=$("#"+r),l=s.data("offset"),d=-n[r];l=void 0===l?0:parseInt(l),s.data("offset",l+d)}$(PF.obj.listing.selectors.content_listing_pagination,o).exists()||0!=$(".list-item",o).length||(a=0),0==a?(o.html(PF.obj.listing.template.empty),$(PF.obj.listing.selectors.content_listing+":not("+PF.obj.listing.selectors.content_listing_visible+")").data({empty:null,load:"ajax"}),$("[data-content=list-selection][data-tab="+o.attr("id")+"]").addClass("disabled")):0==$(PF.obj.listing.selectors.list_item,o).length&&($(PF.obj.listing.selectors.pad_content).height(0),o.find("[data-action=load-more]").click(),PF.obj.listing.recolumnize=!0)})}},deleteFromList:function(e){if(void 0===t)var t=!0;var e=e instanceof jQuery==0?$(e):e;this.removeFromList(e,t?PF.fn._s("The content has been deleted."):null)},moveFromList:function(e,t){if(void 0===t)var t=!0;var e=e instanceof jQuery==0?$(e):e;this.removeFromList(e,t?PF.fn._s("The content has been moved."):null)},toggleSelectItem:function(e,t){if("boolean"!=typeof t)var t=!0;var o,i,n,a=$(".viewer").is(":visible")?$("[data-type=image][data-id="+e.attr("data-id")+"]"):e,r=$("[data-action=select] .btn-icon",a);t?(a.addClass("selected"),o=r.data("icon-selected"),i=r.data("icon-unselected"),n=PF.fn._s("Unselect")):(a.removeClass("selected"),o=r.data("icon-unselected"),i=r.data("icon-selected"),n=PF.fn._s("Select")),r.removeClass(i).addClass(o),$("[data-action=select] .label",a).text(n),CHV.fn.list_editor.selectionCount()},selectItem:function(e){this.toggleSelectItem(e,!0)},unselectItem:function(e){this.toggleSelectItem(e,!1)},clearSelection:function(e){var t=$(PF.obj.listing.selectors.list_item+".selected",PF.obj.listing.selectors[e?"content_listing":"content_listing_visible"]);this.unselectItem(t),this.listMassActionSet("select")},listMassActionSet:function(e){var t="select"==e?"clear":"select",o=$("[data-action=list-"+t+"-all]:visible"),i=o.data("text-"+e+"-all");o.text(i).attr("data-action","list-"+e+"-all")},updateItem:function(e,t,o,i){if(e instanceof jQuery==0)var e=$(e);var n=e.data("type"),a="image"==n?t.album:t;if(this.addAlbumtoModals(a),$('option[value="'+a.id_encoded+'"]',"[name=form-album-id]").html(PF.fn.htmlEncode(a.name_with_privacy_readable_html)),void 0===o)var o="edit";if("edit"==o||"move"==o){if("move"==o&&"album"==CHV.obj.resource.type)return void CHV.fn.list_editor.moveFromList(e,i);e.attr("data-description",t.description),"image"==n?(void 0!==t.title&&(e.attr("data-title",t.title),e.find("[title]").attr("title",t.title),$("[data-text=image-title]",e).html(PF.fn.htmlEncode(t.title))),void 0!==t.title_truncated&&$("[data-text=image-title-truncated]",e).html(PF.fn.htmlEncode(t.title_truncated)),void 0!==t.category_id&&e.attr("data-category-id",t.category_id),e.attr({"data-album-id":a.id_encoded}),$("[data-content=album-link]",e).attr("href",a.url)):e.attr({"data-privacy":a.privacy,"data-password":a.password,"data-name":a.name}),e.attr("data-privacy",a.privacy),$("[data-text=album-name]",e).html(PF.fn.htmlEncode(a.name)),PF.fn.growl.expirable("edit"==o?PF.fn._s("The content has been edited."):PF.fn._s("The content has been moved."))}},addAlbumtoModals:function(e){var t=!1;$("[name=form-album-id]","[data-modal]").each(function(){e.id_encoded&&!$('option[value="'+e.id_encoded+'"]',this).exists()&&($(this).append('<option value="'+e.id_encoded+'">'+e.name_with_privacy_readable_html+"</option>"),t=!0)}),t&&CHV.fn.list_editor.updateUserCounters("album",1,"+")},updateAlbum:function(e){$("[data-id="+e.id_encoded+"]").each(function(){""!==e.html&&($(this).after(e.html),$(this).remove())})},updateUserCounters:function(e,t,o){if(void 0===o)var o="+";var i,n,a=$("[data-text="+e+"-count]"),r=$("[data-text="+e+"-label]"),t=parseInt(t),s=parseInt(a.html());switch(o){case"+":i=s+t;break;case"-":i=s-t;break;case"=":i=t}n=i-s;var l=$("[data-text=total-"+a.data("text")+"]"),d=$("[data-text="+l.data("text")+"-label]"),c=parseInt(l.html())+n;a.text(i),l.text(c),r.text(r.data(1==i?"label-single":"label-plural")),d.text(r.data(1==c?"label-single":"label-plural"))},updateMoveItemLists:function(e,t,o){if(CHV.fn.list_editor.clearSelection(),/image/.test(t))"image"==t?CHV.fn.list_editor.updateItem("[data-type=image][data-id="+o.data("id")+"]",e.image,"move"):(o.each(function(){CHV.fn.list_editor.updateItem("[data-type="+t+"][data-id="+$(this).data("id")+"]",e,"move",!1)}),PF.fn.growl.expirable(PF.fn._s("The content has been moved.")));else{if("album"==CHV.obj.resource.type?CHV.fn.list_editor.moveFromList(o):PF.fn.growl.expirable(PF.fn._s("The content has been moved.")),void 0!==e.albums_old)for(var i=0;i<e.albums_old.length;i++)CHV.fn.list_editor.updateAlbum(e.albums_old[i]);else CHV.fn.list_editor.updateAlbum(e.old_album);if(e.album)if(void 0!==e.albums_old?"true"==e.request.album.new:"true"==e.request.editing.new_album){CHV.fn.list_editor.addAlbumtoModals(e.album);var n=parseInt($("[data-text=album-count]").text())-1;$(PF.obj.listing.selectors.pad_content).each(function(){var t=$(this).find(PF.obj.listing.selectors.list_item).length;if(0!=t){var o=PF.fn.deparam($(this).closest(PF.obj.listing.selectors.content_listing).data("params"));"date_desc"!=o.sort&&n!=t||$(this)["date_desc"==o.sort?"prepend":"append"](e.album.html)}})}else CHV.fn.list_editor.updateAlbum(e.album);PF.fn.listing.columnizerQueue(),PF.fn.listing.refresh(0)}}};